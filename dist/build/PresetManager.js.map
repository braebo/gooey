{"version":3,"file":"PresetManager.js","sources":["../../../src/PresetManager.ts"],"sourcesContent":["import type { InputButtonGrid } from './inputs/InputButtonGrid'\nimport type { InputSelect } from './inputs/InputSelect'\nimport type { PersistedValue } from './shared/persist'\nimport type { Folder, FolderOptions } from './Folder'\nimport type { Gooey, GooeyPreset } from './Gooey'\nimport type { State } from './shared/state'\n\nimport { RenameSVG } from './svg/RenameSVG'\nimport { persist } from './shared/persist'\nimport { Tooltip } from './shared/Tooltip'\nimport { Logger } from './shared/logger'\nimport { nanoid } from './shared/nanoid'\nimport { isType } from './shared/isType'\nimport { SaveSVG } from './svg/SaveSVG'\nimport { state } from './shared/state'\nimport { r } from './shared/l'\n\nexport interface PresetManagerOptions {\n\t__type?: 'PresetManagerOptions'\n\n\t/**\n\t * Whether the preset manager should be disabled entirely *(no presets/gui/storage/etc)*.\n\t */\n\tdisabled?: boolean\n\n\t/**\n\t * Optionsal existing presets.\n\t * @default []\n\t */\n\tpresets?: GooeyPreset[]\n\n\t/**\n\t * The default preset to use.\n\t * @default undefined\n\t */\n\tdefaultPreset?: GooeyPreset\n\n\t/**\n\t * The key to use for storage.  If not provided, storage is disabled.\n\t * @default undefined\n\t */\n\tlocalStorageKey?: string\n\n\t/**\n\t * Whether to automatically call {@link PresetManager.init|init()} (which mainly adds the gui).\n\t */\n\tautoInit?: boolean\n\n\t/**\n\t * Options for the \"presets\" folder that is added to the\n\t * {@link Gooey.settingsFolder|settings folder}.\n\t */\n\tfolderOptions?: Partial<FolderOptions>\n}\n\nexport class PresetManager {\n\treadonly __type = Object.freeze('PresetManager')\n\treadonly __version = '2' // todo - this needs to be settable externally (added to GooeyOptions)\n\n\tdefaultPreset!: GooeyPreset\n\tactivePreset: State<GooeyPreset>\n\tpresets!: State<GooeyPreset[]>\n\tfolder!: Folder\n\n\tprivate _version!: PersistedValue<string>\n\tprivate _defaultPresetId = 'gooey-default-preset'\n\tprivate _defaultPresetTitle = 'default'\n\n\tprivate _presetSnapshot?: GooeyPreset\n\n\tprivate _presetsInput!: InputSelect<GooeyPreset>\n\tprivate _manageInput!: InputButtonGrid\n\tprivate _renamePresetButton!: RenameSVG\n\n\tprivate _initialized = false\n\tprivate _log: Logger\n\n\tconstructor(\n\t\tpublic gooey: Gooey,\n\t\tpublic parentFolder: Folder,\n\t\toptions: PresetManagerOptions,\n\t) {\n\t\tthis._log = new Logger(`PresetManager ${gooey.folder.title}`, { fg: 'slateblue' })\n\t\tthis._log.fn('constructor').debug({ options, this: this })\n\n\t\tthis.opts = options\n\t\tthis.opts.localStorageKey ??= 'gooey::presets'\n\t\tconst storageKey = this.opts.localStorageKey\n\n\t\tthis._validateVersion(storageKey)\n\n\t\tthis.activePreset = state(this.opts.defaultPreset ?? ({} as GooeyPreset), {\n\t\t\tkey: storageKey + '::active',\n\t\t})\n\n\t\tthis._log.fn('constructor').debug('activePreset', this.activePreset.value)\n\n\t\tthis.presets = state(this.opts.presets ?? [], {\n\t\t\tkey: storageKey,\n\t\t})\n\n\t\tif (this.opts.autoInit !== false) {\n\t\t\tthis.init()\n\t\t}\n\n\t\tif (\n\t\t\tObject.keys(this.activePreset.value).length &&\n\t\t\tthis.activePreset.value.id !== this._defaultPresetId\n\t\t) {\n\t\t\tPromise.resolve().then(() => {\n\t\t\t\tthis._log.fn('constructor').debug('loading active preset', this.activePreset.value)\n\t\t\t\tthis.gooey.load(this.activePreset.value)\n\t\t\t\tthis.gooey._undoManager.clear()\n\t\t\t})\n\t\t} else {\n\t\t\tthis._log.fn('constructor').debug('No active preset found. Loading default.')\n\t\t}\n\t}\n\topts: PresetManagerOptions\n\n\tget defaultPresetIsActive() {\n\t\treturn this.activePreset.value.id === this._defaultPresetId\n\t}\n\n\tasync init() {\n\t\tif (this.opts.disabled) {\n\t\t\tthis._log.debug('Aborting initialization: disabled by options.')\n\t\t\treturn\n\t\t}\n\t\tthis._initialized = true\n\n\t\tawait Promise.resolve()\n\t\tthis.folder = await this.addGui(this.parentFolder, this.opts.defaultPreset)\n\t\tthis._refresh()\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Set the active preset.\n\t */\n\tset(value: GooeyPreset) {\n\t\tthis._log.fn('set').debug({ value, this: this })\n\t\tthis.activePreset.set(value)\n\t}\n\n\tprivate _renamePreset(title: string) {\n\t\tthis._log.fn('_renamePreset').debug({ this: this, title })\n\n\t\tif (!this._isInitialized()) throw new Error('PresetManager not initialized.')\n\n\t\tconst active = this.activePreset.value\n\n\t\tthis.presets.update(presets => {\n\t\t\tif (!active) throw new Error('No preset found.')\n\n\t\t\tif (active.id === this._defaultPresetId) {\n\t\t\t\tthrow new Error('Cannot rename default preset.')\n\t\t\t}\n\n\t\t\tactive.title = title\n\t\t\tthis.activePreset.set(active)\n\n\t\t\treturn presets.map(p => (p.id === active.id ? active : p))\n\t\t})\n\n\t\tthis._refresh()\n\t}\n\n\tprivate _resolveUnusedTitle(title: string) {\n\t\tthis._log.fn('resolveUnusedTitle').debug({ this: this, title })\n\t\tif (!this._isInitialized()) throw new Error('PresetManager not initialized.')\n\n\t\tconst presets = this.presets.value\n\t\tlet i = 0\n\t\tlet newTitle = title\n\n\t\twhile (presets.some(p => p.title === newTitle)) {\n\t\t\ti++\n\t\t\tnewTitle = title + ` (${i})`\n\t\t}\n\n\t\treturn newTitle\n\t}\n\n\tprivate _resolveDefaultPreset() {\n\t\tconst newDefaultPreset = this.gooey.save(\n\t\t\tthis._defaultPresetTitle,\n\t\t\tthis._defaultPresetId,\n\t\t\tthis.__version,\n\t\t)\n\n\t\tconst existingIndex = this.presets.value.findIndex(p => p.id === this._defaultPresetId)\n\n\t\tif (existingIndex === -1) {\n\t\t\tthis.presets.push(newDefaultPreset)\n\t\t} else {\n\t\t\tthis.presets.update(presets => {\n\t\t\t\tpresets[existingIndex] = newDefaultPreset\n\t\t\t\treturn presets\n\t\t\t})\n\t\t}\n\n\t\treturn newDefaultPreset\n\t}\n\n\tasync addGui(parentFolder: Folder, defaultPreset?: GooeyPreset) {\n\t\tthis._log.fn('add').debug({ this: this, parentFolder, defaultPreset })\n\n\t\tif (!this._isInitialized()) throw new Error('PresetManager not initialized.')\n\n\t\tconst presetsFolder = parentFolder.addFolder('presets', {\n\t\t\t...this.opts.folderOptions,\n\t\t\tsaveable: false,\n\t\t\t// @ts-expect-error - @internal\n\t\t\tgooey: this.gooey,\n\t\t})\n\n\t\tpresetsFolder.element.classList.add('gooey-folder-alt')\n\n\t\t// Fully desaturate the presets folder's header connector to svg.\n\t\tpresetsFolder.on('mount', () => {\n\t\t\tpresetsFolder.graphics!.connector!.svg.style.setProperty('filter', 'saturate(0.1)')\n\t\t\tpresetsFolder.graphics!.icon.style.setProperty('filter', 'saturate(0)')\n\t\t})\n\n\t\tthis.defaultPreset = defaultPreset ?? this._resolveDefaultPreset()\n\n\t\tif (!Object.keys(this.activePreset.value).length) {\n\t\t\tthis._log.fn('add').debug('No active preset found. Setting active to default.')\n\t\t\tthis.activePreset.set(this.defaultPreset)\n\t\t}\n\n\t\tif (!this.activePreset.value) {\n\t\t\tthrow new Error('No active preset.')\n\t\t}\n\t\tif (!this.activePreset.value.id) {\n\t\t\tthrow new Error('No active preset id.')\n\t\t}\n\n\t\t/**\n\t\t * Download the active preset as a JSON file.\n\t\t */\n\t\tconst download = (preset: GooeyPreset | GooeyPreset[]) => {\n\t\t\t// const preset = this.activePreset.value\n\t\t\tconst title = Array.isArray(preset)\n\t\t\t\t? this.gooey.folder.title + ' presets'\n\t\t\t\t: preset.title\n\t\t\tconst blob = new Blob([JSON.stringify(preset, null, 2)], {\n\t\t\t\ttype: 'application/json',\n\t\t\t})\n\t\t\tconst url = URL.createObjectURL(blob)\n\t\t\tconst a = document.createElement('a')\n\t\t\ta.href = url\n\t\t\ta.download = `${title}.json`\n\t\t\ta.click()\n\t\t\tURL.revokeObjectURL(url)\n\t\t}\n\n\t\tconst upload = () => {\n\t\t\tconst input = document.createElement('input')\n\t\t\tinput.type = 'file'\n\t\t\tinput.accept = '.json'\n\t\t\tinput.onchange = async e => {\n\t\t\t\tconst file = (e.target as HTMLInputElement).files?.[0]\n\t\t\t\tif (!file) return\n\n\t\t\t\tconst reader = new FileReader()\n\t\t\t\treader.onload = async e => {\n\t\t\t\t\tconst text = e.target?.result as string\n\t\t\t\t\tconst data = JSON.parse(text)\n\t\t\t\t\tif (Array.isArray(data)) {\n\t\t\t\t\t\tfor (const preset of data) {\n\t\t\t\t\t\t\tif (isType<GooeyPreset, 'GooeyPreset'>(preset, 'GooeyPreset')) {\n\t\t\t\t\t\t\t\tthis.put(preset)\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconsole.warn('Invalid preset:', preset)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (isType<GooeyPreset>(data, 'GooeyPreset')) {\n\t\t\t\t\t\t\tthis.put(data)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.warn('Invalid preset:', data)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis._refresh()\n\t\t\t\t}\n\t\t\t\treader.readAsText(file)\n\t\t\t}\n\t\t\tinput.click()\n\t\t}\n\n\t\tconst createIcon = (name: string, contents: string) =>\n\t\t\t/*html*/ `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke-width=\"1.5\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"gooey-icon gooey-icon-${name}\">${contents}</svg>`\n\n\t\t//? Preset Management Buttons\n\t\tthis._manageInput = presetsFolder.addButtonGrid(\n\t\t\t'',\n\t\t\t[\n\t\t\t\t[\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: 'update',\n\t\t\t\t\t\tid: 'update',\n\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\tconst { id, title } = this.activePreset.value\n\t\t\t\t\t\t\tconst current = this.gooey.save(title, id, this.__version)\n\t\t\t\t\t\t\tthis.put(current)\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdisabled: () => this.defaultPresetIsActive,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: 'delete',\n\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\tlet index = undefined as number | undefined\n\t\t\t\t\t\t\tthis.presets.update(presets => {\n\t\t\t\t\t\t\t\tindex = presets.findIndex(p => p.id === this.activePreset.value.id)\n\t\t\t\t\t\t\t\tpresets.splice(index, 1)\n\t\t\t\t\t\t\t\treturn presets\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tthis.activePreset.set(\n\t\t\t\t\t\t\t\tthis.presets.value[index ?? 0] ?? this.defaultPreset,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\tthis._refresh()\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdisabled: () => this.defaultPresetIsActive,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: createIcon(\n\t\t\t\t\t\t\t'copy',\n\t\t\t\t\t\t\t/*html*/ `<rect width=\"14\" height=\"14\" x=\"8\" y=\"8\" rx=\"2\" ry=\"2\"></rect><path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\"></path>`,\n\t\t\t\t\t\t),\n\t\t\t\t\t\tid: 'copy',\n\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\ttext: 'Copy',\n\t\t\t\t\t\t\tdelay: 0,\n\t\t\t\t\t\t\tplacement: 'bottom',\n\t\t\t\t\t\t\thideOnClick: true,\n\t\t\t\t\t\t\t// @ts-expect-error - @internal\n\t\t\t\t\t\t\tstyle: this.gooey?._getStyles,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstyle: { maxWidth: '1.5rem', padding: '0.3rem' },\n\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\tnavigator.clipboard?.writeText(\n\t\t\t\t\t\t\t\tJSON.stringify(this.activePreset.value, null, 2),\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdisabled: () => this.defaultPresetIsActive,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: createIcon(\n\t\t\t\t\t\t\t'paste',\n\t\t\t\t\t\t\t/*html*/ `<rect width=\"8\" height=\"4\" x=\"8\" y=\"2\" rx=\"1\" ry=\"1\"></rect><path d=\"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2\"></path>`,\n\t\t\t\t\t\t),\n\t\t\t\t\t\tid: 'paste',\n\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\ttext: 'Paste',\n\t\t\t\t\t\t\tdelay: 0,\n\t\t\t\t\t\t\tplacement: 'bottom',\n\t\t\t\t\t\t\thideOnClick: true,\n\t\t\t\t\t\t\t// @ts-expect-error - @internal\n\t\t\t\t\t\t\tstyle: this.gooey?._getStyles,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstyle: { maxWidth: '1.5rem', padding: '0.3rem' },\n\t\t\t\t\t\tonClick: async ({ button }) => {\n\t\t\t\t\t\t\tbutton.disabled = true\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tconst text = await navigator.clipboard.readText()\n\t\t\t\t\t\t\t\tconsole.log(text)\n\t\t\t\t\t\t\t\tif (text) {\n\t\t\t\t\t\t\t\t\tconst preset = JSON.parse(text)\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\ttypeof preset === 'object' &&\n\t\t\t\t\t\t\t\t\t\tpreset.__type === 'GooeyPreset'\n\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\tthis.put(preset)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t// todo - need a toast / err msg / overlay for errors\n\t\t\t\t\t\t\t\tconsole.error(e)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbutton.disabled = false\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdisabled: () => this.defaultPresetIsActive,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: createIcon(\n\t\t\t\t\t\t\t'download',\n\t\t\t\t\t\t\t/*html*/ `<path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path><polyline points=\"7 10 12 15 17 10\"></polyline><line x1=\"12\" x2=\"12\" y1=\"15\" y2=\"3\"></line></svg>`,\n\t\t\t\t\t\t),\n\t\t\t\t\t\tid: 'download',\n\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\ttext: 'Download',\n\t\t\t\t\t\t\tdelay: 0,\n\t\t\t\t\t\t\tplacement: 'bottom',\n\t\t\t\t\t\t\thideOnClick: true,\n\t\t\t\t\t\t\t// @ts-expect-error - @internal\n\t\t\t\t\t\t\tstyle: this.gooey?._getStyles,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstyle: { maxWidth: '1.5rem', padding: '0.3rem' },\n\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\tdownload(this.activePreset.value)\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdisabled: () => this.defaultPresetIsActive,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: createIcon(\n\t\t\t\t\t\t\t'download-all',\n\t\t\t\t\t\t\t/*html*/ `<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M21 14v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\" /><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M21 11v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\" /><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M21 17v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\" /><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m7 8 5 5 5-5\" /><path  stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 13V1\" />`,\n\t\t\t\t\t\t),\n\t\t\t\t\t\tid: 'download-all',\n\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\ttext: 'Download All',\n\t\t\t\t\t\t\tdelay: 0,\n\t\t\t\t\t\t\tplacement: 'bottom',\n\t\t\t\t\t\t\thideOnClick: true,\n\t\t\t\t\t\t\t// offsetY: '0.1rem',\n\t\t\t\t\t\t\t// @ts-expect-error - @internal\n\t\t\t\t\t\t\tstyle: this.gooey?._getStyles,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstyle: { maxWidth: '1.5rem', padding: '0.3rem' },\n\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\tdownload(this.presets.value)\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdisabled: () => this.presets.value.length <= 1,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'upload',\n\t\t\t\t\t\ttext: createIcon(\n\t\t\t\t\t\t\t'upload',\n\t\t\t\t\t\t\t/*html*/ `<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\" /><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m17 8-5-5-5 5\" /><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 3v12\" />`,\n\t\t\t\t\t\t),\n\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\ttext: 'Upload',\n\t\t\t\t\t\t\tdelay: 0,\n\t\t\t\t\t\t\tplacement: 'bottom',\n\t\t\t\t\t\t\thideOnClick: true,\n\t\t\t\t\t\t\t// @ts-expect-error - @internal\n\t\t\t\t\t\t\tstyle: this.gooey?._getStyles,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstyle: { maxWidth: '1.5rem', padding: '0.3rem' },\n\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\tupload()\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t],\n\t\t\t{\n\t\t\t\torder: 1,\n\t\t\t\tresettable: false,\n\t\t\t},\n\t\t)\n\n\t\t//? Presets Select Input\n\t\tthis._presetsInput = presetsFolder.addSelect('', this.presets.value, {\n\t\t\tlabelKey: 'title',\n\t\t\torder: 0,\n\t\t\tvalue: this.activePreset.value,\n\t\t\tresettable: false,\n\t\t})\n\n\t\tlet first = true\n\t\tthis._presetsInput.on('change', ({ value }) => {\n\t\t\tif (first) {\n\t\t\t\tthis._log\n\t\t\t\t\t.fn(\"_presetsInput.on('change')\")\n\t\t\t\t\t.debug('Skipping initial change.', { value, this: this })\n\t\t\t\tfirst = false\n\t\t\t\treturn\n\t\t\t}\n\t\t\tthis._log.fn('_presetsInput.on(change)').debug({ value, this: this })\n\t\t\tthis.gooey.load(value)\n\t\t\tthis.activePreset.set(value)\n\t\t\tthis._refreshInputs()\n\t\t})\n\n\t\tthis._presetsInput.on('open', () => {\n\t\t\tthis._log.fn('_presetsInput.on(open)').debug()\n\t\t\tthis._presetSnapshot = this.gooey.save('__snapshot__')\n\t\t})\n\n\t\tthis._presetsInput.on('cancel', () => {\n\t\t\tthis._log.fn('_presetsInput.on(cancel)').debug()\n\t\t\tif (this._presetSnapshot) {\n\t\t\t\tthis.gooey.load(this._presetSnapshot)\n\t\t\t\tthis._refreshInputs()\n\t\t\t}\n\t\t})\n\n\t\t//? New Preset Button\n\t\tconst newPresetButton = new SaveSVG()\n\t\tnewPresetButton.element.tooltip = new Tooltip(newPresetButton.element, {\n\t\t\ttext: 'Save',\n\t\t\tdelay: 0,\n\t\t\tplacement: 'bottom',\n\t\t\thideOnClick: true,\n\t\t})\n\t\tthis._presetsInput.listen(newPresetButton.element, 'click', () => {\n\t\t\tthis._log.fn('newPresetButton.on(click)').debug()\n\t\t\tthis.put()\n\t\t})\n\n\t\t//? Rename Preset Button\n\t\tthis._renamePresetButton = new RenameSVG()\n\t\tthis._renamePresetButton.element.tooltip = new Tooltip(this._renamePresetButton.element, {\n\t\t\tdelay: 0,\n\t\t\tplacement: 'bottom',\n\t\t\thideOnClick: true,\n\t\t\ttext: () => {\n\t\t\t\tif (this._renamePresetButton.element.classList.contains('active')) {\n\t\t\t\t\treturn ``\n\t\t\t\t} else {\n\t\t\t\t\treturn this.defaultPresetIsActive ? `Can't rename default preset` : `Rename`\n\t\t\t\t}\n\t\t\t},\n\t\t\t// @ts-expect-error - @internal\n\t\t\tstyle: this.gooey._getStyles,\n\t\t})\n\t\tthis._presetsInput.listen(this._renamePresetButton.element, 'click', this._toggleRename)\n\n\t\tthis._presetsInput.elements.content.prepend(this._renamePresetButton.element)\n\t\tthis._presetsInput.elements.content.prepend(newPresetButton.element)\n\n\t\t// Refresh the disabled state.\n\t\tthis._refreshInputs()\n\n\t\treturn presetsFolder\n\t}\n\n\t/**\n\t * Updates a preset if it exists, adds it as a new preset if not, or creates a new one from the\n\t * current state and adds it if none is provided.\n\t */\n\tput(\n\t\t/**\n\t\t * The preset to update or add.  If not provided, a new preset is created from the current\n\t\t * state.\n\t\t */\n\t\tpreset?: GooeyPreset,\n\t) {\n\t\tthis._log.fn('saveNewPreset')\n\n\t\tif (!this._isInitialized()) {\n\t\t\tthrow new Error('PresetManager not initialized.')\n\t\t}\n\n\t\tif (!this._presetsInput) {\n\t\t\tthrow new Error('No select input.')\n\t\t}\n\n\t\tpreset ??= this.gooey.save(this._resolveUnusedTitle('preset'), nanoid(), this.__version)\n\n\t\tconst existing = this.presets.value.find(p => p.id === preset.id)\n\t\tif (!existing) {\n\t\t\tthis._log.fn('put').debug('pushing preset:', { preset, existing })\n\t\t\tthis.presets.push(preset)\n\t\t} else {\n\t\t\tthis._log.fn('put').debug('preset exists. replacing with:', { preset, existing })\n\t\t\tthis.presets.update(presets => {\n\t\t\t\tconst index = presets.findIndex(p => p.id === preset.id)\n\t\t\t\tpresets[index] = preset\n\t\t\t\treturn presets\n\t\t\t})\n\t\t}\n\n\t\tthis.set(preset)\n\t\tthis._refresh()\n\n\t\tthis._enableRename()\n\t}\n\n\t/**\n\t * Delete a preset.\n\t */\n\tdelete(preset: GooeyPreset | GooeyPreset['id']) {\n\t\tthis._log.fn('delete').debug({ this: this, preset })\n\n\t\tif (!this._isInitialized()) {\n\t\t\tthrow new Error('PresetManager not initialized.')\n\t\t}\n\n\t\tconst id = typeof preset === 'string' ? preset : preset.id\n\t\tthis.presets.update(presets => {\n\t\t\tconst index = presets.findIndex(p => p.id === id)\n\n\t\t\tif (index === -1) {\n\t\t\t\tthrow new Error(r('Error deleting preset:') + ' Preset not found.')\n\t\t\t}\n\n\t\t\tpresets.splice(index, 1)\n\t\t\treturn presets\n\t\t})\n\n\t\tthis.activePreset.set(this.presets.value[0] ?? this.defaultPreset)\n\t}\n\n\tprivate _isInitialized(): this is { presets: State<GooeyPreset[]>; folder: Folder } {\n\t\treturn this._initialized\n\t}\n\n\tprivate _toggleRename = () => {\n\t\tif (this._presetsInput.select.elements.selected.getAttribute('contenteditable')) {\n\t\t\tthis._handleRename()\n\t\t} else {\n\t\t\tthis._enableRename()\n\t\t}\n\t}\n\n\t/**\n\t * When the rename button is active, clicking it to disable triggers a blur event which\n\t * disables it immediately before the click event is triggered, re-enabling it.\n\t *\n\t * The latch and timer prevent that from happening.\n\t */\n\tprivate _blurLatch = false\n\tprivate _blurLatchTimer: ReturnType<typeof setTimeout> | undefined\n\n\t/**\n\t * Disables the dropdown, making the select's text editable.\n\t */\n\tprivate _enableRename = (cursorToEnd = true) => {\n\t\tthis._log.fn('_enableRename').debug({ this: this })\n\n\t\tconst el = this._presetsInput.select.elements.selected\n\n\t\tif (this.defaultPresetIsActive) {\n\t\t\tthis._log.warn('Cannot rename default preset.')\n\t\t\treturn\n\t\t}\n\n\t\tif (this._blurLatch) {\n\t\t\tthis._blurLatch = false\n\t\t\tclearTimeout(this._blurLatchTimer)\n\t\t\treturn\n\t\t}\n\n\t\tthis._renamePresetButton.element.classList.add('active')\n\t\tthis._presetsInput.select.disableClicks = true\n\t\tel.setAttribute('contenteditable', 'true')\n\t\tel.focus()\n\t\tconst range = document.createRange()\n\t\trange.selectNodeContents(el)\n\t\tif (cursorToEnd) {\n\t\t\trange.collapse(false)\n\t\t}\n\t\tconst sel = window.getSelection()\n\t\tsel?.removeAllRanges()\n\t\tsel?.addRange(range)\n\n\t\t// Handle rename / cancel.\n\t\tthis.folder.evm.listen(el, 'blur', this._handleRename, {}, 'preset-manager-rename')\n\t\tthis.folder.evm.listen(window, 'keydown', this._handleKeydown, {}, 'preset-manager-rename')\n\t}\n\n\tprivate _handleRename = (e?: Event) => {\n\t\tthis._log.fn('_disableRename').debug({ e, this: this })\n\n\t\tthis._presetsInput.select.disableClicks = false\n\t\tthis._presetsInput.select.elements.selected.removeAttribute('contenteditable')\n\t\tthis._renamePresetButton.element.classList.remove('active')\n\n\t\tthis.folder.evm.clearGroup('preset-manager-rename')\n\n\t\tif (e?.type === 'blur') {\n\t\t\t// If this is a click event targetting the rename button, trigger the latch.\n\t\t\tthis._blurLatch = true\n\t\t\tclearTimeout(this._blurLatchTimer)\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis._blurLatch = false\n\t\t\t}, 300)\n\n\t\t\t// Commit the rename if the title has changed.\n\t\t\tconst text = (e.target as HTMLElement)?.textContent ?? ''\n\t\t\tif (text !== this.activePreset.value.title) {\n\t\t\t\tthis._renamePreset(text)\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _handleKeydown = (e: KeyboardEvent) => {\n\t\tthis._log.fn('_handleKeydown').debug({ key: e.key, e, this: this })\n\n\t\tif (e.key === 'Enter') {\n\t\t\te.preventDefault()\n\t\t\tthis._handleRename()\n\t\t}\n\n\t\tif (e.key === 'Escape') {\n\t\t\tthis._handleRename()\n\t\t}\n\t}\n\n\tprivate _validateVersion(key: string) {\n\t\t// Make sure we get the current version unmodified first.\n\t\tlet localVersion = null\n\t\ttry {\n\t\t\tlocalVersion = JSON.parse(localStorage.getItem(key + '::version') ?? '')\n\t\t} catch (e) {}\n\n\t\t// Initialize the persistant version.\n\t\tthis._version = persist(key + '::version', this.__version)\n\n\t\t// If the version is different, remove presets from storage.\n\t\tif (localVersion !== this.__version) {\n\t\t\tlocalStorage.removeItem(key!)\n\t\t\tthis._version.set(this.__version)\n\t\t}\n\t}\n\n\tprivate _refreshInputs() {\n\t\tconst disableRename = this.defaultPresetIsActive\n\t\tthis._renamePresetButton.element.classList.toggle('disabled', disableRename)\n\t\tthis._renamePresetButton.element.toggleAttribute('disabled', disableRename)\n\n\t\tthis._manageInput.refresh()\n\n\t\tthis._log.fn('_refreshInputs').debug({ disableRename, this: this })\n\t}\n\n\t/**\n\t * Refresh the presets input.\n\t */\n\tprivate _refresh() {\n\t\tthis._log.fn('_refresh').debug('Refreshing options and setting input.', { this: this })\n\n\t\tthis._presetsInput.options = this.presets.value.map(o => ({ label: o.title, value: o }))\n\t\tconst activePreset = this.activePreset.value\n\t\tthis._presetsInput.set({ label: activePreset.title, value: activePreset })\n\n\t\tthis._refreshInputs()\n\t}\n\n\tdispose() {\n\t\tthis._initialized = false\n\t\tthis._presetsInput.dispose()\n\t\tthis._renamePresetButton.element.tooltip.dispose()\n\t\tthis._renamePresetButton.element.remove\n\t}\n}\n"],"names":[],"mappings":"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"}