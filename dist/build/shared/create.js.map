{"version":3,"file":"create.js","sources":["../../../../src/shared/create.ts"],"sourcesContent":["import type { JavascriptStyleProperty } from './css-types'\nimport type { TooltipOptions } from './Tooltip'\n\nimport { Tooltip } from './Tooltip'\nimport { entries } from './object'\nimport { DEV } from 'esm-env'\n\nexport type CreateOptions<\n\tT extends HTMLElement | HTMLInputElement = HTMLElement,\n\tK extends keyof T = keyof T,\n\tTK extends T[K] = T[K],\n> = {\n\tparent?: Element | Document\n\tclasses?: string[]\n\tid?: string\n\tdataset?: Record<string, string>\n\ttextContent?: string\n\tinnerText?: string\n\tcssText?: string\n\tstyle?: Partial<Record<JavascriptStyleProperty, string | number>>\n\tvariables?: Record<`--${string}`, string | number>\n\ttype?: string\n\tattributes?: Record<string, string>\n\tvalue?: any\n\ttooltip?: Partial<TooltipOptions>\n\tinnerHTML?: string\n\tchildren?: HTMLElement[]\n\tmin?: number\n\tmax?: number\n\tstep?: number\n\ttooltipInstance?: Tooltip\n\tonclick?: (e: MouseEvent) => void\n} & Partial<Record<K, TK | unknown>>\n\nexport function create<\n\tconst K extends keyof HTMLElementTagNameMap,\n\tTOptions extends CreateOptions<HTMLElementTagNameMap[K]>,\n\tTElement = HTMLElementTagNameMap[K] & { dataset: TOptions['dataset'] },\n>(\n\ttagname: K,\n\toptions?: TOptions,\n): TOptions extends { tooltip: Partial<TooltipOptions> }\n\t? TElement & { tooltip: Tooltip }\n\t: TElement {\n\tconst el = globalThis?.document?.createElement(tagname)\n\n\tif (options) {\n\t\tif (options.classes) el.classList.add(...options.classes)\n\t\tif (options.id) el.id = options.id\n\t\tif (options.innerHTML) el.innerHTML = options.innerHTML\n\t\tif (options.textContent) el.textContent = options.textContent\n\t\tif (options.innerText) el.innerText = options.innerText\n\t\tif (options.cssText) el.style.cssText = options.cssText\n\t\tif (options.dataset) Object.assign(el.dataset, options.dataset)\n\t\tif (options.value && el instanceof HTMLInputElement) el.value = options.value\n\t\tif (options.type) el.setAttribute('type', options.type)\n\t\tif (options.min) el.setAttribute('min', String(options.min))\n\t\tif (options.max) el.setAttribute('max', String(options.max))\n\t\tif (options.step) el.setAttribute('step', String(options.step))\n\n\t\tif (options.attributes) {\n\t\t\tfor (const [key, value] of entries(options.attributes)) {\n\t\t\t\tel.setAttribute(key, value)\n\t\t\t}\n\t\t}\n\n\t\tif (options.style) {\n\t\t\tfor (const [key, value] of entries(options.style)) {\n\t\t\t\tel.style[key] = String(value)\n\t\t\t}\n\t\t}\n\n\t\tif (options.variables) {\n\t\t\tfor (const [key, value] of entries(options.variables)) {\n\t\t\t\tel.style.setProperty(key, String(value))\n\t\t\t}\n\t\t}\n\n\t\tif (options.parent) options.parent.appendChild(el)\n\n\t\tif (options.tooltip) {\n\t\t\t// @ts-expect-error\n\t\t\tel.tooltip = {}\n\n\t\t\tif (options.tooltipInstance) {\n\t\t\t\t// @ts-expect-error\n\t\t\t\tel.tooltip = options.tooltipInstance\n\t\t\t} else {\n\t\t\t\t// @ts-expect-error\n\t\t\t\tel.tooltip = new Tooltip(el, options.tooltip)\n\t\t\t}\n\t\t}\n\n\t\tif (options.children) {\n\t\t\tfor (const child of options.children ?? []) {\n\t\t\t\tif (el === null) throw new Error('This should never happen')\n\t\t\t\tif (child) {\n\t\t\t\t\tel.appendChild(child)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (options.onclick) {\n\t\t\tel.addEventListener('click', options.onclick as EventListener)\n\t\t}\n\t}\n\n\tif (DEV) {\n\t\tconst stack = new Error().stack as string\n\t\tmaybeAddOpenInEditorEventListener(stack, el)\n\t}\n\n\treturn el as TOptions extends { tooltip: Partial<TooltipOptions> }\n\t\t? TElement & { tooltip: Tooltip }\n\t\t: TElement\n}\n\n/**\n * Adds an event listener to the element that opens the file in the editor\n * when the element is right-clicked with `meta` and `alt` keys pressed.\n *\n * @todo - This doesn't work yet -- the file/line is inaccurate and doesn't\n * correspond to the locatioin where the {@link create} function was called.\n *\n * @todo - Should this be one event listener that parses the url from the\n * target node's dataset?\n *\n */\nfunction maybeAddOpenInEditorEventListener(stack: string, el: HTMLElement) {\n\tconst file = parseFileFromStack(stack)\n\tif (file) {\n\t\tel.addEventListener(\n\t\t\t'contextmenu',\n\t\t\te => {\n\t\t\t\tif ((e as MouseEvent).metaKey && (e as MouseEvent).altKey) {\n\t\t\t\t\te.preventDefault()\n\t\t\t\t\te.stopPropagation()\n\t\t\t\t\tconsole.log(e.target)\n\t\t\t\t\topenFileInEditor(file)\n\t\t\t\t}\n\t\t\t},\n\t\t\t{ capture: false },\n\t\t)\n\t}\n}\n\nfunction openFileInEditor(file: string) {\n\tconst url = '/__open-in-editor?file=' + file\n\tfetch(url)\n\t\t.then(response => {\n\t\t\tconsole.log(response.status, url)\n\t\t})\n\t\t.catch(error => {\n\t\t\tconsole.error('Failed to open file in editor:', error)\n\t\t})\n}\n\nfunction parseFileFromStack(stack?: string): string | null {\n\tconst stackLine = stack?.split('\\n')[2].trim()\n\tconst url_regex = /http:\\/\\/[^ )]+/\n\tconst timestamp_regex = /\\?t=\\d+/\n\tconst url = stackLine?.match(url_regex)?.[0]?.replace(timestamp_regex, '')\n\tif (url) {\n\t\ttry {\n\t\t\tconst path = new URL(url).pathname.slice(1)\n\t\t\treturn path\n\t\t} catch (e) {\n\t\t\tconsole.error('Failed to parse file from stack:', e)\n\t\t}\n\t}\n\treturn null\n}\n"],"names":[],"mappings":"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"}