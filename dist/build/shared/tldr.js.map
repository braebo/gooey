{"version":3,"file":"tldr.js","sources":["../../../../src/shared/tldr.ts"],"sourcesContent":["/**\n * Options for {@link tldr}.\n */\nexport interface TldrOptions {\n\t/**\n\t * The max depth to traverse.\n\t * @default 2\n\t */\n\tmaxDepth?: number\n\n\t/**\n\t * The max number of string characters before truncating th..\n\t * @default 30\n\t */\n\tmaxLength?: number\n\n\t/**\n\t * The max number of object or array entries before truncating.\n\t * @default 4\n\t */\n\tmaxSiblings?: number\n\n\t/**\n\t * Bypasses the {@link maxSiblings} limit for the top level if `true`.\n\t * @default false\n\t */\n\tpreserveRootSiblings?: boolean\n\n\t/**\n\t * Whether to preserve numbers instead of truncating them according to {@link maxLength}.\n\t * @default false\n\t */\n\tpreserveNumbers?: boolean\n\n\t/**\n\t * Preserve functions instead of serializing them to `[Function: name]`.\n\t * @default false\n\t */\n\tpreserveFunctions?: boolean\n}\n\n/**\n * Truncate objects by depth, sibling count, and string/number length.\n */\nexport function tldr<T>(\n\t/**\n\t * The object to simplify.\n\t */\n\tobject: unknown,\n\t/**\n\t * Optional {@link TldrOptions}.\n\t */\n\t{\n\t\tmaxDepth = 2,\n\t\tmaxLength = 30,\n\t\tmaxSiblings = 4,\n\t\tpreserveRootSiblings = false,\n\t\tpreserveFunctions = false,\n\t\tpreserveNumbers = false,\n\t}: TldrOptions = {},\n) {\n\treturn parse(object) as T\n\n\tfunction parse(obj: unknown, depth = 0): unknown {\n\t\tconst seen = new WeakSet()\n\t\tif (obj === null) {\n\t\t\treturn obj\n\t\t}\n\n\t\tif (typeof obj === 'object') {\n\t\t\tif (seen.has(obj)) return '[Circular]'\n\t\t\tseen.add(obj)\n\t\t}\n\n\t\tswitch (typeof obj) {\n\t\t\tcase 'boolean':\n\t\t\tcase 'symbol':\n\t\t\tcase 'undefined': {\n\t\t\t\treturn obj\n\t\t\t}\n\n\t\t\tcase 'function': {\n\t\t\t\treturn preserveFunctions ? obj : `[Function: ${obj.name}]`\n\t\t\t}\n\n\t\t\tcase 'string': {\n\t\t\t\t// Trim strings that are too long.\n\t\t\t\tif (obj.length < maxLength + 3) return obj\n\t\t\t\treturn obj.slice(0, maxLength) + '..'\n\t\t\t}\n\n\t\t\tcase 'number': {\n\t\t\t\t// Trim numbers that are too long.\n\t\t\t\tconst s = !preserveNumbers ? obj.toFixed(maxLength) : obj.toString()\n\t\t\t\tif (s.length > maxLength + 3) {\n\t\t\t\t\treturn +s.slice(0, maxLength) + '..'\n\t\t\t\t}\n\t\t\t\treturn +s\n\t\t\t}\n\n\t\t\tcase 'bigint': {\n\t\t\t\t// Bigints can't be serialized, so we have to trim them.\n\t\t\t\treturn +obj.toString().slice(0, maxLength)\n\t\t\t}\n\n\t\t\tcase 'object': {\n\t\t\t\tconst depthReached = depth > maxDepth\n\n\t\t\t\tif (Array.isArray(obj)) {\n\t\t\t\t\t// if (depthReached) return `[..${o.length} ${o.length === 1 ? 'item' : 'items'}]`\n\t\t\t\t\tif (depthReached) return `[ ..${obj.length} ]`\n\t\t\t\t\tif (obj.length <= maxSiblings || depth === 0)\n\t\t\t\t\t\treturn obj.map(s => parse(s, depth + 1))\n\n\t\t\t\t\treturn [\n\t\t\t\t\t\t...obj.slice(0, maxSiblings).map(s => parse(s, depth)),\n\t\t\t\t\t\t`..${obj.length - maxSiblings} more`,\n\t\t\t\t\t]\n\t\t\t\t}\n\n\t\t\t\tconst keyCount = Object.keys(obj).length\n\n\t\t\t\tif (depthReached) {\n\t\t\t\t\treturn `{..${keyCount} ${keyCount === 1 ? 'entry' : 'entries'}}`\n\t\t\t\t}\n\n\t\t\t\tif (keyCount <= maxSiblings || (preserveRootSiblings && depth === 0)) {\n\t\t\t\t\treturn Object.fromEntries(\n\t\t\t\t\t\tObject.entries(obj).map(([k, v]) => [k, parse(v, depth + 1)]),\n\t\t\t\t\t)\n\t\t\t\t}\n\n\t\t\t\treturn Object.fromEntries(\n\t\t\t\t\tObject.entries(obj)\n\t\t\t\t\t\t.slice(0, maxSiblings)\n\t\t\t\t\t\t.concat([['..', `${keyCount - maxSiblings} more`]])\n\t\t\t\t\t\t.map(([k, v]) => [k, parse(v, depth + 1)]),\n\t\t\t\t)\n\t\t\t}\n\t\t}\n\n\t\treturn obj\n\t}\n}\n"],"names":[],"mappings":"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"}