{"version":3,"file":"ColorPicker.js","sources":["../../../../../src/controllers/color/ColorPicker.ts"],"sourcesContent":["// Box methods adapted from irojs: https://github.com/jaames/iro.js\n\nimport type { InputColor } from '../../inputs/InputColor'\n\nimport { disableable, type Disableable } from '../../shared/decorators/disableable-class-decorator'\nimport { Color, type ColorValue } from '../../shared/color/color'\nimport { EventManager } from '../../shared/EventManager'\nimport { mapRange } from '../../shared/mapRange'\nimport { debounce } from '../../shared/debounce'\nimport { tooltip } from '../../shared/Tooltip'\nimport { Logger } from '../../shared/logger'\nimport { create } from '../../shared/create'\nimport { clamp } from '../../shared/clamp'\n\nexport type LayoutDirection = 'vertical' | 'horizontal' | ''\n\nexport type WheelDirection = 'clockwise' | 'anticlockwise' | ''\n\nexport interface ColorPickerOptions {\n\t/**\n\t * The initial color of the color picker.  Can be any valid {@link ColorValue}.\n\t * @default '#fff'\n\t */\n\tcolor: ColorValue\n\t/**\n\t * The container element for the color picker.\n\t */\n\tcontainer?: HTMLElement\n\t/**\n\t * An array of color swatches.\n\t */\n\tswatches: ColorValue[]\n\t/**\n\t * The radius of the color picker handle (the little circle\n\t * that moves around the color picker) in pixels.\n\t * @default 10\n\t */\n\thandleSize: number\n\tdisabled: boolean | (() => boolean)\n}\n\nexport const COLOR_PICKER_DEFAULTS: ColorPickerOptions = {\n\tcolor: '#fff',\n\tswatches: [],\n\thandleSize: 10,\n\tcontainer: undefined,\n\tdisabled: false,\n}\n\nexport type ColorPickerElements = {\n\tcontainer: HTMLDivElement\n\tcanvas: HTMLCanvasElement\n\thandle: HTMLDivElement\n\thueSlider: HTMLInputElement\n\talphaSlider: HTMLInputElement\n}\n\n// export class ColorPicker extends Controller<ColorPickerElements> {\n\nexport interface ColorPicker extends Disableable {}\n\n@disableable\nexport class ColorPicker {\n\topts: ColorPickerOptions\n\telements: ColorPickerElements\n\telement: HTMLDivElement\n\n\tprivate _ctx: CanvasRenderingContext2D\n\tprivate _height = 16 * 3\n\tprivate _width = 256\n\tprivate _resizeObserver: ResizeObserver\n\n\tprivate _gradientWhite!: CanvasGradient\n\tprivate _gradientBlack!: CanvasGradient\n\n\tprivate _dragging = false\n\tprivate _lockCursorPosition = false\n\tprivate _lastColor: Color\n\n\tprivate _log: Logger\n\tprivate _evm = new EventManager(['pointerdown', 'pointerup'])\n\ton = this._evm.on.bind(this._evm)\n\n\tconstructor(\n\t\tpublic input: InputColor,\n\t\toptions?: Partial<ColorPickerOptions>,\n\t) {\n\t\tconst opts = { ...COLOR_PICKER_DEFAULTS, ...options }\n\n\t\tthis.opts = opts\n\t\tthis._log = new Logger(`ColorPicker ${input.title}`, { fg: 'lightgreen' })\n\t\tthis._log.fn('constructor').debug({ opts, this: this })\n\n\t\tthis._lastColor = this.input.state.value.clone()\n\n\t\t// Make sure the rect is accurate on mount.\n\t\tconst style = input.expanded ? {} : { height: '0px' }\n\t\tconst container = create('div', {\n\t\t\tclasses: ['gooey-input-color-picker-container'],\n\t\t\tparent: options?.container ?? input.elements.controllers.container,\n\t\t\tstyle,\n\t\t})\n\t\tthis.element = container\n\n\t\tconst canvas = create('canvas', {\n\t\t\tclasses: ['gooey-input-color-picker-canvas'],\n\t\t\tparent: container,\n\t\t\theight: this._height,\n\t\t})\n\t\t// Reposition the handle when the canvas is resized.\n\t\tconst debouncedUpdateHandle = debounce(this._updateHandle, 100)\n\t\tthis._resizeObserver = new ResizeObserver(() => debouncedUpdateHandle())\n\t\tthis._resizeObserver.observe(canvas)\n\n\t\tconst handle = create('div', {\n\t\t\tclasses: ['gooey-input-color-picker-handle'],\n\t\t\tparent: container,\n\t\t\tstyle: {\n\t\t\t\tbackground: input.state.value.hexString,\n\t\t\t},\n\t\t})\n\n\t\tconst hueSlider = create('input', {\n\t\t\ttype: 'range',\n\t\t\tclasses: ['gooey-input-range', 'gooey-input-color-picker-hue'],\n\t\t\tparent: container,\n\t\t\tmin: 0,\n\t\t\tmax: 359,\n\t\t})\n\t\tthis._evm.listen(hueSlider, 'input', this._updateStateFromHue)\n\n\t\ttooltip(hueSlider, {\n\t\t\tparent: container,\n\t\t\ttext: () => `${this.input.state.value.hsla.h}`,\n\t\t\tplacement: 'top',\n\t\t\toffsetX: '0px',\n\t\t\tanchor: {\n\t\t\t\tx: 'mouse',\n\t\t\t\ty: hueSlider.querySelector('#thumb'),\n\t\t\t},\n\t\t\tstyle: {\n\t\t\t\tbackground: 'var(--gooey-bg-a)',\n\t\t\t\tcolor: 'var(--gooey-fg-a)',\n\t\t\t},\n\t\t})\n\n\t\tconst alphaSlider = create('input', {\n\t\t\ttype: 'range',\n\t\t\tclasses: ['gooey-input-range', 'gooey-input-color-picker-alpha'],\n\t\t\tparent: container,\n\t\t\tmin: 0,\n\t\t\tmax: 1,\n\t\t\tstep: 0.01,\n\t\t})\n\t\tthis._evm.listen(alphaSlider, 'input', this.setAlpha as EventListener)\n\n\t\ttooltip(alphaSlider, {\n\t\t\tparent: container,\n\t\t\ttext: () => `${this.input.state.value.alpha}`,\n\t\t\tplacement: 'top',\n\t\t\toffsetX: '0px',\n\t\t\tanchor: {\n\t\t\t\tx: 'mouse',\n\t\t\t\ty: alphaSlider.querySelector('#thumb'),\n\t\t\t},\n\t\t\tstyle: {\n\t\t\t\tbackground: 'var(--gooey-bg-a)',\n\t\t\t\tcolor: 'var(--gooey-fg-a)',\n\t\t\t},\n\t\t})\n\n\t\tthis.elements = {\n\t\t\tcontainer,\n\t\t\tcanvas,\n\t\t\thandle,\n\t\t\thueSlider,\n\t\t\talphaSlider,\n\t\t}\n\n\t\tthis.disabled = this.opts.disabled\n\n\t\tthis._ctx = canvas.getContext('2d')!\n\t\tthis.canvas.width = this._width\n\t\t// this.refresh()\n\n\t\tthis._evm.listen(this.canvas, 'click', this._onClick)\n\t\tthis._evm.listen(this.canvas, 'pointerdown', this._onPointerDown)\n\t\tthis._evm.listen(this.input.elements.container, 'pointermove', this._onPointerMove, {\n\t\t\tpassive: true,\n\t\t})\n\n\t\tthis._updateGradients()\n\t\tsetTimeout(this.draw, 10)\n\t\tsetTimeout(this._updateHandle, 20)\n\t}\n\n\tget canvas() {\n\t\treturn this.elements.canvas\n\t}\n\n\tget hue() {\n\t\treturn this.input.state.value.hue\n\t}\n\n\tget alpha() {\n\t\treturn this.input.state.value.alpha\n\t}\n\n\tenable = () => {\n\t\tif (this.disabled) this.disabled = false\n\t\tthis.elements.container.classList.remove('gooey-disabled')\n\t\tthis.elements.alphaSlider.disabled = false\n\t\tthis.elements.hueSlider.disabled = false\n\t\tthis.elements.canvas.style.pointerEvents = 'auto'\n\t\treturn this\n\t}\n\n\tdisable = () => {\n\t\tif (!this.disabled) this.disabled = true\n\t\tthis.elements.container.classList.add('gooey-disabled')\n\t\tthis.elements.alphaSlider.disabled = true\n\t\tthis.elements.hueSlider.disabled = true\n\t\tthis.elements.canvas.style.pointerEvents = 'none'\n\t\treturn this\n\t}\n\n\tset(v: ColorValue) {\n\t\tthis.input.state.value.set(v)\n\t\tthis.input.refresh()\n\t\tthis.refresh()\n\t}\n\n\tsetAlpha = (e: InputEvent) => {\n\t\tthis.input.state.value.alpha = Number((e.target as HTMLInputElement).value)\n\t\tthis.input.refresh()\n\t}\n\n\t/**\n\t * Updates the UI to reflect the current state of the color picker.\n\t */\n\trefresh = () => {\n\t\tthis._log.fn('refresh').debug()\n\t\tconst color = this.input.state.value\n\n\t\tif (this._lastColor?.hex === color.hex8String) return this\n\t\tthis._lastColor = color.clone()\n\n\t\tthis.elements.hueSlider.value = String(this.hue)\n\t\tthis.elements.alphaSlider.value = String(this.alpha)\n\t\tthis.elements.alphaSlider.style.color = color.hexString\n\n\t\tthis.draw()\n\n\t\tif (this._lockCursorPosition) {\n\t\t\t// Update the color only.\n\t\t\tthis.elements.handle.style.background = color.hexString\n\t\t\tthis._lockCursorPosition = false\n\t\t} else {\n\t\t\tthis._updateHandle()\n\t\t}\n\n\t\treturn this\n\t}\n\n\tdraw = () => {\n\t\tthis._fill(`hsl(${this.hue}, 100%, 50%)`)\n\t\tthis._fill(this._gradientWhite)\n\t\tthis._fill(this._gradientBlack)\n\t}\n\n\tprivate _fill(style: string | CanvasGradient) {\n\t\tthis._ctx.fillStyle = style\n\t\tthis._ctx.fillRect(0, 0, this.canvas.width, this.canvas.height)\n\t}\n\n\tprivate _updateGradients() {\n\t\tthis._gradientWhite = this._ctx.createLinearGradient(0, 0, this.canvas.width, 0)\n\t\tthis._gradientWhite.addColorStop(0, 'rgba(255,255,255,1)')\n\t\tthis._gradientWhite.addColorStop(1, 'rgba(255,255,255,0)')\n\n\t\tthis._gradientBlack = this._ctx.createLinearGradient(0, 0, 0, this.canvas.height)\n\t\tthis._gradientBlack.addColorStop(0, 'rgba(0,0,0,0)')\n\t\tthis._gradientBlack.addColorStop(1, 'rgba(0,0,0,1)')\n\t}\n\n\t//· Pointer Events ···································································¬\n\n\tprivate _pointerUpClickLatch = false\n\n\tprivate _onPointerDown = (e: PointerEvent) => {\n\t\tthis._log.fn('_onPointerDown').debug()\n\t\tthis._evm.emit('pointerdown')\n\t\tthis._dragging = true\n\t\tthis._updateFromMousePosition(e)\n\n\t\taddEventListener('pointerup', this._onPointerUp, { once: true })\n\t}\n\n\tprivate _onPointerMove = (e: PointerEvent) => {\n\t\tthis._log.fn('_onPointerMove').debug()\n\t\tif (this._dragging) {\n\t\t\tthis._updateFromMousePosition(e)\n\t\t}\n\t}\n\n\tprivate _onPointerUp = () => {\n\t\tthis._log.fn('_onPointerUp').debug()\n\t\tthis._evm.emit('pointerup')\n\t\tthis._dragging = false\n\t\tthis._pointerUpClickLatch = true\n\t}\n\n\tprivate _onClick = (e: MouseEvent) => {\n\t\tthis._log.fn('_onClick')\n\t\tif (this._pointerUpClickLatch) {\n\t\t\tthis._log.debug('Click latch triggered. Aborting.')\n\t\t\tthis._pointerUpClickLatch = false\n\t\t\treturn\n\t\t}\n\t\tthis._log.debug()\n\t\tthis._updateFromMousePosition(e)\n\t\tthis._dragging = false\n\t}\n\n\t/**\n\t * Updates the color picker's state based on the current mouse position.\n\t */\n\tprivate _updateFromMousePosition(e: MouseEvent) {\n\t\tthis._log.fn('_updateFromMousePosition').debug()\n\t\tconst { left, top, width, height } = this.canvas.getBoundingClientRect()\n\t\tconst x = clamp(e.clientX - left, 0, width)\n\t\tconst y = clamp(e.clientY - top, 0, height)\n\n\t\tconst { s, v } = this._getColorAtPosition(x, y)\n\t\tthis.input.state.value.hsv = { h: this.hue, s, v }\n\t\tthis.input.set(this.input.state.value)\n\n\t\tthis._drawHandle(this._getHandlePosition(this.input.state.value))\n\t}\n\t//⌟\n\n\t/**\n\t * Maps canvas `x` and `y` coordinates to their respective `s` and `v` color values.\n\t */\n\tprivate _getColorAtPosition = (x: number, y: number) => {\n\t\tthis._log.fn('_getColorAtPosition').debug()\n\t\tconst { width, height } = this.canvas.getBoundingClientRect()\n\t\tconst r = this.opts.handleSize / 3\n\n\t\treturn {\n\t\t\ts: mapRange(x, r, width - r, 0, 100),\n\t\t\tv: mapRange(y, r, height - r, 100, 0),\n\t\t}\n\t}\n\n\tprivate _updateStateFromHue = (e: Event) => {\n\t\tthis._log.fn('_updateStateFromHue').debug()\n\t\tthis._lockCursorPosition = true\n\n\t\tconst hue = Number((e.target as HTMLInputElement).value)\n\n\t\tconst { s, v, a } = this.input.state.value.hsva\n\t\tthis.input.state.value.hsva = { h: hue, s, v, a }\n\t\tthis.input.set(this.input.state.value)\n\n\t\tthis.elements.handle.style.background = this.input.state.value.hexString\n\n\t\tthis.draw()\n\t}\n\n\tprivate _updateHandle = (color = this.input.state.value) => {\n\t\tthis._drawHandle(this._getHandlePosition(color))\n\t}\n\n\t/**\n\t * Get the current handle position for a given color.\n\t */\n\tprivate _getHandlePosition = (color: Color) => {\n\t\tconst { width, height } = this.canvas.getBoundingClientRect()\n\t\tconst r = this.opts.handleSize / 2\n\n\t\treturn {\n\t\t\tx: mapRange(color.hsv.s, 0, 100, r, width - r),\n\t\t\ty: mapRange(color.hsv.v, 0, 100, height - r, r),\n\t\t}\n\t}\n\n\tprivate _drawHandle = (coords: { x: number; y: number }) => {\n\t\tthis.elements.handle.style.transform = `translate(${coords.x}px, ${coords.y}px)`\n\t\tthis.elements.handle.style.background = this.input.state.value.hexString\n\t}\n\n\tdispose() {\n\t\tthis._ctx = null!\n\n\t\tthis.elements.alphaSlider.remove()\n\t\tthis.elements.hueSlider.remove()\n\t\tthis.elements.handle.remove()\n\t\tthis.elements.canvas.remove()\n\t\tthis.elements.container.remove()\n\n\t\tthis._resizeObserver.disconnect()\n\n\t\tthis._evm.dispose()\n\t}\n}\n"],"names":[],"mappings":"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"}