{"version":3,"file":"Gooey.js","sources":["../../../src/Gooey.ts"],"sourcesContent":["import type { WindowInstance, WindowManagerOptions } from './shared/WindowManager'\nimport type { Theme, ThemeMode } from './styles/themer/types'\nimport type { ThemerOptions } from './styles/themer/Themer'\nimport type { FolderOptions, FolderPreset } from './Folder'\nimport type { ResizableOptions } from './shared/resizable'\nimport type { DraggableOptions } from './shared/draggable'\nimport type { PrimitiveState } from './shared/state'\nimport type { Placement } from './shared/place'\nimport type { Commit } from './UndoManager'\n\nimport theme_default from './styles/themes/default'\nimport theme_scout from './styles/themes/scout'\nimport theme_flat from './styles/themes/flat'\nimport style from './styles/gooey.css'\n\nimport { WindowManager, WINDOWMANAGER_DEFAULTS } from './shared/WindowManager'\nimport { deepMergeOpts } from './shared/deepMergeOpts'\nimport { resolveOpts } from './shared/resolveOpts'\nimport { PresetManager } from './PresetManager'\nimport { Themer } from './styles/themer/Themer'\nimport settingsIcon from './svg/settings-icon'\nimport { GUI_VARS } from './styles/GOOEY_VARS'\nimport { UndoManager } from './UndoManager'\nimport { select } from './shared/select'\nimport { nanoid } from './shared/nanoid'\nimport { Logger } from './shared/logger'\nimport { create } from './shared/create'\nimport { state } from './shared/state'\nimport { place } from './shared/place'\nimport { isSafari } from './shared/ua'\nimport { Folder } from './Folder'\nimport { o } from './shared/l'\n\n//Â· Types Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â¬\n\ntype GooeyTheme = 'default' | 'flat' | 'scour' | (string & {})\n\nexport interface GooeyElements {\n\troot: HTMLElement\n}\n\nexport interface GooeyOptions {\n\t__type: 'GooeyOptions'\n\n\t/**\n\t * The title of the Gooey.\n\t * @default 'gooey'\n\t */\n\ttitle: string\n\n\t/**\n\t * Defines which properties to persist in localStorage, and under which\n\t * key, if any.  If `true`, the {@link GUI_STORAGE_DEFAULTS} will be used.\n\t * If `false`, no state will be persisted.\n\t * @default true\n\t */\n\tstorage: boolean | Partial<GooeyStorageOptions>\n\n\t/**\n\t * The container to append the gooey to.\n\t * @default 'body'\n\t */\n\t// container: HTMLElement\n\tcontainer: string | HTMLElement | 'document' | 'body'\n\n\t/**\n\t * Whether the gooey is draggable.\n\t * @default true\n\t */\n\tdraggable: boolean\n\n\t/**\n\t * Whether the gooey is resizable.\n\t * @default true\n\t */\n\tresizable: boolean\n\n\t/**\n\t * The title of the theme to use for the gooey.  To add your own themes,\n\t * use {@link themerOptions.themes}.\n\t * @default 'default'\n\t */\n\ttheme: GooeyTheme\n\n\t/**\n\t * The themes available to the gooey.\n\t * @defaultValue [ {@link theme_default|default}, {@link theme_flat|flat}, {@link theme_scout|scout} ]\n\t */\n\tthemes: Theme[]\n\n\t/**\n\t * The initial {@link Themer.mode|theme mode}.\n\t * @default 'dark'\n\t */\n\tthemeMode: 'light' | 'dark' | 'system'\n\n\t/**\n\t * The gooey's initial position on the screen.  If `undefined`, the gooey will\n\t * be placed in the top-right corner of the screen.\n\t *\n\t * This value can either be a {@link Placement} string, or an object with\n\t * `x` and `y` properties representing the position in pixels.\n\t * @default 'top-right'\n\t */\n\tposition: Placement | { x: number; y: number }\n\n\t/**\n\t * The margin in pixels to apply to the placement.  Can be a number\n\t * to apply the same margin to both x and y, or an object with x\n\t * and y properties to apply different margins to each axis.\n\t * @default 16\n\t */\n\tmargin: number | { x?: number; y?: number }\n\n\t/**\n\t * The initial width of the gooey in pixels.\n\t *\n\t * @remakrs This can also be set by overriding the `--gooey-root_width` CSS custom property on\n\t * the {@link Gooey.element} element `.gooey-root`, which is responsible for the root width.\n\t * @default undefined\n\t */\n\twidth?: number\n\n\t/**\n\t * The initial expanded state of the gooey.\n\t * @default false\n\t */\n\tclosed: boolean\n\n\t/**\n\t * Presets to make available in the gooey.\n\t * @default []\n\t */\n\tpresets?: GooeyPreset[]\n\n\t/**\n\t * The default preset to load when the gooey is created, or the initial gooey state if undefined.\n\t * @default undefined\n\t */\n\tdefaultPreset?: GooeyPreset\n\n\t/**\n\t * A unique id for the gooey's root element.\n\t * @default {@link nanoid}\n\t */\n\tid?: string\n\n\t/**\n\t * Whether to load the default font for use.  Set to `false` if you're overwriting\n\t * the `--fragcui-font` variable in your theme.\n\t * @default true\n\t */\n\tloadDefaultFont?: boolean\n\n\t/**\n\t * @internal\n\t */\n\t_windowManager?: WindowManager\n\n\t/**\n\t * @internal\n\t */\n\t_themer?: Themer\n}\n\nexport interface GooeyStorageOptions {\n\t__type: 'GooeyStorageOptions'\n\n\t/**\n\t * Prefix to use for localStorage keys.\n\t * @default `\"fractils::gooey\"`\n\t */\n\tkey: string\n\n\t/**\n\t * Whether to persist the folder's expanded state.\n\t * @default true\n\t */\n\tclosed?: boolean\n\n\t/**\n\t * Whether to persist the theme.\n\t * @default true\n\t */\n\ttheme?: boolean\n\n\t/**\n\t * Whether to persist the gooey's position.\n\t * @default true\n\t */\n\tposition?: boolean\n\n\t/**\n\t * Whether to persist the gooey's size.\n\t * @default true\n\t */\n\tsize?: boolean\n\n\t/**\n\t * Whether to persist the gooey's presets.\n\t * @default true\n\t */\n\tpresets?: boolean\n}\n\nexport interface GooeyPreset {\n\t__type: 'GooeyPreset'\n\t__version: number\n\tid: string\n\ttitle: string\n\tdata: FolderPreset\n}\n//âŒŸ\n\n//Â· Constants Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â¬\n\nexport const GUI_STORAGE_DEFAULTS: GooeyStorageOptions = {\n\t__type: 'GooeyStorageOptions',\n\tkey: 'gooey',\n\tclosed: true,\n\ttheme: true,\n\tpresets: true,\n\tposition: true,\n\tsize: true,\n} as const\n\nexport const GUI_WINDOWMANAGER_DEFAULTS = {\n\t__type: 'WindowManagerOptions',\n\tpreserveZ: false,\n\tzFloor: 0,\n\tbounds: undefined,\n\tobstacles: undefined,\n\tresizable: {\n\t\tgrabberSize: 9,\n\t\tcolor: 'var(--bg-d)',\n\t\tsides: ['right', 'left'],\n\t\tcorners: [],\n\t},\n\tdraggable: {\n\t\tbounds: undefined,\n\t\tclasses: {\n\t\t\tdefault: 'gooey-draggable',\n\t\t\tdragging: 'gooey-dragging',\n\t\t\tcancel: 'gooey-cancel',\n\t\t\tdragged: 'gooey-dragged',\n\t\t},\n\t},\n} as const satisfies WindowManagerOptions\n\nexport const GUI_DEFAULTS = {\n\t__type: 'GooeyOptions',\n\ttitle: 'gooey',\n\tstorage: true,\n\tclosed: false,\n\tposition: 'top-right',\n\tmargin: 16,\n\tcontainer: 'body',\n\ttheme: 'default',\n\tthemeMode: 'dark',\n\tthemes: [theme_default, theme_flat, theme_scout],\n\tresizable: true,\n\tdraggable: true,\n\tloadDefaultFont: true,\n} as const satisfies GooeyOptions\n//âŒŸ\n\n/**\n * The root Gooey instance.  This is the entry point for creating\n * a gooey.  You can create multiple root gooeys, but each gooey\n * can only have one root.\n */\nexport class Gooey {\n\t__type = 'Gooey' as const\n\n\tid = nanoid()\n\tfolder: Folder\n\n\tdeclare elements: GooeyElements\n\n\t/**\n\t * The initial options passed to the gooey.\n\t */\n\topts: GooeyOptions & { storage: GooeyStorageOptions | false }\n\n\t/**\n\t * Whether the gooey root folder is currently collapsed.\n\t */\n\tclosed: PrimitiveState<boolean>\n\n\t/**\n\t * The {@link PresetManager} instance for the gooey.\n\t */\n\tpresetManager!: PresetManager\n\n\t/**\n\t * Whether any of the inputs have been changed from their default values in the active preset.\n\t */\n\tdirty = false\n\n\twrapper!: HTMLElement\n\tcontainer!: HTMLElement\n\tsettingsFolder: Folder\n\tstatic settingsFolderTitle = 'gooey-settings-folder'\n\n\t/**\n\t * The {@link UndoManager} instance for the gooey, handling undo/redo functionality.\n\t * @internal\n\t */\n\t_undoManager = new UndoManager()\n\n\tthemer: Themer\n\t// themeEditor?: ThemeEditor\n\twindowManager?: WindowManager\n\n\tprivate static _initialized = false\n\t/**\n\t * `false` if this {@link Gooey}'s {@link WindowManager} belongs to an existing, external\n\t * instance _(i.e. a separate {@link Gooey} instance or custom {@link WindowManager})_.  The\n\t * {@link WindowManager} will be disposed when this {@link Gooey} is disposed.\n\t * @internal\n\t */\n\tprivate _isWindowManagerOwner = false\n\t/**\n\t * The time of the gooey's creation.\n\t * @internal\n\t */\n\tprivate readonly _birthday = Date.now()\n\t/**\n\t * The number of milliseconds post-instantiation to watch for adders for repositioning.\n\t * @internal\n\t */\n\tprivate _honeymoon: false | 1000 = 1000\n\tprivate _theme!: GooeyOptions['theme']\n\tprivate _log: Logger\n\n\t// Forwarding the Folder API...\n\ton: Folder['on']\n\taddFolder(title: string, options?: Partial<FolderOptions>) {\n\t\tif (this._honeymoon && this._birthday - Date.now() < 1000) {\n\t\t\tthis._honeymoon = false\n\t\t\tthis._reveal(true)\n\t\t}\n\n\t\treturn this.folder.addFolder(title, {\n\t\t\t...options,\n\t\t\t// @ts-expect-error @internal\n\t\t\tgooey: this,\n\t\t})\n\t}\n\tbind: Folder['bind']\n\tbindMany: Folder['bindMany']\n\tadd: Folder['add']\n\taddMany: Folder['addMany']\n\taddButtonGrid: Folder['addButtonGrid']\n\taddSelect: Folder['addSelect']\n\taddButton: Folder['addButton']\n\taddText: Folder['addText']\n\taddNumber: Folder['addNumber']\n\taddSwitch: Folder['addSwitch']\n\taddColor: Folder['addColor']\n\n\tconstructor(options?: Partial<GooeyOptions>) {\n\t\t//Â· Setup Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â¬\n\n\t\tif (!Gooey._initialized && globalThis.document) {\n\t\t\tGooey._initialized = true\n\t\t\tconst sheet = new CSSStyleSheet()\n\t\t\tsheet.replaceSync(style)\n\t\t\tglobalThis.document.adoptedStyleSheets.push(sheet)\n\t\t}\n\n\t\tconst opts = deepMergeOpts([GUI_DEFAULTS, options ?? {}], {\n\t\t\tconcatArrays: false,\n\t\t}) as GooeyOptions\n\n\t\topts.container ??= document.body\n\n\t\tlet reposition = false\n\t\t/** Resolve storage separately since {@link GUI_DEFAULTS.storage} is `false`.  */\n\n\t\tif (typeof opts.storage === 'object') {\n\t\t\topts.storage = Object.assign({}, GUI_STORAGE_DEFAULTS, opts.storage)\n\t\t}\n\n\t\tconst storageOpts = resolveOpts(opts.storage, GUI_STORAGE_DEFAULTS)\n\t\tif (storageOpts) {\n\t\t\topts.storage = {\n\t\t\t\t...storageOpts,\n\t\t\t\tkey: `${storageOpts.key}::${opts.title?.toLowerCase().replaceAll(/\\s/g, '-')}`,\n\t\t\t}\n\t\t\t// When storage is on, repositioning after animating-in is disabled unless this is the\n\t\t\t// _very_ first page load.\n\t\t\tif (!(`${opts.storage.key}::wm::0::position` in localStorage)) {\n\t\t\t\treposition = true\n\t\t\t}\n\t\t} else {\n\t\t\treposition = true\n\t\t}\n\n\t\tthis.opts = opts as GooeyOptions & { storage: GooeyStorageOptions | false }\n\n\t\tthis._log = new Logger(`Gooey ${this.opts.title}`, { fg: 'palevioletred' })\n\t\tthis._log.fn('constructor').info({ options, opts })\n\n\t\tif (this.opts.loadDefaultFont !== false) {\n\t\t\tconst ff = new FontFace(\n\t\t\t\t'fredoka',\n\t\t\t\t`url(${encodeURI?.(\n\t\t\t\t\t'https://cdn.jsdelivr.net/fontsource/fonts/fredoka:vf@latest/latin-wdth-normal.woff2',\n\t\t\t\t)})`,\n\t\t\t\t{\n\t\t\t\t\tstyle: 'normal',\n\t\t\t\t\tdisplay: 'swap',\n\t\t\t\t\tweight: '300 700',\n\t\t\t\t\tstretch: '75% 125%',\n\t\t\t\t\tunicodeRange:\n\t\t\t\t\t\t'U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD',\n\t\t\t\t},\n\t\t\t)\n\n\t\t\tff.load().then(font => {\n\t\t\t\t// @ts-expect-error - Â¯\\_(ãƒ„)_/Â¯\n\t\t\t\tdocument.fonts.add(font)\n\t\t\t})\n\t\t}\n\n\t\tthis.container = select(this.opts.container)[0]\n\n\t\tthis.wrapper = create('div', {\n\t\t\tclasses: ['gooey-wrapper'],\n\t\t\tstyle: {\n\t\t\t\tdisplay: 'contents',\n\t\t\t},\n\t\t\tparent: this.container,\n\t\t})\n\n\t\tthis.folder = new Folder({\n\t\t\t...this.opts,\n\t\t\t__type: 'FolderOptions',\n\t\t\tcontainer: this.wrapper,\n\t\t\t// @ts-expect-error @internal\n\t\t\tgooey: this,\n\t\t})\n\n\t\t// Not stoked about this.\n\t\tthis.on = this.folder.on.bind(this.folder)\n\t\t// this.addFolder = this.folder.addFolder.bind(this.folder)\n\t\tthis.bind = this.folder.bind.bind(this.folder)\n\t\tthis.bindMany = this.folder.bindMany.bind(this.folder)\n\t\tthis.add = this.folder.add.bind(this.folder)\n\t\tthis.addMany = this.folder.addMany.bind(this.folder)\n\t\tthis.addButtonGrid = this.folder.addButtonGrid.bind(this.folder)\n\t\tthis.addSelect = this.folder.addSelect.bind(this.folder)\n\t\tthis.addButton = this.folder.addButton.bind(this.folder)\n\t\tthis.addText = this.folder.addText.bind(this.folder)\n\t\tthis.addNumber = this.folder.addNumber.bind(this.folder)\n\t\tthis.addSwitch = this.folder.addSwitch.bind(this.folder)\n\t\tthis.addColor = this.folder.addColor.bind(this.folder)\n\n\t\tconst handleUndoRedo = (e: KeyboardEvent) => {\n\t\t\tif (globalThis.navigator?.userAgent?.match(/mac/i)) {\n\t\t\t\tif (e.metaKey && e.key === 'z') {\n\t\t\t\t\te.preventDefault()\n\t\t\t\t\te.shiftKey ? this._undoManager.redo() : this._undoManager.undo()\n\t\t\t\t}\n\t\t\t} else if (e.ctrlKey) {\n\t\t\t\tif (e.key === 'z') {\n\t\t\t\t\te.preventDefault()\n\t\t\t\t\tthis._undoManager.undo()\n\t\t\t\t}\n\n\t\t\t\tif (e.key === 'y') {\n\t\t\t\t\te.preventDefault()\n\t\t\t\t\tthis._undoManager.redo()\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tremoveEventListener('keydown', handleUndoRedo)\n\t\taddEventListener('keydown', handleUndoRedo)\n\t\t//âŒŸ\n\n\t\tthis.closed = state(!!this.opts.closed, {\n\t\t\tkey: this.opts.storage ? `${this.opts.storage.key}::closed` : undefined,\n\t\t})\n\n\t\tthis.folder.elements.toolbar.settingsButton = this._createSettingsButton(\n\t\t\tthis.folder.elements.toolbar.container,\n\t\t)\n\n\t\tthis.settingsFolder = this.addFolder(Gooey.settingsFolderTitle, {\n\t\t\tclosed: true,\n\t\t\t// @ts-expect-error @internal\n\t\t\t_headerless: true,\n\t\t})\n\t\tthis.settingsFolder.element.classList.add('gooey-folder-alt')\n\n\t\tthis.themer = this.opts._themer ?? this._createThemer(this.settingsFolder)\n\t\tthis.theme = this.opts.theme\n\t\tthis.presetManager = this._createPresetManager(this.settingsFolder)\n\n\t\tthis.windowManager ??= this._createWindowManager(this.opts, this.opts.storage)\n\n\t\t// Give the user a chance to add folders / inputs before positioning.\n\t\tthis._reveal(reposition)\n\n\t\treturn this\n\t}\n\n\tprivate async _reveal(reposition: boolean) {\n\t\t// In case dispose() was called before this resolved...\n\t\tif (!this.container) return\n\n\t\t// Append a non-animating, full-size clone to get the proper rect.\n\t\tconst ghost = this.wrapper.cloneNode(true) as HTMLElement\n\t\tghost.style.visibility = 'hidden'\n\t\tthis.container.prepend(ghost)\n\n\t\t// This is the only way to get the correct future rect afaik ðŸ˜…\n\t\tconst rect = ghost.children[0].getBoundingClientRect()\n\n\t\tghost.remove()\n\n\t\tif (typeof this.opts.position === 'string') {\n\t\t\tconst placementPosition = place(rect, this.opts.position, {\n\t\t\t\tbounds: this.opts.container,\n\t\t\t\tmargin: this.opts.margin,\n\t\t\t})\n\n\t\t\t// Use the rect to correct the window manager's positioning when storage is off.\n\t\t\tif (reposition || (this.opts.storage && this.opts.storage.position === false)) {\n\t\t\t\tconst win = this.window\n\t\t\t\tif (win?.draggableInstance) {\n\t\t\t\t\twin.draggableInstance.position = placementPosition\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Now that we're in position and inputs are loaded, we can animate-in.\n\t\tthis.container.appendChild(this.wrapper)\n\t\tthis.folder.element.animate([{ opacity: 0 }, { opacity: 1 }], {\n\t\t\tfill: 'none',\n\t\t\tduration: 400,\n\t\t})\n\n\t\t// Ugly hack to force repaint on Safari to workaround its buggy ass blur filter...\n\t\tif (isSafari()) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.folder.element.style.display = 'table'\n\t\t\t\tthis.folder.element.offsetHeight\n\t\t\t\tthis.folder.element.style.display = 'flex'\n\t\t\t}, 500)\n\t\t}\n\t}\n\n\tprivate _createPresetManager(settingsFolder: Folder) {\n\t\tconst { presets, defaultPreset, storage } = this.opts\n\t\tlet localStorageKey: string | undefined\n\t\tif (typeof storage === 'object' && storage.presets) {\n\t\t\tlocalStorageKey = storage.key + '::presets'\n\t\t}\n\n\t\treturn new PresetManager(this, settingsFolder, {\n\t\t\tpresets,\n\t\t\tdefaultPreset,\n\t\t\tlocalStorageKey,\n\t\t})\n\t}\n\n\tprivate _createWindowManager(\n\t\toptions: Partial<GooeyOptions>,\n\t\tstorageOpts: typeof this.opts.storage,\n\t) {\n\t\tif (this.windowManager) return this.windowManager // ??\n\n\t\tlet dragOpts = undefined as Partial<DraggableOptions> | undefined\n\t\tif (this.opts.draggable) {\n\t\t\tdragOpts = Object.assign({}, GUI_WINDOWMANAGER_DEFAULTS.draggable)\n\t\t\tdragOpts.handle = this.folder.elements.header\n\t\t\tdragOpts.position = this.opts.position\n\t\t\tdragOpts.localStorageKey = storageOpts && storageOpts.key ? storageOpts.key : undefined\n\t\t\tdragOpts.bounds = this.container\n\t\t\tif (storageOpts && storageOpts.position === false) {\n\t\t\t\tdragOpts.localStorageKey = undefined\n\t\t\t}\n\t\t}\n\n\t\tlet resizeOpts = undefined as Partial<ResizableOptions> | undefined\n\t\tif (this.opts.resizable) {\n\t\t\tresizeOpts = Object.assign({}, GUI_WINDOWMANAGER_DEFAULTS.resizable)\n\t\t\tresizeOpts.bounds = this.container\n\t\t\tresizeOpts.localStorageKey =\n\t\t\t\tstorageOpts && storageOpts.key ? storageOpts.key : undefined\n\t\t\tif (storageOpts && storageOpts.size === false) {\n\t\t\t\tresizeOpts.localStorageKey = undefined\n\t\t\t}\n\t\t}\n\n\t\t// Use the provided window manager if it's an instance.\n\t\tif (options?._windowManager instanceof WindowManager) {\n\t\t\tconst windowManager = options._windowManager\n\n\t\t\twindowManager.add(this.folder.element, {\n\t\t\t\tid: this.id,\n\t\t\t\tresizable: resizeOpts,\n\t\t\t\tdraggable: dragOpts,\n\t\t\t})\n\n\t\t\treturn windowManager\n\t\t}\n\n\t\tconst windowManagerOpts = resolveOpts<WindowManagerOptions>(\n\t\t\t{\n\t\t\t\t...GUI_WINDOWMANAGER_DEFAULTS,\n\t\t\t\tdraggable: dragOpts,\n\t\t\t\tresizable: resizeOpts,\n\t\t\t},\n\t\t\tWINDOWMANAGER_DEFAULTS,\n\t\t)\n\n\t\tthis._log\n\t\t\t.fn('_createWindowManager')\n\t\t\t.info({ windowManagerOpts, options, opts: this.opts, dragOpts, resizeOpts })\n\n\t\tconst windowManager = new WindowManager({\n\t\t\t...windowManagerOpts,\n\t\t\tdraggable: dragOpts,\n\t\t\tresizable: resizeOpts,\n\t\t})\n\t\tthis._isWindowManagerOwner = true\n\n\t\twindowManager.add(this.folder.element, {\n\t\t\tid: this.id,\n\t\t\t// The rest of the options will inherit from the WindowManager instance.\n\t\t})\n\n\t\treturn windowManager\n\t}\n\n\tget inputs() {\n\t\treturn this.folder.inputs\n\t}\n\tget allInputs() {\n\t\t// todo - Don't love this..\n\t\treturn new Map(\n\t\t\t[...this.folder.allInputs.entries()].filter(\n\t\t\t\t([k]) => !k.startsWith('ui') && !k.startsWith('presets'),\n\t\t\t),\n\t\t)\n\t}\n\n\tget window(): WindowInstance | undefined {\n\t\treturn this.windowManager?.windows.get(this.folder.element.id)\n\t}\n\n\tset theme(theme: GooeyTheme) {\n\t\tthis._theme = theme\n\t\tthis.folder.element.setAttribute('theme', theme)\n\t\tthis.folder.element.setAttribute('mode', this.themer.mode.value)\n\t}\n\tget theme() {\n\t\treturn this._theme!\n\t}\n\n\t/**\n\t * Saves the current gooey state as a preset.\n\t */\n\tsave(\n\t\t/**\n\t\t * The title of the preset.\n\t\t */\n\t\ttitle: string,\n\t\t/**\n\t\t * A unique id for the preset.\n\t\t * @defaultValue {@link nanoid|nanoid(10)}\n\t\t */\n\t\tid = nanoid(10),\n\t) {\n\t\tconst preset: GooeyPreset = {\n\t\t\t__type: 'GooeyPreset',\n\t\t\t__version: 0,\n\t\t\tid,\n\t\t\ttitle,\n\t\t\tdata: this.folder.save(),\n\t\t} as const\n\n\t\treturn preset\n\t}\n\n\t/**\n\t * Loads a given preset into the gooey, updating all inputs.\n\t */\n\tload(preset: GooeyPreset) {\n\t\tthis._log.fn('load').info({ preset })\n\n\t\t// todo - this isn't working, it's being unset immediately somewhere...\n\t\tthis.dirty = false\n\n\t\tthis.lockCommits(preset)\n\t\tthis.folder.load(preset.data)\n\t\tPromise.resolve().then(() => this.unlockCommits())\n\t}\n\n\t_undoLock = false\n\tlockCommit: { from: GooeyPreset | undefined } = { from: undefined }\n\n\t/**\n\t * Commits a change to the input's value to the undo manager.\n\t */\n\tcommit(commit: Partial<Commit>) {\n\t\tif (this._undoLock) {\n\t\t\tthis._log.fn('commit').info('LOCKED: prevented commit while locked')\n\t\t\treturn\n\t\t}\n\t\tthis._log.fn('commit').info('commited', commit)\n\t\tthis._undoManager?.commit(commit as Commit)\n\t}\n\n\t/**\n\t * Prevents the input from registering undo history, storing the initial\n\t * for the eventual commit in {@link unlockCommits}.\n\t */\n\tprivate lockCommits = (from: GooeyPreset) => {\n\t\tthis._undoManager.lockedExternally = true\n\t\tthis.lockCommit.from = from\n\t\tthis._log.fn(o('lock')).info('commit', { from, lockCommit: this.lockCommit })\n\t}\n\n\t/**\n\t * Unlocks commits and saves the current commit stored in lock.\n\t */\n\tprivate unlockCommits = (commit?: Partial<Commit>) => {\n\t\tcommit ??= {}\n\t\tcommit.target ??= this as any\n\t\tcommit.from ??= this.lockCommit.from\n\n\t\tthis._undoManager.lockedExternally = false\n\t\tthis.commit(commit)\n\n\t\tthis._log.fn(o('unlock')).info('commit', { commit, lockCommit: this.lockCommit })\n\t}\n\n\tprivate _createThemer(folder: Folder) {\n\t\tthis._log.fn('createThemer').info({ folder })\n\t\tlet finalThemer = undefined as Themer | undefined\n\t\tconst themer = this.opts._themer\n\t\tconst themerOptions: Partial<ThemerOptions> = {\n\t\t\tlocalStorageKey: this.opts.storage ? this.opts.storage.key + '::themer' : undefined,\n\t\t\tmode: this.opts.themeMode,\n\t\t\tautoInit: !this.themer,\n\t\t\tpersistent: !!(this.opts.storage && this.opts.storage.theme),\n\t\t\tthemes: this.opts.themes,\n\t\t\ttheme: this.opts.themes.find(t => t.title === this.opts.theme),\n\t\t\tvars: GUI_VARS,\n\t\t}\n\t\tthemerOptions.vars = deepMergeOpts([GUI_VARS, themerOptions.vars])\n\n\t\tif (themer) {\n\t\t\tfinalThemer = themer\n\t\t} else {\n\t\t\tthemerOptions.wrapper = this.wrapper\n\t\t\tfinalThemer = new Themer(this.folder.element, themerOptions)\n\t\t}\n\n\t\tconst uiFolder = folder.addFolder('ui', { closed: true })\n\n\t\t// Fully desaturate the ui folder's header connector to svg.\n\t\tuiFolder.on('mount', () => {\n\t\t\tuiFolder.graphics?.connector?.svg.style.setProperty('filter', 'saturate(0.1)')\n\t\t\tuiFolder.graphics?.icon.style.setProperty('filter', 'saturate(0)')\n\t\t})\n\n\t\tif (folder) {\n\t\t\tuiFolder.addSelect<Theme>({\n\t\t\t\ttitle: 'theme',\n\t\t\t\tlabelKey: 'title',\n\t\t\t\toptions: finalThemer.themes.value,\n\t\t\t\tbinding: {\n\t\t\t\t\ttarget: finalThemer,\n\t\t\t\t\tkey: 'theme',\n\t\t\t\t},\n\t\t\t})\n\n\t\t\tuiFolder.addButtonGrid({\n\t\t\t\ttitle: 'mode',\n\t\t\t\tactiveOnClick: true,\n\t\t\t\tvalue: [\n\t\t\t\t\t['light', 'dark', 'system'].map(m => ({\n\t\t\t\t\t\ttext: m,\n\t\t\t\t\t\tonClick: () => finalThemer?.mode.set(m as ThemeMode),\n\t\t\t\t\t\tactive: () => finalThemer?.mode.value === m,\n\t\t\t\t\t})),\n\t\t\t\t],\n\t\t\t})\n\t\t}\n\n\t\treturn finalThemer\n\t}\n\n\tprivate _createSettingsButton(parent: HTMLElement) {\n\t\tconst button = create<'button', any, HTMLButtonElement>('button', {\n\t\t\tparent,\n\t\t\tclasses: ['gooey-toolbar-item', 'gooey-settings-button'],\n\t\t\tinnerHTML: settingsIcon,\n\t\t\ttooltip: {\n\t\t\t\ttext: () => {\n\t\t\t\t\treturn this.settingsFolder?.closed.value ? 'Open Settings' : 'Close Settings'\n\t\t\t\t},\n\t\t\t\tplacement: 'left',\n\t\t\t\tdelay: 750,\n\t\t\t\tdelayOut: 0,\n\t\t\t\thideOnClick: true,\n\t\t\t},\n\t\t})\n\n\t\tbutton.addEventListener('click', () => {\n\t\t\tthis.settingsFolder.toggle()\n\n\t\t\tthis.folder.elements.toolbar.settingsButton?.classList.toggle(\n\t\t\t\t'open',\n\t\t\t\t!this.settingsFolder.closed.value,\n\t\t\t)\n\t\t})\n\n\t\treturn button\n\t}\n\n\tdispose = () => {\n\t\tthis._log.fn('dispose').info(this)\n\t\tthis.themer?.dispose()\n\t\t// this.themeEditor?.dispose()\n\t\tif (this._isWindowManagerOwner) {\n\t\t\tthis.windowManager?.dispose()\n\t\t\tthis.container?.remove()\n\t\t}\n\t\tthis.settingsFolder?.dispose()\n\t\tthis.folder?.dispose()\n\t}\n}\n"],"names":[],"mappings":"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"}