{"version":3,"file":"InputText.js","sources":["../../../../src/inputs/InputText.ts"],"sourcesContent":["import type { ElementMap, InputOptions } from './Input'\nimport type { State } from '../shared/state'\nimport type { Folder } from '../Folder'\n\nimport { textController } from '../controllers/text'\nimport { create } from '../shared/create'\nimport { Logger } from '../shared/logger'\nimport { state } from '../shared/state'\nimport { Input } from './Input'\n\nexport type TextInputOptions = InputOptions<string> & {\n\treadonly __type?: 'TextInputOptions'\n\t/**\n\t * The maximum number of characters that can be entered.\n\t * @default 50\n\t */\n\tmaxLength?: number\n}\n\nexport const TEXT_INPUT_DEFAULTS = {\n\t__type: 'TextInputOptions' as const,\n\tvalue: 'foo',\n\tmaxLength: 50,\n} as const satisfies TextInputOptions\n\nexport interface TextControllerElements extends ElementMap {\n\tcontainer: HTMLElement\n\tinput: HTMLInputElement\n}\n\nexport class InputText extends Input<string, TextInputOptions, TextControllerElements> {\n\treadonly __type = 'InputText' as const\n\treadonly initialValue: string\n\treadonly state: State<string>\n\n\t#log: Logger\n\n\tconstructor(options: Partial<TextInputOptions>, folder: Folder) {\n\t\tconst opts = Object.assign({}, TEXT_INPUT_DEFAULTS, options)\n\t\tsuper(opts, folder)\n\n\t\tthis.#log = new Logger(`InputText ${opts.title}`, { fg: 'cyan' })\n\t\tthis.#log.fn('constructor').debug({ opts, this: this })\n\n\t\tif (opts.binding) {\n\t\t\tthis.initialValue = opts.binding.target[opts.binding.key]\n\t\t\tthis.state = state(this.initialValue)\n\n\t\t\tthis._evm.add(\n\t\t\t\tthis.state.subscribe(v => {\n\t\t\t\t\topts.binding!.target[opts.binding!.key] = v\n\t\t\t\t}),\n\t\t\t)\n\t\t} else {\n\t\t\tthis.initialValue = opts.value!\n\t\t\tthis.state = state(opts.value!)\n\t\t}\n\n\t\tconst container = create('div', {\n\t\t\tclasses: ['gooey-input-text-container'],\n\t\t\tparent: this.elements.content,\n\t\t})\n\n\t\tthis.elements.controllers = {\n\t\t\tcontainer,\n\t\t\tinput: textController(this, opts, container),\n\t\t} as const satisfies TextControllerElements\n\n\t\tthis._evm.listen(this.elements.controllers.input, 'input', this.set)\n\n\t\tthis._evm.add(\n\t\t\tthis.state.subscribe(() => {\n\t\t\t\tthis.refresh()\n\t\t\t}),\n\t\t)\n\t}\n\n\tenable() {\n\t\tsuper.enable()\n\t\tthis.elements.controllers.input.disabled = false\n\t\treturn this\n\t}\n\tdisable() {\n\t\tsuper.disable()\n\t\tthis.elements.controllers.input.disabled = true\n\t\treturn this\n\t}\n\n\tset = (v?: string | Event) => {\n\t\tif (typeof v === 'undefined') return\n\n\t\tif (typeof v !== 'string') {\n\t\t\tif (v?.target && 'value' in v.target) {\n\t\t\t\tthis.commit({ to: v.target.value as string })\n\t\t\t\tthis.state.set(v.target.value as string)\n\t\t\t}\n\t\t} else {\n\t\t\tthis.commit({ to: v })\n\t\t\tthis.state.set(v)\n\t\t}\n\n\t\tthis._emit('change', this.state.value)\n\t\treturn this\n\t}\n\n\trefresh = () => {\n\t\tconst v = this.state.value\n\t\tthis.elements.controllers.input.value = v\n\t\tsuper.refresh(v)\n\t\treturn this\n\t}\n\n\tdispose() {\n\t\tsuper.dispose()\n\t}\n}\n"],"names":[],"mappings":"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"}