{"version":3,"file":"InputSelect.js","sources":["../../../../src/inputs/InputSelect.ts"],"sourcesContent":["import type { ElementMap, InputEvents, InputOptions, ValidInputValue } from './Input'\nimport type { LabeledOption } from '../controllers/Select'\nimport type { State } from '../shared/state'\nimport type { Folder } from '../Folder'\n\nimport { isLabeledOption, Select, toLabeledOption, fromLabeledOption } from '../controllers/Select'\nimport { disableable, type Disableable } from '../shared/decorators/disableable-class-decorator'\nimport { fromState, isState, state } from '../shared/state'\nimport { stringify } from '../shared/stringify'\nimport { Logger } from '../shared/logger'\nimport { create } from '../shared/create'\nimport { toFn } from '../shared/toFn'\nimport { Input } from './Input'\n\nexport type SelectInputOptions<T = ValidInputValue> = Omit<\n\tInputOptions<T | { label: string; value: T }>,\n\t'onChange' | 'value'\n> & {\n\t__type?: 'SelectInputOptions'\n\tonChange?: (value: LabeledOption<T>) => void\n} & (\n\t\t| {\n\t\t\t\tlabelKey?: never\n\t\t\t\tvalue?: { label: string; value: T }\n\t\t\t\toptions: { label: string; value: T }[] | (() => { label: string; value: T }[])\n\t\t  }\n\t\t| {\n\t\t\t\tlabelKey: keyof T\n\t\t\t\tvalue?: T\n\t\t\t\toptions: T[] | (() => T[])\n\t\t  }\n\t)\n\nexport const SELECT_INPUT_DEFAULTS: SelectInputOptions = {\n\t__type: 'SelectInputOptions' as const,\n\toptions: [],\n} as const\n\nexport interface SelectControllerElements<T> extends ElementMap {\n\tcontainer: HTMLElement\n\tselect: Select<T>['elements']\n}\n\nexport interface SelectInputEvents<T> extends InputEvents<LabeledOption<T>> {\n\tpreview: LabeledOption<T>\n\topen: void\n\tclose: void\n\tcancel: void\n}\n\nexport interface InputSelect extends Disableable {}\n\n@disableable\nexport class InputSelect<T = unknown> extends Input<\n\tLabeledOption<T>,\n\tSelectInputOptions<T>,\n\tSelectControllerElements<T>,\n\tSelectInputEvents<T>\n> {\n\treadonly __type = 'InputSelect' as const\n\treadonly initialValue: LabeledOption<T>\n\tstate: State<LabeledOption<T>>\n\n\t#options: SelectInputOptions['options']\n\tset options(v: SelectInputOptions['options']) {\n\t\tthis._log.fn('set options').debug(v)\n\t\tthis.#options = toFn(v)\n\n\t\tthis.select.clear()\n\n\t\tfor (const option of this.#options()) {\n\t\t\tthis.select.add(option)\n\t\t}\n\t}\n\tget options(): LabeledOption<T>[] {\n\t\treturn this.resolveOptions(this.#options)\n\t}\n\n\t/**\n\t * The select controller instance.\n\t */\n\tselect: Select<T>\n\n\t/**\n\t * A latch for event propagation. Toggled off everytime an event aborted.\n\t */\n\t#stopPropagation = true\n\n\t/**\n\t * The currently selected option as a labeled option.\n\t */\n\tlabeledSelection: LabeledOption<T>\n\n\tprivate _log: Logger\n\n\tconstructor(options: Partial<SelectInputOptions<T>>, folder: Folder) {\n\t\tconst opts = Object.assign({}, SELECT_INPUT_DEFAULTS as SelectInputOptions<T>, options, {\n\t\t\t__type: 'SelectInputOptions' as const,\n\t\t})\n\n\t\tsuper(opts, folder)\n\n\t\tthis._evm.registerEvents(['preview', 'open', 'close', 'cancel'])\n\n\t\tthis._log = new Logger(`InputSelect ${opts.title}`, { fg: 'slategrey' })\n\t\tthis._log.fn('constructor').debug({ opts, this: this })\n\n\t\topts.value ??= opts.binding?.initial ?? fromState(this.targetValue)\n\t\tthis.initialValue = this.resolveInitialValue(opts)\n\n\t\tthis.labeledSelection = {\n\t\t\tvalue: fromLabeledOption(this.initialValue),\n\t\t\tlabel: this.resolveInitialLabel(this.initialValue, opts),\n\t\t}\n\n\t\tthis.#options = this.opts.options\n\n\t\tthis.state = state(this.initialValue)\n\n\t\tconst container = create('div', {\n\t\t\tclasses: ['gooey-input-select-container'],\n\t\t\tparent: this.elements.content,\n\t\t})\n\n\t\tthis.select = new Select({\n\t\t\t// @ts-expect-error\n\t\t\tinput: this,\n\t\t\tcontainer,\n\t\t\toptions: this.options,\n\t\t\tselected: this.labeledSelection,\n\t\t\ttitle: this.title,\n\t\t})\n\n\t\tthis.elements.controllers = {\n\t\t\tcontainer,\n\t\t\tselect: this.select.elements,\n\t\t} as const satisfies SelectControllerElements<T>\n\n\t\tthis.disabled = opts.disabled ?? false\n\n\t\tthis._evm.add(\n\t\t\tthis.state.subscribe(v => {\n\t\t\t\tif (!this.select.bubble) return\n\n\t\t\t\tif (this.targetObject) {\n\t\t\t\t\tif (isState(this.targetValue)) {\n\t\t\t\t\t\tthis._log\n\t\t\t\t\t\t\t.fn('updating binding')\n\t\t\t\t\t\t\t.debug({ from: this.targetValue.value, to: v.value })\n\t\t\t\t\t\tthis.targetValue.set(v.value)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.targetValue = v.value\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (this.#stopPropagation) {\n\t\t\t\t\tthis.#stopPropagation = false\n\t\t\t\t\tthis._log\n\t\t\t\t\t\t.fn('state.subscribe')\n\t\t\t\t\t\t.debug('Stopped propagation.  Subscribers will not be notified.')\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tthis.set(v)\n\t\t\t}),\n\t\t)\n\n\t\tif (options.onChange) {\n\t\t\tthis._evm.on('change', v => {\n\t\t\t\tthis._log.fn('calling options onChange').debug(v)\n\t\t\t\toptions.onChange?.(toLabeledOption(v))\n\t\t\t})\n\t\t}\n\n\t\t// Bind our state to the select controller.\n\t\tthis.select.on('change', v => {\n\t\t\tthis._log.fn('select.onChange').debug(v)\n\t\t\tif (this.#stopPropagation) return\n\t\t\t// if (!this.bubble) return\n\t\t\t// Make sure the select controller doesn't react to its own changes.\n\t\t\tthis.#stopPropagation = true\n\t\t\tthis.set(v)\n\t\t})\n\n\t\t// todo - bind to options if it's observable ?\n\t\t// if (isState(options.options)) {\n\t\t// \tthis.evm.add(\n\t\t// \t\toptions.options.subscribe(v => {\n\t\t// \t\t\tif (isState(v)) {\n\t\t// \t\t\t\tthis.options = v.value as T[]\n\t\t// \t\t\t}\n\t\t// \t\t}),\n\t\t// \t)\n\t\t// }\n\n\t\tthis.listen(this.select.element, 'preview', () => {\n\t\t\tthis._emit('preview')\n\t\t})\n\t\tthis.listen(this.select.element, 'open', () => {\n\t\t\tthis._emit('open')\n\t\t})\n\t\tthis.listen(this.select.element, 'close', () => {\n\t\t\tthis._emit('close')\n\t\t})\n\t\tthis.listen(this.select.element, 'cancel', () => {\n\t\t\tthis._emit('cancel')\n\t\t})\n\n\t\tthis._dirty = () => this.value.label !== this.initialValue.label\n\n\t\tthis._log.fn('constructor').debug({ this: this })\n\t}\n\n\tresolveOptions(providedOptions: SelectInputOptions['options']): LabeledOption<T>[] {\n\t\tfunction isLabeledOptionsArray(v: any): v is LabeledOption<T>[] {\n\t\t\treturn isLabeledOption(v[0])\n\t\t}\n\n\t\tlet selectOptions = toFn(providedOptions)() as T[] | LabeledOption<T>[]\n\n\t\tif (!isLabeledOptionsArray(selectOptions)) {\n\t\t\tif (!this.opts.labelKey) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t'Recieved unlabeled options with no `labelKey` specified.  Please label your options or provide the `labelKey` to use as a label.',\n\t\t\t\t)\n\t\t\t}\n\n\t\t\treturn selectOptions.map(o => ({\n\t\t\t\tlabel: o[this.opts.labelKey!] as string,\n\t\t\t\tvalue: o,\n\t\t\t}))\n\t\t}\n\n\t\treturn selectOptions\n\t}\n\n\tresolveInitialValue(opts: SelectInputOptions<T>) {\n\t\tconst value = opts.binding ? opts.binding.target[opts.binding.key] : opts.value!\n\t\tconst v = fromState(value)\n\t\tif (!isLabeledOption(v)) {\n\t\t\tif (!opts.labelKey) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t'Cannot resolve initial value.  Please provide a `labelKey` or use labeled options.',\n\t\t\t\t)\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tlabel: v[opts.labelKey],\n\t\t\t\tvalue: v,\n\t\t\t}\n\t\t}\n\n\t\treturn v\n\t}\n\n\tresolveInitialLabel(initialValue: this['initialValue'], opts: SelectInputOptions<T>): string {\n\t\tconst v = isState(initialValue) ? initialValue.value : initialValue\n\n\t\tif (isLabeledOption(v)) {\n\t\t\treturn v.label\n\t\t}\n\n\t\tif (opts.labelKey) {\n\t\t\treturn initialValue[opts.labelKey as keyof this['initialValue']] as string\n\t\t}\n\n\t\treturn stringify(v)\n\t}\n\n\tget targetObject() {\n\t\treturn this.opts.binding?.target\n\t}\n\tget targetKey() {\n\t\treturn this.opts.binding?.key\n\t}\n\tget targetValue(): T {\n\t\treturn this.targetObject?.[this.targetKey as keyof typeof this.targetObject]\n\t}\n\tset targetValue(v: T) {\n\t\tif (isLabeledOption(v)) v = fromLabeledOption(v) as T\n\t\tthis._log.fn('set targetValue').debug(v)\n\n\t\tif (typeof v === 'undefined') {\n\t\t\tconsole.error('Cannot set target value to undefined')\n\t\t\tconsole.error('this', this)\n\t\t\tthrow new Error('Cannot set target value to undefined')\n\t\t}\n\n\t\tconst to = this.targetObject\n\t\tconst tk = this.targetKey as keyof typeof this.targetObject\n\n\t\tif (to && tk) {\n\t\t\tif (isState(to[tk])) {\n\t\t\t\tto[tk].set(v)\n\t\t\t} else {\n\t\t\t\tto[tk] = v\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Selects the given {@link LabeledOption} and updates the ui.\n\t */\n\tset(value: LabeledOption<T>) {\n\t\tthis._log.fn('set').debug(value)\n\n\t\tthis.#stopPropagation = true\n\t\tthis.select.select(value, false)\n\t\tthis.state.set(value)\n\t\tthis._emit('change', value)\n\n\t\treturn this\n\t}\n\n\tenable() {\n\t\tthis._log.fn('enable').debug()\n\t\tthis.select.enable()\n\t\tsuper.enable()\n\t\treturn this\n\t}\n\n\tdisable() {\n\t\tthis._log.fn('disable').debug()\n\t\tthis.select.disable()\n\t\tsuper.disable()\n\t\treturn this\n\t}\n\n\trefresh = () => {\n\t\tconst v = this.state.value\n\t\tthis._log.fn('refresh').debug({ v, this: this })\n\n\t\tif (!this.labeledSelection) {\n\t\t\tthrow new Error('Failed to find labeled selection.')\n\t\t}\n\n\t\tconst newOptions = this.options.filter(\n\t\t\to => !this.select.options.some(oo => oo.label === o.label),\n\t\t)\n\n\t\tconsole.log(newOptions)\n\n\t\tfor (const option of newOptions) {\n\t\t\tthis.select.add(option)\n\t\t}\n\t\tthis.select.select(this.labeledSelection, false)\n\n\t\tsuper.refresh()\n\t\treturn this\n\t}\n\n\tdispose() {\n\t\tsuper.dispose()\n\t}\n}\n"],"names":[],"mappings":"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"}