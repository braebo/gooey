{"version":3,"file":"InputNumber.js","sources":["../../../../src/inputs/InputNumber.ts"],"sourcesContent":["import type { ElementMap, InputOptions } from './Input'\nimport type { State } from '../shared/state'\nimport type { Folder } from '../Folder'\n\nimport { NumberButtonsController } from '../controllers/NumberButtonsController'\nimport { NumberController } from '../controllers/NumberController'\nimport { rangeController } from '../controllers/number'\nimport { Logger } from '../shared/logger'\nimport { create } from '../shared/create'\nimport { Input } from './Input'\n\nexport interface NumberControllerElements extends ElementMap {\n\tcontainer: HTMLElement\n\tbuttons: {\n\t\tcontainer: HTMLDivElement\n\t\tincrement: HTMLDivElement\n\t\tdecrement: HTMLDivElement\n\t}\n\tinput: HTMLInputElement\n\trange: HTMLInputElement\n}\n\nexport type NumberInputOptions = {\n\treadonly __type?: 'NumberInputOptions'\n\tmin?: number\n\tmax?: number\n\tstep?: number\n} & InputOptions<number>\n\nexport const NUMBER_INPUT_DEFAULTS: NumberInputOptions = {\n\t__type: 'NumberInputOptions' as const,\n} as const\n\nexport class InputNumber extends Input<number, NumberInputOptions, NumberControllerElements> {\n\treadonly __type = 'InputNumber' as const\n\tprivate _log: Logger\n\tinitialValue: number\n\tstate: State<number>\n\n\tdragEnabled = false // todo - Move this into the number controller?\n\tnumberController: NumberController\n\tnumberButtonsController: NumberButtonsController\n\n\tconstructor(options: Partial<NumberInputOptions>, folder: Folder) {\n\t\tconst opts = Object.assign({}, NUMBER_INPUT_DEFAULTS, options, {\n\t\t\t__type: 'NumberInputOptions' as const,\n\t\t})\n\n\t\t// Smart defaults.\n\t\tlet v = opts.binding?.initial ?? opts.value ?? 1\n\t\topts.value ??= v\n\n\t\tlet min = 0\n\t\tlet max = 1\n\t\tlet step = 0.01\n\n\t\t// If the value is between [0..1], then it's nicer to keep the defaults.\n\t\t// Otherwise, we can adjust them dynamically to be more useful.\n\t\tif (v < 0 || v > 1) {\n\t\t\tmin ??= v <= 0 ? v * 2 : 0\n\t\t\tmax ??= v <= 0 ? v * -2 : v * 2\n\t\t\tstep = v / 100 <= 0.1 ? 0.001 : 0.1\n\t\t}\n\n\t\topts.min ??= min\n\t\topts.max ??= max\n\t\topts.step ??= step\n\n\t\tsuper(opts, folder)\n\n\t\tthis._log = new Logger(`InputNumber ${opts.title}`, { fg: 'cyan' })\n\t\tthis._log.fn('constructor').debug({ opts, this: this })\n\n\t\tthis.initialValue = this.resolveInitialValue(opts)\n\t\tthis.state = this.resolveState(opts)\n\n\t\tconst container = create('div', {\n\t\t\tclasses: ['gooey-input-number-container'],\n\t\t\tparent: this.elements.content,\n\t\t})\n\n\t\tthis.numberController = new NumberController(this, opts, container)\n\t\tthis.numberButtonsController = new NumberButtonsController(this, opts, container)\n\n\t\tthis.elements.controllers = {\n\t\t\tcontainer,\n\t\t\tinput: this.numberController.element,\n\t\t\tbuttons: this.numberButtonsController.elements,\n\t\t\trange: rangeController(this, opts, container),\n\t\t} as const satisfies NumberControllerElements\n\n\t\tthis._evm.add(this.state.subscribe(this.refresh))\n\n\t\tthis._evm.listen(this.elements.controllers.range, 'pointerdown', this.lock)\n\t\tthis._evm.listen(this.elements.controllers.range, 'pointerup', () => this.unlock())\n\n\t\tthis._evm.listen(this.elements.controllers.input, 'input', this.set)\n\n\t\tthis._evm.listen(this.elements.controllers.input, 'dragStart', this.lock)\n\t\tthis._evm.listen(this.elements.controllers.input, 'dragEnd', () => this.unlock())\n\t}\n\n\tset = (v?: number | Event) => {\n\t\tthis._log.fn('set').debug(v)\n\n\t\tif (typeof v === 'undefined') return\n\n\t\tlet newValue = v as number\n\n\t\tif (v instanceof Event && v?.target && 'valueAsNumber' in v.target) {\n\t\t\tnewValue = v.target.valueAsNumber as number\n\t\t}\n\n\t\tthis.commit({ to: newValue })\n\t\tthis.state.set(newValue)\n\n\t\tthis._emit('change', newValue)\n\t\treturn this\n\t}\n\n\tenable() {\n\t\tthis._log.fn('enable').debug()\n\t\tthis.elements.controllers.input.disabled = false\n\t\tsuper.enable()\n\t\treturn this\n\t}\n\n\tdisable() {\n\t\tthis._log.fn('disable').debug()\n\t\tthis.elements.controllers.input.disabled = true\n\t\tsuper.disable()\n\t\treturn this\n\t}\n\n\trefresh = () => {\n\t\tconst v = this.state.value\n\t\tthis._log.fn('refresh').debug(v)\n\t\tthis.elements.controllers.range.value = String(v)\n\t\tthis.elements.controllers.input.value = String(v)\n\t\tsuper.refresh(v)\n\t\treturn this\n\t}\n\n\tdispose() {\n\t\tthis._log.fn('dispose').debug()\n\t\tsuper.dispose()\n\t}\n}\n"],"names":[],"mappings":"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"}