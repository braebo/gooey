{"version":3,"file":"InputColor.js","sources":["../../../../src/inputs/InputColor.ts"],"sourcesContent":["import type { ColorComponentsElements } from '../controllers/color/ColorComponents'\nimport type { ColorPickerElements } from '../controllers/color/ColorPicker'\nimport type { ElementMap, InputOptions, InputPreset } from './Input'\nimport type { ColorFormat } from '../shared/color/types/colorFormat'\nimport type { State } from '../shared/state'\nimport type { Folder } from '../Folder'\n\nimport { ColorComponents } from '../controllers/color/ColorComponents'\nimport { ColorPicker } from '../controllers/color/ColorPicker'\nimport { Color, isColor } from '../shared/color/color'\nimport { CopyButton } from '../shared/CopyButton'\nimport { create } from '../shared/create'\nimport { Logger } from '../shared/logger'\nimport { state } from '../shared/state'\nimport { Input } from './Input'\n\nexport type ColorMode = (typeof COLOR_MODES)[number]\n\nexport const COLOR_MODES = [\n\t'rgba',\n\t'rgbaString',\n\t'hsla',\n\t'hslaString',\n\t// 'hsva',\n\t// 'hsvaString',\n\t'hex',\n\t'hex8',\n\t// 'array',\n] as const\n\nexport interface ColorControllerElements extends ElementMap<ColorPicker> {\n\tcontainer: HTMLDivElement\n\t/**\n\t * A color swatch that displays the current color and toggles the color-picker when clicked.\n\t */\n\tcurrentColor: {\n\t\tcontainer: HTMLDivElement\n\t\tdisplayBackground: HTMLDivElement\n\t\tdisplay: HTMLDivElement\n\t\tcopyButton: CopyButton\n\t}\n\t/**\n\t * The main input content body.\n\t */\n\tbody: {\n\t\tcontainer: HTMLDivElement\n\t\t/**\n\t\t * All elements related to the color picker.\n\t\t */\n\t\tpicker: ColorPickerElements\n\t\t/**\n\t\t * Number controllers for rgb/hsl/hsv components.\n\t\t */\n\t\tcomponents: ColorComponentsElements\n\t}\n}\n\nexport type ColorInputOptions = {\n\t__type?: 'ColorInputOptions'\n\tmode?: ColorMode\n\texpanded?: boolean\n\tonChange?: (value: Color) => void\n} & InputOptions<ColorFormat | Color>\n//⌟\n\nexport const COLOR_INPUT_DEFAULTS = {\n\t__type: 'ColorInputOptions' as const,\n\tvalue: '#FF0000FF',\n\tmode: 'hex',\n\texpanded: false,\n} as const satisfies ColorInputOptions\n\nexport class InputColor extends Input<Color, ColorInputOptions, ColorControllerElements> {\n\treadonly __type = 'InputColor' as const\n\tinitialValue: Color\n\tstate: State<Color>\n\t/**\n\t * The color picker instance.\n\t */\n\tpicker: ColorPicker\n\t/**\n\t * RGBA/HSLA/HSVA number component inputs.\n\t */\n\tcomponents: ColorComponents\n\t/**\n\t * When `true`, the color picker is visible.\n\t */\n\texpanded: boolean\n\n\tprivate _mode: ColorMode\n\tget mode() {\n\t\treturn this._mode\n\t}\n\tset mode(v: ColorMode) {\n\t\tthis._mode = v\n\t\tthis.components.mode = v\n\t}\n\n\tprivate _log: Logger\n\n\tconstructor(options: Partial<ColorInputOptions>, folder: Folder) {\n\t\tconst opts = Object.assign({}, COLOR_INPUT_DEFAULTS, options, {\n\t\t\t__type: 'ColorInputOptions' as const,\n\t\t})\n\t\tsuper(opts, folder)\n\n\t\tthis.expanded = opts.expanded\n\t\tthis._mode = opts.mode\n\t\tthis._log = new Logger(`InputColor ${opts.title}`, { fg: 'cyan' })\n\t\tthis._log.fn('constructor').debug({ opts, this: this }).groupEnd()\n\n\t\t//? Initialize state.\n\t\tif (opts.binding) {\n\t\t\tthis.initialValue = new Color(opts.binding.target[opts.binding.key])\n\t\t\tthis.state = state(this.initialValue.clone())\n\n\t\t\tthis._evm.add(\n\t\t\t\tthis.state.subscribe(v => {\n\t\t\t\t\topts.binding!.target[opts.binding!.key] = v\n\t\t\t\t}),\n\t\t\t)\n\t\t} else {\n\t\t\tthis.initialValue = new Color(opts.value)\n\t\t\tthis.state = state(this.initialValue.clone())\n\t\t}\n\n\t\t//? Elements.\n\t\tconst container = create('div', {\n\t\t\tclasses: ['gooey-input-color-container'],\n\t\t\tparent: this.elements.content,\n\t\t})\n\t\tthis.elements.controllers.container = container\n\n\t\t//- Current Color\n\t\tthis.elements.controllers.currentColor = this._createCurrentColor(container)\n\n\t\t//- Body\n\t\tconst body = create('div', {\n\t\t\tclasses: ['gooey-input-color-body'],\n\t\t\tparent: container,\n\t\t})\n\n\t\t//- Color Picker\n\t\tthis.picker = new ColorPicker(this, { container: body })\n\n\t\t//- Components\n\t\tthis.components = new ColorComponents(this, { container: body })\n\n\t\tthis.elements.controllers.body = {\n\t\t\tcontainer: body,\n\t\t\tpicker: this.picker.elements,\n\t\t\tcomponents: this.components.elements,\n\t\t}\n\n\t\tthis._dirty = () => this.state.value.hex !== this.initialValue.hex\n\n\t\tsetTimeout(() => {\n\t\t\tthis.expanded ? this.open() : this.close(0)\n\t\t}, 10)\n\n\t\tthis.emit('change')\n\t\tthis.refresh()\n\n\t\tthis.picker.on('pointerdown', this._lock)\n\t\tthis.picker.on('pointerup', this._unlock)\n\t}\n\n\tset(v: ColorFormat | Color) {\n\t\tif (isColor(v)) {\n\t\t\tthis.commit({\n\t\t\t\tto: v.rgba,\n\t\t\t\tfrom: this.state.value.rgba,\n\t\t\t\tsetter: v => {\n\t\t\t\t\tthis.state.value.set(v)\n\t\t\t\t\tthis.state.refresh()\n\t\t\t\t\tthis.refresh()\n\t\t\t\t},\n\t\t\t})\n\t\t\tthis.state.set(new Color(v.rgba))\n\t\t} else {\n\t\t\tconst newColor = new Color(v)\n\t\t\tthis.commit({\n\t\t\t\tto: newColor.rgba,\n\t\t\t\tfrom: this.state.value.rgba,\n\t\t\t\tsetter: v => {\n\t\t\t\t\tthis.state.value.set(v)\n\t\t\t\t\tthis.state.refresh()\n\t\t\t\t\tthis.refresh()\n\t\t\t\t},\n\t\t\t})\n\t\t\tthis.state.set(newColor)\n\t\t}\n\n\t\tconst newValue = this.state.value\n\n\t\tthis._log.fn('set').debug({ v, newValue, this: this })\n\n\t\tthis.emit('change', newValue)\n\t\tthis.refresh(newValue)\n\n\t\treturn this\n\t}\n\n\trefresh = (v = this.state.value) => {\n\t\tthis._log.fn('refresh').debug({ v, this: this })\n\n\t\tthis.elements.controllers.currentColor.display.style.backgroundColor = v.hex\n\n\t\tthis.picker.refresh()\n\t\tthis.components.refresh()\n\t\tsuper.refresh(v)\n\n\t\treturn this\n\t}\n\n\tprivate _createCurrentColor(parent: HTMLDivElement) {\n\t\tconst container = create('div', {\n\t\t\tclasses: ['gooey-input-color-current-color-container'],\n\t\t\tparent,\n\t\t})\n\n\t\tconst displayBackground = create('div', {\n\t\t\tclasses: ['gooey-input-color-current-color-background'],\n\t\t\tparent: container,\n\t\t})\n\n\t\tconst display = create('div', {\n\t\t\tclasses: ['gooey-input-color-current-color-display'],\n\t\t\tparent: displayBackground,\n\t\t})\n\t\tthis._evm.listen(display, 'click', this.togglePicker)\n\n\t\tconst copyButton = new CopyButton(\n\t\t\tcontainer,\n\t\t\t() => {\n\t\t\t\treturn this.state.value.hex\n\t\t\t},\n\t\t\t'Copy Hex',\n\t\t\tthis,\n\t\t)\n\n\t\treturn {\n\t\t\tcontainer,\n\t\t\tdisplayBackground,\n\t\t\tdisplay,\n\t\t\tcopyButton,\n\t\t}\n\t}\n\n\t//· Open/Close ···············································································¬\n\n\tstatic readonly #pickerHeight = '75px'\n\n\tprivate get _pickerContainer(): HTMLDivElement | undefined {\n\t\treturn this.picker.elements.container\n\t}\n\n\ttogglePicker = async () => {\n\t\tif (!this.expanded) {\n\t\t\tawait this.open()\n\t\t} else {\n\t\t\tawait this.close()\n\t\t}\n\t}\n\n\topen = async () => {\n\t\tthis.expanded = true\n\n\t\tthis.elements.container.dataset['search_height'] = '100px'\n\n\t\tconst pickerAnim = this._pickerContainer?.animate(\n\t\t\t[\n\t\t\t\t{ height: '0px', clipPath: 'inset(0 0 100% 0)' },\n\t\t\t\t{ height: InputColor.#pickerHeight, clipPath: 'inset(0 0 -50% 0)' },\n\t\t\t],\n\t\t\t{ duration: 200, easing: 'cubic-bezier(.08,.38,0,0.92)', fill: 'forwards' },\n\t\t)\n\n\t\tconst containerAnim = this.elements.container.animate(\n\t\t\t{ maxHeight: '100px', height: '100px' },\n\t\t\t{ duration: 200, easing: 'cubic-bezier(.08,.38,0,0.92)', fill: 'forwards' },\n\t\t) as Animation | undefined\n\n\t\tthis._pickerContainer?.style.setProperty('overflow', 'visible')\n\t\tthis._pickerContainer?.classList.add('expanded')\n\n\t\tawait Promise.all([pickerAnim?.finished, containerAnim?.finished])\n\t\tif (this._pickerContainer && document.contains(this._pickerContainer)) {\n\t\t\ttry {\n\t\t\t\tpickerAnim?.commitStyles()\n\t\t\t} catch (e) {}\n\t\t}\n\t\tif (this.elements.container && document.contains(this.elements.container)) {\n\t\t\ttry {\n\t\t\t\tcontainerAnim?.commitStyles()\n\t\t\t} catch (e) {}\n\t\t}\n\n\t\tthis.folder.graphics?.connector?.update()\n\t}\n\n\tclose = async (duration = 300) => {\n\t\tthis.expanded = false\n\n\t\tdelete this.elements.container.dataset['search_height']\n\n\t\tconst pickerAnim = this._pickerContainer?.animate(\n\t\t\t[\n\t\t\t\t{ height: InputColor.#pickerHeight, clipPath: 'inset(0 0 -100% 0)' },\n\t\t\t\t{ height: '0px', clipPath: 'inset(0 0 100% 0)' },\n\t\t\t],\n\t\t\t{ duration: duration, easing: 'cubic-bezier(.13,.09,.02,.96)', fill: 'forwards' },\n\t\t)\n\t\tconst containerAnim = this.elements.container.animate(\n\t\t\t{\n\t\t\t\tminHeight: 'var(--gooey-input_height)',\n\t\t\t\tmaxHeight: 'var(--gooey-input_height)',\n\t\t\t\theight: 'var(--gooey-input_height)',\n\t\t\t},\n\t\t\t{ duration: duration, easing: 'cubic-bezier(.13,.09,.02,.96)', fill: 'forwards' },\n\t\t) as Animation | undefined\n\n\t\tthis._pickerContainer?.style.setProperty('overflow', 'hidden')\n\t\tthis._pickerContainer?.classList.remove('expanded')\n\n\t\tawait Promise.all([pickerAnim?.finished, containerAnim?.finished])\n\n\t\tif (this._pickerContainer && document.contains(this._pickerContainer)) {\n\t\t\ttry {\n\t\t\t\tpickerAnim?.commitStyles()\n\t\t\t} catch (e) {}\n\t\t}\n\t\tif (this.elements.container && document.contains(this.elements.container)) {\n\t\t\ttry {\n\t\t\t\tcontainerAnim?.commitStyles()\n\t\t\t} catch (e) {}\n\t\t}\n\t}\n\t//⌟\n\n\t//· Super Overrides ··········································································¬\n\n\t/**\n\t * Prevents the range slider from registering undo history commits while dragging on the\n\t * canvas, storing the initial value on pointerdown for the eventual commit in {@link unlock}.\n\t */\n\tprivate _lock = () => {\n\t\t// console.log('lock', 'from:' + chalk.hex(this.state.value.hex)(this.state.value.rgbaString))\n\t\tthis.lock(this.state.value.rgba)\n\t}\n\t/**\n\t * Saves the commit stored in #lock on pointerup.\n\t */\n\tprivate _unlock = () => {\n\t\tthis.unlock({\n\t\t\ttarget: this,\n\t\t\tto: this.state.value.rgba,\n\t\t\tsetter: v => {\n\t\t\t\tthis.state.value.set(v)\n\t\t\t\tthis.state.refresh()\n\t\t\t\tthis.emit('change', this.state.value)\n\t\t\t\tthis.refresh()\n\t\t\t},\n\t\t})\n\t}\n\n\tenable() {\n\t\tthis.picker.enable()\n\t\tsuper.enable()\n\t\treturn this\n\t}\n\n\tdisable() {\n\t\tthis.picker.disable()\n\t\tsuper.disable()\n\t\treturn this\n\t}\n\n\tsave() {\n\t\treturn super.save({ value: this.state.value.hex })\n\t}\n\n\tload(json: string | InputPreset<ColorInputOptions>) {\n\t\tconst data = typeof json === 'string' ? JSON.parse(json) : json\n\t\tthis.id = data.presetId\n\t\tthis.disabled = data.disabled\n\t\tthis.hidden = data.hidden\n\t\tthis.initialValue = new Color(data.value)\n\t\tthis.set(this.initialValue.clone())\n\t}\n\t//⌟\n\n\tdispose() {\n\t\tthis._log.fn('dispose').debug({ this: this })\n\t\tthis.picker.dispose()\n\t\tsuper.dispose()\n\t}\n}\n"],"names":[],"mappings":"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"}