{"version":3,"file":"InputSwitch.js","sources":["../../../../src/inputs/InputSwitch.ts"],"sourcesContent":["import type { ElementMap, InputOptions } from './Input'\nimport type { Tooltip } from '../shared/Tooltip'\nimport type { State } from '../shared/state'\nimport type { Folder } from '../Folder'\n\nimport { Logger } from '../shared/logger'\nimport { create } from '../shared/create'\nimport { state } from '../shared/state'\nimport { Input } from './Input'\n\n/**\n * Options for the {@link InputSwitch} class.\n */\nexport type SwitchInputOptions = InputOptions<boolean> & {\n\treadonly __type?: 'SwitchInputOptions'\n\t/** Text to display in various parts of the switch. */\n\tlabels?: {\n\t\t/** Text to display when the state is `true` */\n\t\ttrue: {\n\t\t\t/**\n\t\t\t * Represents the `true` state, i.e. `'on' | 'active' | 'enabled'`\n\t\t\t * @default 'on'\n\t\t\t */\n\t\t\tstate?: string\n\t\t\t/**\n\t\t\t * Represents, i.e. `'turn on' | 'activate' | 'enable'`.\n\t\t\t * Displayed on the tooltip when the switch is `false`.\n\t\t\t * @default 'Enable'\n\t\t\t */\n\t\t\tverb?: string\n\t\t}\n\t\t/** Text to display when the state is `false` */\n\t\tfalse: {\n\t\t\t/**\n\t\t\t * Represents the `false` state, i.e. `'off' | 'inactive' | 'disabled'`\n\t\t\t * @default 'off'\n\t\t\t */\n\t\t\tstate?: string\n\t\t\t/**\n\t\t\t * Represents the action, i.e. `'turn off' | 'deactivate' | 'disable'`.\n\t\t\t * Displayed on the tooltip when the switch is `true`.\n\t\t\t * @default 'Disable'\n\t\t\t */\n\t\t\tverb?: string\n\t\t}\n\t}\n}\n\nexport const SWITCH_INPUT_DEFAULTS = {\n\t__type: 'SwitchInputOptions' as const,\n\tvalue: true,\n\tlabels: {\n\t\ttrue: {\n\t\t\tstate: 'on',\n\t\t\tverb: 'Enable',\n\t\t},\n\t\tfalse: {\n\t\t\tstate: 'off',\n\t\t\tverb: 'Disable',\n\t\t},\n\t},\n} as const satisfies SwitchInputOptions\n\nexport interface SwitchInputElements extends ElementMap {\n\tcontainer: HTMLElement\n\tinput: HTMLButtonElement & { tooltip: Tooltip }\n\tthumb: HTMLDivElement\n\tstateText: HTMLDivElement\n}\n\n/**\n * A switch {@link Input} for booleans.\n */\nexport class InputSwitch extends Input<boolean, SwitchInputOptions, SwitchInputElements> {\n\treadonly __type = 'InputSwitch' as const\n\treadonly state: State<boolean>\n\n\tinitialValue: boolean\n\t#log: Logger\n\n\tconstructor(options: Partial<SwitchInputOptions>, folder: Folder) {\n\t\tconst opts = Object.assign({}, SWITCH_INPUT_DEFAULTS, options)\n\t\tsuper(opts, folder)\n\n\t\tthis.#log = new Logger(`InputSwitch ${opts.title}`, { fg: 'cyan' })\n\t\tthis.#log.fn('constructor').debug({ opts, this: this })\n\n\t\tif (opts.binding) {\n\t\t\t// Bind the state to the target object.\n\t\t\tthis.initialValue = opts.binding.target[opts.binding.key]\n\t\t\tthis.state = state(!!this.initialValue)\n\n\t\t\tthis._evm.add(\n\t\t\t\tthis.state.subscribe(v => {\n\t\t\t\t\topts.binding!.target[opts.binding!.key] = v\n\t\t\t\t}),\n\t\t\t)\n\t\t} else {\n\t\t\t// Create a new observable state.\n\t\t\tthis.initialValue = opts.value!\n\t\t\tthis.state = state(!!opts.value!)\n\t\t}\n\n\t\t//- Container\n\t\tconst container = create('div', {\n\t\t\tclasses: ['gooey-input-switch-container'],\n\t\t\tparent: this.elements.content,\n\t\t})\n\n\t\t//- Switch Button\n\t\tconst input = create('button', {\n\t\t\tclasses: ['gooey-controller', 'gooey-controller-switch'],\n\t\t\tparent: container,\n\t\t\ttooltip: {\n\t\t\t\ttext: () => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t(this.state.value ? opts.labels?.false.verb : opts.labels?.true.verb) || ''\n\t\t\t\t\t)\n\t\t\t\t},\n\t\t\t\tanchor: '.gooey-controller-switch-thumb',\n\t\t\t\tdelay: 750,\n\t\t\t},\n\t\t})\n\t\tconst thumb = create('div', {\n\t\t\tclasses: ['gooey-controller-switch-thumb'],\n\t\t\tparent: input,\n\t\t})\n\n\t\t//- State Text\n\t\tconst stateText = create('div', {\n\t\t\tclasses: ['gooey-controller-switch-state-text'],\n\t\t\tparent: container,\n\t\t\tinnerText: this.state.value ? opts.labels?.true.state : opts.labels?.false.state,\n\t\t\tstyle: {\n\t\t\t\topacity: '0.75',\n\t\t\t},\n\t\t})\n\n\t\tthis.elements.controllers = {\n\t\t\tcontainer,\n\t\t\tinput,\n\t\t\tthumb,\n\t\t\tstateText,\n\t\t} as const satisfies SwitchInputElements\n\n\t\tthis._evm.listen(this.elements.controllers.input, 'click', () => this.set())\n\t\tthis._evm.add(this.state.subscribe(this.refresh.bind(this)))\n\t}\n\n\tset(v = !this.state.value) {\n\t\tthis.#log.fn('set').debug({ v, this: this })\n\n\t\tif (typeof v === 'boolean') {\n\t\t\tthis.undoManager?.commit({\n\t\t\t\t// @ts-expect-error - ¯\\_(ツ)_/¯\n\t\t\t\ttarget: this,\n\t\t\t\tfrom: this.state.value,\n\t\t\t\tto: v,\n\t\t\t})\n\t\t\tthis.state.set(v)\n\t\t} else {\n\t\t\tthrow new Error(\n\t\t\t\t`InputBoolean.set() received an invalid value: ${JSON.stringify(v)} (${typeof v})`,\n\t\t\t)\n\t\t}\n\n\t\tthis._emit('change', v)\n\t\treturn this\n\t}\n\n\trefresh(v = this.state.value) {\n\t\tthis.#log.fn('refresh').debug({ v, this: this })\n\t\tif (this.disabled) return this\n\n\t\tthis.elements.controllers.input.classList.toggle('active', v)\n\t\tthis.elements.controllers.input?.tooltip?.refresh()\n\t\tthis.elements.controllers.stateText.innerText =\n\t\t\t(this.state.value ? this.opts.labels?.true.state : this.opts.labels?.false.state) ?? ''\n\n\t\tthis._emit('refresh', v)\n\t\treturn this\n\t}\n\n\tenable() {\n\t\tthis.elements.controllers.input.disabled = false\n\t\tsuper.enable()\n\t\treturn this\n\t}\n\tdisable() {\n\t\tthis.elements.controllers.input.disabled = true\n\t\tsuper.disable()\n\t\treturn this\n\t}\n\n\tdispose() {\n\t\tsuper.dispose()\n\t}\n}\n"],"names":[],"mappings":"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"}