function L(n,t){let[i,...e]=n,{concatArrays:r=!0}=t??{};return e.reduce((o,s)=>{if(!s)return o;let a=Object.keys(s);for(let l=0;l<a.length;l++){let c=a[l],p=o[c],h=s[c];Array.isArray(p)&&Array.isArray(h)?r?o[c]=[...new Set([...p,...h])]:o[c]=h:p&&typeof p=="object"?h!==!0&&(h&&typeof h=="object"?typeof globalThis.window<"u"&&h instanceof Element?o[c]=h:o[c]=L([{...p},h],t):(h||h===!1)&&(o[c]=h)):h!==void 0&&(o[c]=h)}return o},{...i})}function A(n,t={}){let i=n.resolved?{}:{base:n.vars.color.base,dark:{"bg-a":n.vars.color.dark?.["bg-a"]||n.vars.color.base["dark-a"],"bg-b":n.vars.color.dark?.["bg-b"]||n.vars.color.base["dark-b"],"bg-c":n.vars.color.dark?.["bg-c"]||n.vars.color.base["dark-c"],"bg-d":n.vars.color.dark?.["bg-d"]||n.vars.color.base["dark-d"],"bg-e":n.vars.color.dark?.["bg-e"]||n.vars.color.base["dark-e"],"fg-a":n.vars.color.dark?.["fg-a"]||n.vars.color.base["light-a"],"fg-b":n.vars.color.dark?.["fg-b"]||n.vars.color.base["light-b"],"fg-c":n.vars.color.dark?.["fg-c"]||n.vars.color.base["light-c"],"fg-d":n.vars.color.dark?.["fg-d"]||n.vars.color.base["light-d"],"fg-e":n.vars.color.dark?.["fg-e"]||n.vars.color.base["light-e"],...n.vars.color.dark},light:{"bg-a":n.vars.color.light?.["bg-a"]||n.vars.color.base["light-a"],"bg-b":n.vars.color.light?.["bg-b"]||n.vars.color.base["light-b"],"bg-c":n.vars.color.light?.["bg-c"]||n.vars.color.base["light-c"],"bg-d":n.vars.color.light?.["bg-d"]||n.vars.color.base["light-d"],"bg-e":n.vars.color.light?.["bg-e"]||n.vars.color.base["light-e"],"fg-a":n.vars.color.light?.["fg-a"]||n.vars.color.base["dark-a"],"fg-b":n.vars.color.light?.["fg-b"]||n.vars.color.base["dark-b"],"fg-c":n.vars.color.light?.["fg-c"]||n.vars.color.base["dark-c"],"fg-d":n.vars.color.light?.["fg-d"]||n.vars.color.base["dark-d"],"fg-e":n.vars.color.light?.["fg-e"]||n.vars.color.base["dark-e"],...n.vars.color.light}};return{title:n.title,prefix:n.prefix||"fractils",vars:L([{color:i},t,n.vars]),resolved:!0}}var yt=A({title:"default",prefix:"fracgui",vars:{color:{base:{"theme-a":"#00bcd4","dark-a":"#0B0B11","dark-b":"#1b1d29","dark-c":"#46465e","dark-d":"#55566a","dark-e":"#787b89","light-a":"#ffffff","light-b":"#c9ccd7","light-c":"#a9adba","light-d":"#777D8F","light-e":"#5F6377"},dark:{},light:{}},core:{light:{"controller-dim_background":"color-mix(in sRGB, var(--fracgui-bg-a) 75%, transparent)"}}}});var be=A({title:"scout",prefix:"fracgui",vars:{color:{base:{"theme-a":"#ff4221","theme-b":"#ff9215","theme-c":"#ff8bd3","dark-a":"#15161d","dark-b":"#282a36","dark-c":"#272d30","dark-d":"#3a3a44","dark-e":"#4d4d58","light-a":"#dfe1e9","light-b":"#c3c4c7","light-c":"#777d8f","light-d":"#5f6377","light-e":"#363945"},dark:{},light:{}},utility:{dark:{filter:"contrast(1.05) brightness(1.05)"}},core:{dark:{"folder-header_background":"color-mix(in sRGB, var(--fracgui-bg-a) 100%, transparent)"},light:{"controller-dim_background":"#96a09c"}}}});var ve=A({title:"flat",prefix:"fracgui",vars:{color:{base:{"theme-a":"#00bcd4","theme-b":"#f8d2c9","theme-c":"#ba788a","dark-a":"#0B0B11","dark-b":"#15161D","dark-c":"#1F202D","dark-d":"#353746","dark-e":"#474A5B","light-a":"#ffffff","light-b":"#dfe1e9","light-c":"#BABECA","light-d":"#777D8F","light-e":"#5F6377"},dark:{},light:{}},core:{dark:{"input-number-range_outline":"1px solid color-mix(in sRGB, var(--fracgui-bg-c) 33%, transparent)"}}}});var pt=(n,t,i)=>{let{top:e,bottom:r,left:o,right:s}=t;if(n>0)for(let a=0;a<i.length;a++){let l=i[a].getBoundingClientRect();e>l.bottom||r<l.top||s>l.left||(n=Math.min(n,l.left-s))}else for(let a=0;a<i.length;a++){let l=i[a].getBoundingClientRect();e>l.bottom||r<l.top||o<l.right||(n=Math.max(n,l.right-o))}return n},dt=(n,t,i)=>{let{top:e,bottom:r,left:o,right:s}=t;if(n>0)for(let a=0;a<i.length;a++){let l=i[a].getBoundingClientRect();o>l.right||s<l.left||r>l.top||(n=Math.min(n,l.top-r))}else for(let a=0;a<i.length;a++){let l=i[a].getBoundingClientRect();o>l.right||s<l.left||e<l.bottom||(n=Math.max(n,l.bottom-e))}return n};function S(n=21){return crypto.getRandomValues(new Uint8Array(n)).reduce((t,i)=>t+=(i&=63)<36?i.toString(36):i<62?(i-26).toString(36).toUpperCase():i>62?"-":"_","")}var Qt=()=>ye[Math.floor(Math.random()*ye.length)],xt=Object.freeze({aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}),ye=Object.keys(xt);var xe={reset:"\x1B[0m",black:"\x1B[30m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m",gray:"\x1B[90m",bgBlack:"\x1B[40m",bgRed:"\x1B[41m",bgGreen:"\x1B[42m",bgYellow:"\x1B[43m",bgBlue:"\x1B[44m",bgMagenta:"\x1B[45m",bgCyan:"\x1B[46m",bgWhite:"\x1B[47m",bold:"\x1B[1m",dim:"\x1B[2m",italic:"\x1B[3m",underline:"\x1B[4m"},hi=n=>{let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null},te=n=>t=>{let i=hi(n);return i?`\x1B[38;2;${i[0]};${i[1]};${i[2]}m${t}\x1B[0m`:t},V=n=>t=>`${xe[n]}${t}${xe.reset}`,D=V("red"),we=V("green"),Te=V("yellow"),or=V("blue"),sr=V("magenta"),B=V("cyan"),ee=V("gray"),wt=V("dim"),H=te("#ff7f50");var Tt=(n,t=0)=>JSON.stringify(n,_e([]),t);function _e(n){let t=[];return function(i,e){if(typeof e>"u")return;if(typeof e=="function")return"[Function]";let r=n.indexOf(this);r!==-1?(n.length=r+1,t.length=r,t[r]=i):(n.push(this),t.push(i));let o=n.indexOf(e);return o!==-1?"[Circular ~"+t.slice(0,o).join(".")+"]":e instanceof Set?Array.from(e):e instanceof Map?Object.fromEntries(Array.from(e.entries()).map(([s,a])=>{let l=[...n];return[s,JSON.parse(JSON.stringify(a,_e(l)))]})):e instanceof Element?`${e.tagName}.${Array.from(e.classList).filter(s=>!s.startsWith("s-")).join(".")}#${e.id}`:(n.length>0&&n.push(e),e)}}var W=typeof globalThis.requestIdleCallback<"u"?globalThis.requestIdleCallback:typeof globalThis.requestAnimationFrame<"u"?globalThis.requestAnimationFrame:n=>setTimeout(n,0),ke=typeof globalThis?.cancelIdleCallback<"u"?globalThis.cancelIdleCallback:typeof globalThis.cancelAnimationFrame<"u"?globalThis.cancelAnimationFrame:globalThis.clearTimeout;function Ee(n,{maxDepth:t=2,maxLength:i=30,maxSiblings:e=4,preserveRootSiblings:r=!1,preserveFunctions:o=!1,preserveNumbers:s=!1}={}){return a(n);function a(l,c=0){let p=new WeakSet;if(l===null)return l;if(typeof l=="object"){if(p.has(l))return"[Circular]";p.add(l)}switch(typeof l){case"boolean":case"symbol":case"undefined":return l;case"function":return o?l:`[Function: ${l.name}]`;case"string":return l.length<i+3?l:l.slice(0,i)+"..";case"number":{let h=s?l.toString():l.toFixed(i);return h.length>i+3?+h.slice(0,i)+"..":+h}case"bigint":return+l.toString().slice(0,i);case"object":{let h=c>t;if(Array.isArray(l))return h?`[ ..${l.length} ]`:l.length<=e||c===0?l.map(x=>a(x,c+1)):[...l.slice(0,e).map(x=>a(x,c)),`..${l.length-e} more`];let m=Object.keys(l).length;return h?`{..${m} ${m===1?"entry":"entries"}}`:m<=e||r&&c===0?Object.fromEntries(Object.entries(l).map(([x,y])=>[x,a(y,c+1)])):Object.fromEntries(Object.entries(l).slice(0,e).concat([["..",`${m-e} more`]]).map(([x,y])=>[x,a(y,c+1)]))}}return l}}var gi=!1,f=class n{static _BYPASS_STYLES=!1;static _BYPASS_DEFER=!0;title="";options;color;#t;constructor(t,i){typeof t=="string"?(this.title=t,this.options=i??{}):(this.options=t,this.title=t.title??"");let e=i?.fg?.toLowerCase()??Qt(),r=e in xt?xt[e]:e;return this.color=r,this.#t=n.createLogger(this.title,this.options),this}get deferred(){return!n._BYPASS_DEFER&&this.options?.deferred}log=(...t)=>{this.#t(...t)};dump=(...t)=>{this.buffer.length?(t[0].match(/â“˜|âš |â›”|ðŸ’€/)&&this.buffer.unshift(t.shift()),this.consolidateBuffer(),this.#t(...this.buffer,...t)):this.#t(...t),this.buffer=[]};debug(...t){return import.meta?.env?.VITE_FRACTILS_LOG_LEVEL==="debug"&&this.dump("\u{1F41E}",...t),this}i=te("#426685")("\u24D8");info(...t){return this.dump(this.i,...t),this}warn(...t){return this.dump(Te("\u26A0"),...t),this}error(...t){return this.dump(D("\u26D4"),...t),this}fatal(...t){return this.dump(D("\u{1F480}"),...t),this}group(t){let i=this.title+(t?`:${t}`:"");return this.deferred?W(()=>console.group(i)):console.group(i),this}groupCollapsed(t){let i=this.title+(t?`:${t}`:"");return this.deferred?W(()=>console.groupCollapsed(i)):console.groupCollapsed(i),this}groupEnd(){return this.deferred?W(()=>console.groupEnd()):console.groupEnd(),this}buffer=[];consolidateBuffer(){let t=new Map;for(let i of this.buffer)t.set(i,(t.get(i)??0)+1);this.buffer=Array.from(t).map(([i,e])=>e>1?`${i}x${wt(`${e}`)}`:i)}fn(t,...i){return this.buffer.push(ee(t)+wt("(")+i.map(e=>ee(typeof e=="object"?Tt(e):e)).join(", ")+wt(")")),this}static createLogger(t,i){i??={};let e=i.browser??!0,r=i.server??!1;if(!1)return()=>{};if(!!1&&!r)return()=>{};let o=i.fg||Qt(),s=i.bg||"transparent",a=i.css??"";i.styled??=!0;let l=i.styled&&!n._BYPASS_STYLES;i.deferred??=!0;let c=i.deferred&&!n._BYPASS_DEFER&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent);if(!gi)return()=>{};let p,h="%c%s%c",[m,...x]=t.split(" "),y=[];if(x.length){for(let I of x)y.push(`color:#666;background:${s};padding:0.1rem;filter:saturate(0.25);${a}`,` ${I}`);let v=y.indexOf(y.at(-1)??"");v>=0&&(y[v]=`${y[v]}
`),h="%c%s".repeat(x.length)+`${h}`,t=m}else t=`${t}
`;let g=l?(...v)=>{let I=h;v.forEach(G=>{switch(typeof G){case"bigint":case"number":I+="%d ";break;case"string":I+="%s ";break;case"object":case"boolean":case"undefined":default:I+="%o "}}),console.log(I+"%c%s",`color:${o};background:${s};padding:0.1rem;${a}`,`${t}`,...y,`color:initial;background:${s};padding:0.1rem;${a}`,...v.map(G=>import.meta?.env?.VITEST?Ee(G,{maxDepth:1,maxSiblings:1}):G),`color:#666;background:${s};padding:0.1rem;${a};font-size:0.66rem;`,i?.callsite?`${p}`:"")}:(...v)=>{console.log(`| ${p} |
| ${t} |`,...v)};return c?(...v)=>W(()=>g(...v)):g}};function O(n,t){if(typeof window>"u")return[];if(n===void 0)return[];let i=Array.isArray(n)?n:[n];return t??=document.documentElement,i.flatMap(e=>{if(!e)return[];if(e instanceof HTMLElement)return[e];if(e instanceof Document)return[document.documentElement];if(typeof e=="string"){if(e==="document"||e==="window")return[document.documentElement];if(e.startsWith("#")){let o=document.getElementById(JSON.stringify(e).slice(1));return o?[o]:(!1,[])}}let r=t.querySelectorAll(e);return r.length===0?(!1,[]):Array.from(r)})}function fi(n,t){return n!=n?t==t:n!==t||n!==null&&typeof n=="object"||typeof n=="function"}var kt=()=>{};function mi(n,t,i){if(n==null)return t(void 0),i&&i(void 0),kt;let e=n.subscribe(t,i);return e.unsubscribe?()=>e.unsubscribe():e}var Q=[];function tt(n,t=kt){let i=null,e=new Set;function r(a){if(fi(n,a)&&(n=a,i)){let l=!Q.length;for(let c of e)c[1](),Q.push(c,n);if(l){for(let c=0;c<Q.length;c+=2)Q[c][0](Q[c+1]);Q.length=0}}}function o(a){r(a(n))}function s(a,l=kt){let c=[a,l];return e.add(c),e.size===1&&(i=t(r,o)||kt),a(n),()=>{e.delete(c),e.size===0&&i&&(i(),i=null)}}return{set:r,update:o,subscribe:s}}function ie(n){let t;return mi(n,i=>t=i)(),t}var Se=(n,t,i)=>{let e=t,r=i?.verbose??!1,{set:o,...s}=tt(t,()=>{if(i?.browserOverride||!1){x();let g=v=>{v.key===n&&x()};return window.addEventListener("storage",g),()=>window.removeEventListener("storage",g)}else return()=>{}}),a=JSON.stringify,l=JSON.parse,c=t instanceof Map?"Map":t instanceof Set?"Set":"";["Map","Set"].includes(c)&&(a=g=>JSON.stringify(Array.from(g.entries())),l=g=>{let v=JSON.parse(g);return Array.isArray(v)?t instanceof Map?new Map(v):t instanceof Set?new Set(v):v:(r&&console.error(`Failed to deserialize ${c} from localStorageStore:`,{parsed:v,value:g,initial:t,key:n,options:i}),g)});let h=g=>{e=g,typeof g=="string"&&g.startsWith('"')&&g.endsWith('"')&&(g=l(g)),o(g),m(g),i?.onChange?.(g)},m=g=>{try{g=a(g),localStorage.setItem(n,g)}catch(v){r&&console.error("Failed to set localStorageStore value:",{error:v,key:n,value:g})}};if(i?.defer){let g,v=m;m=I=>{ke(g),g=W(()=>{v(I)})}}if(i?.debounce){let g=setTimeout??(()=>{}),v,I=m;m=G=>{clearTimeout(v),v=g(()=>{I(G)},i.debounce)}}let x=()=>{let g=null;if(g=localStorage.getItem(n)??null,g===null)h(t);else try{let v=l(g);o(v),e=v}catch(v){r&&(console.error("Failed to parse localStorageStore value:",{key:n,localValue:g}),console.error(v))}};return{...s,set:h,update:g=>{h(g(e))}}};function b(n,t){let i=t?.key?Se(t.key,n,{debounce:t?.debounce,onChange:t?.onChange}):tt(n);function e(r){r&&r(i)}return Array.isArray(n)?e(r=>{r.push=o=>{r.update(s=>[...s,o])}}):n instanceof Map&&e(r=>{r.setKey=(o,s)=>{r.update(a=>(a.set(o,s),a))},r.deleteKey=o=>{r.update(s=>{let a=new Map(s);return a.delete(o),a})}}),e(r=>{n instanceof Set&&(r.add=o=>{r.update(s=>new Set(s).add(o))},r.delete=o=>{r.update(s=>{let a=new Set(s);return a.delete(o),a})})}),{...i,isState:!0,get value(){return ie(i)},set value(r){if(r===void 0)throw new Error("Cannot set state to undefined");i.set(r)},refresh(){i.set(ie(i))}}}function M(n){return n.isState===!0}function re(n){return M(n)?n.value:n}var w=(n,t,i)=>Math.max(Math.min(n,i),t);var ne={__type:"ResizableOptions",sides:["right","bottom"],corners:["bottom-right"],grabberSize:6,onResize:()=>{},localStorageKey:void 0,visible:!1,color:"var(--fg-d, #1d1d1d)",opacity:.75,borderRadius:"50%",obstacles:void 0,cursors:!0,classes:{default:"resize-grabber",active:"resize-grabbing"},bounds:"document",disabled:!1},Et=class{constructor(t,i){this.node=t;this.opts=L([ne,i],{concatArrays:!1}),this.disabled=this.opts.disabled,this.#o=new f("resizable",{fg:"GreenYellow",deferred:!1}),this.#o.fn("constructor").info({opts:this.opts,this:this}),this.node.classList.add("fractils-resizable"),this.#n=this.opts.grabberSize*3,this.bounds=O(this.opts.bounds)[0]??globalThis.document?.documentElement,this.obstacleEls=O(this.opts.obstacles),this.generateStyles();let{offsetWidth:e,offsetHeight:r}=t;if(this.size=b({width:e,height:r},{key:this.opts.localStorageKey}),this.opts.localStorageKey){let{width:o,height:s}=this.size.value;o===0||s===0?this.size.set({width:this.node.offsetWidth,height:this.node.offsetHeight}):((this.opts.corners.length||this.opts.sides.some(a=>a.match(/left|right/)))&&(t.style.width=o+"px"),(this.opts.corners.length||this.opts.sides.some(a=>a.match(/top|bottom/)))&&(t.style.height=s+"px")),t.dispatchEvent(new CustomEvent("resize"))}if(this.createGrabbers(),+this.node.style.minWidth>this.boundsRect.width){console.error("Min width is greater than bounds width.");return}this.size.set({width:this.node.offsetWidth,height:this.node.offsetHeight})}static type="Resizable";static initialized=!1;id=S(8);opts;disabled;bounds;obstacleEls;size;#t=null;#e=[];#i=null;#n;#o;get boundsRect(){return this.bounds.getBoundingClientRect()}createGrabbers(){for(let[t,i]of[...this.opts.sides.map(e=>[e,"side"]),...this.opts.corners.map(e=>[e,"corner"])]){let e=document.createElement("div");e.classList.add(`${this.opts.classes.default}-${this.id}`),e.classList.add(`${this.opts.classes.default}-${i}-${this.id}`),e.classList.add(`${this.opts.classes.default}-${t}-${this.id}`),e.dataset.side=t,e.addEventListener("pointerdown",this.onGrab),this.#e.push(()=>e.removeEventListener("pointerdown",this.onGrab)),this.node.appendChild(e)}}clickOffset={x:0,y:0};onGrab=t=>{if(this.disabled)return;this.node.setPointerCapture(t.pointerId),this.#t=t.currentTarget,this.#t.classList.add(this.opts.classes.active),document.body.classList.add(this.opts.classes.active),this.obstacleEls=O(this.opts.obstacles);let i=this.#t.dataset.side;i.match(/top/)&&(this.clickOffset.y=t.clientY-this.rect.top),i.match(/bottom/)&&(this.clickOffset.y=t.clientY-this.rect.bottom),i.match(/left/)&&(this.clickOffset.x=t.clientX-this.rect.left),i.match(/right/)&&(this.clickOffset.x=t.clientX-this.rect.right),t.preventDefault(),t.stopPropagation(),this.#i?.(),document.addEventListener("pointermove",this.onMove),this.#i=()=>document.removeEventListener("pointermove",this.onMove),this.#c(),document.addEventListener("pointerup",this.onUp,{once:!0})};get translateX(){return+this.node.dataset.translateX||0}set translateX(t){this.node.dataset.translateX=String(t)}get translateY(){return+this.node.dataset.translateY||0}set translateY(t){this.node.dataset.translateY=String(t)}get rect(){return this.node.getBoundingClientRect()}#a=0;#l=0;#u=0;#s=0;#r={left:-1/0,top:-1/0,right:1/0,bottom:1/0};#c=()=>{let{minWidth:t,maxWidth:i,paddingLeft:e,paddingRight:r,borderLeftWidth:o,borderRightWidth:s,minHeight:a,maxHeight:l,paddingTop:c,paddingBottom:p,borderTopWidth:h,borderBottomWidth:m}=window.getComputedStyle(this.node),x=parseFloat(e)+parseFloat(r)+parseFloat(o)+parseFloat(s),y=parseFloat(c)+parseFloat(p)+parseFloat(h)+parseFloat(m);this.#a=Math.max((parseFloat(t)||0)+x,25),this.#l=Math.min(parseFloat(i)||1/0),this.#u=Math.max((parseFloat(a)||0)+y,25),this.#s=Math.min(parseFloat(l)||1/0),this.#r=this.bounds.getBoundingClientRect()};resizeX=(t,i)=>{let e;if(i){if(e=t-this.rect.left,e===0)return this;e=pt(e,this.rect,this.obstacleEls),this.#r&&(e=Math.max(e,this.#r.left-this.rect.left));let r=w(this.rect.width-e,this.#a,this.#l);r===this.#a&&(e=this.rect.width-r),this.translateX+=e,this.node.style.setProperty("translate",`${this.translateX}px ${this.translateY}px`),this.node.style.width=`${r}px`}else{if(e=t-this.rect.right,e===0)return this;e=pt(e,this.rect,this.obstacleEls),this.#r&&(e=Math.min(e,this.#r.right-this.rect.right));let r=w(this.rect.width+e,this.#a,this.#l);this.node.style.width=`${r}px`}return this};resizeY=(t,i)=>{let e;if(i){if(e=t-this.rect.top,e!=0){e=dt(e,this.rect,this.obstacleEls),this.#r&&(e=Math.max(e,this.#r.top-this.rect.top));let r=w(this.rect.height-e,this.#u,this.#s);r===this.#u&&(e=this.rect.height-r),this.translateY+=e,this.node.style.setProperty("translate",`${this.translateX}px ${this.translateY}px`),this.node.style.height=`${r}px`}}else if(e=t-this.rect.bottom,e!==0){e=dt(e,this.rect,this.obstacleEls),this.#r&&(e=Math.min(e,this.#r.bottom-this.rect.bottom));let r=w(this.rect.height+e,this.#u,this.#s);this.node.style.height=`${r}px`}return this};onMove=t=>{if(!this.#t){console.error("No active grabber");return}let i=t.clientX-this.clickOffset.x,e=t.clientY-this.clickOffset.y,{side:r}=this.#t.dataset;switch(this.#o.fn("onMove").debug(r),r){case"top-left":this.resizeY(e,!0).resizeX(i,!0);break;case"top-right":this.resizeY(e,!0).resizeX(i);break;case"bottom-right":this.resizeY(e).resizeX(i);break;case"bottom-left":this.resizeY(e).resizeX(i,!0);break;case"top":this.resizeY(e,!0);break;case"right":this.resizeX(i);break;case"bottom":this.resizeY(e);break;case"left":this.resizeX(i,!0);break}this.node.dispatchEvent(new CustomEvent("resize")),this.size.set({width:this.node.offsetWidth,height:this.node.offsetHeight}),this.opts.onResize({width:this.node.offsetWidth,height:this.node.offsetHeight})};onUp=()=>{this.#i?.(),document.body.classList.remove(this.opts.classes.active),this.#t?.classList.remove(this.opts.classes.active),this.node.dispatchEvent(new CustomEvent("release"))};generateStyles(){this.#o.fn("generateStyles").debug("Generating global styles for",this);let t=`
			.resize-grabber-${this.id} {
				position: absolute;
				display: flex;

				opacity: ${this.opts.visible?this.opts.opacity:0};
				border-radius: ${this.opts.borderRadius};
				border-radius: inherit;

				transition: opacity 0.1s;
			}

			.fractils-resizable:not(.fractils-grabbing) .resize-grabber-${this.id}:hover {
				opacity: ${this.opts.opacity/2};
			}

			.resize-grabber-${this.id}:active {
				opacity: ${this.opts.opacity*.75};
			}
		`;this.opts.cursors&&(t+=`
				.resize-grabbing-${this.id} *, .resize-grabber-${this.id}:active {
					cursor: grabbing !important;
				}
			`);let i=p=>this.opts.cursors?`
				cursor: ${p};`:"",e=this.opts.grabberSize/2,r=`transparent 20%, ${this.opts.color} 33%, ${this.opts.color} 66%, transparent 75%, transparent 100%`,o=98;this.opts.sides.includes("top")&&(t+=`
			.${this.opts.classes.default}-top-${this.id} {
				${i("ns-resize")}
				top: ${-e}px;
				left: ${50-o*.5}%;

				width: ${o}%;
				height: ${this.opts.grabberSize}px;

				background: linear-gradient(to bottom, ${r});
			}
		`),this.opts.sides.includes("right")&&(t+=`
			.${this.opts.classes.default}-right-${this.id} {
				${i("ew-resize")}
				right: ${-e}px;
				top: ${50-o*.5}%;

				width: ${this.opts.grabberSize}px;
				height: ${o}%;

				background: linear-gradient(to left, ${r});
			}
		`),this.opts.sides.includes("bottom")&&(t+=`
			.${this.opts.classes.default}-bottom-${this.id} {
				${i("ns-resize")}
				bottom: ${-e}px;
				left: ${50-o*.5}%;

				width: ${o}%;
				height: ${this.opts.grabberSize}px;

				background: linear-gradient(to top, ${r});
			}
		`),this.opts.sides.includes("left")&&(t+=`
				.${this.opts.classes.default}-left-${this.id} {
					${i("ew-resize")}
					left: ${-e}px;
					top: ${50-o*.5}%;

					width: ${this.opts.grabberSize}px;
					height: ${o}%;

					background: linear-gradient(to right, ${r});
				}
			`),t+=".fractils-grabbing .resize-grabber { cursor: default }";let s=this.#n,a={"top-left":"100% 100%","top-right":"0% 100%","bottom-left":"100% 0%","bottom-right":"0% 0%"},l=(p,h)=>{if(!this.opts.corners.includes(p))return;let m=`${this.opts.classes.default}-${p}-${this.id}`,x=p.replace(this.opts.classes.default,"").split("-");t+=`
				.${m} {${i(h)}
					${x[0]}: 0px;
					${x[1]}: 0px;
					width: ${s}px;
					height: ${s}px;
				}
				.${m}::after {
					content: '';
					width: 100%;
					height: 100%;
					background: radial-gradient(farthest-corner at ${a[p]}, transparent 70%, ${this.opts.color} 86%);
					border-radius: 15%;
				}
			`};l("top-left","nwse-resize"),l("top-right","nesw-resize"),l("bottom-left","nesw-resize"),l("bottom-right","nwse-resize");let c=document.createElement("style");c.innerHTML=t,document.head.appendChild(c)}dispose(){for(let t of this.#e)t();this.#i?.()}};function Ie(n){return n!==void 0}function St(n){return typeof n=="string"}function Oe(n){return n instanceof HTMLElement}var E=class{_unlisteners=new Map;_handlers=new Map;_listenerGroups=new Map;_log=new f("EventManager",{fg:"beige"});constructor(t){t&&this.registerEvents([...t])}registerEvents(t){for(let i of t)this._handlers.set(i,new Map)}on(t,i){if(this._log.fn("on").debug(this),!this._handlers.has(t))return this._log.warn(`Event "${String(t)}" is not registered.`,this),"";this._log.debug("new listener:",{event:t,callback:i});let e=S();return this._handlers.get(t).set(e,i),e}emit(t,...i){this._log.fn("emit").debug({event:t});let e=this._handlers.get(t);if(e)for(let r of e.values())r(...i)}listen=(t,i,e,r,o)=>{let s=S();return t.removeEventListener(i,e,r),t.addEventListener(i,e,r),this._unlisteners.set(s,()=>{t.removeEventListener(i,e,r)}),o&&this.group(o,s),s};add=(t,i)=>{let e=S();return this._unlisteners.set(e,t),i&&this.group(i,e),e};group(t,i){return this._listenerGroups.has(t)||this._listenerGroups.set(t,new Set),this._listenerGroups.get(t).add(i),this}unlisten(t){return this._unlisteners.get(t)?.(),this._unlisteners.delete(t)}clear(){for(let t of this._unlisteners.values())t();return this._unlisteners.clear(),this._listenerGroups.clear(),this.clearHandlers(),this}clearHandlers(){for(let t of this._handlers.values())t.clear();return this._handlers.clear(),this}clearGroup(t){let i=this._listenerGroups.get(t);if(i){for(let e of i){let r=this._unlisteners.get(e);r&&r(),this._unlisteners.delete(e)}this._listenerGroups.delete(t)}return this}dispose(){this.clear(),this.clearHandlers()}};var oe=n=>{if(typeof n!="object")throw new Error("element must be an object");if("computedStyleMap"in n)return n.computedStyleMap();{let t=getComputedStyle(n),i=new Map;for(let e=0;e<t.length;e++){let r=t[e],o=t.getPropertyValue(r);o&&i.set(r,o)}return i}},It=(n,t)=>oe(n).get(t);function Ce(n,t=void 0,i=!!1){let e=()=>typeof localStorage>"u"?(i||console.warn(`localStorage is not available for key "${n}"`),!0):!1;return{get(){if(e())return t;let r=localStorage.getItem(n);return r?JSON.parse(r):t},set(r){e()||localStorage.setItem(n,JSON.stringify(r))},get value(){return this.get()},set value(r){this.set(r)}}}function Ot(n,t="top-right",i){let{bounds:e,margin:r}=Object.assign({bounds:void 0,margin:10},i),o=typeof n=="string"?O(n)[0]?.getBoundingClientRect():n instanceof Element?n.getBoundingClientRect():n;if(!o)throw new Error("Invalid node: "+n);let s=e==="window"&&typeof window<"u"?{x:0,y:0,width:window.innerWidth,height:window.innerHeight}:typeof e=="string"?O(e)[0]?.getBoundingClientRect():e??{x:0,y:0,width:100,height:100};if(!s)throw new Error("Invalid bounds: "+e);let a=typeof r=="number"?{x:r,y:r}:r;if(!("x"in a)||!("y"in a))throw new Error("Invalid margin: "+JSON.stringify(a));switch(t){case"center":case"center-center":return{x:s.width/2-o.width/2,y:s.height/2-o.height/2};case"top-left":case"left-top":return{x:a.x,y:a.y};case"top-center":case"center-top":return{x:s.width/2-o.width/2,y:a.y};case"top-right":case"right-top":return{x:s.width-o.width-a.x,y:a.y};case"bottom-left":case"left-bottom":return{x:a.x,y:s.height-o.height-a.y};case"bottom-center":case"center-bottom":return{x:s.width/2-o.width/2,y:s.height-o.height-a.y};case"bottom-right":case"right-bottom":return{x:s.width-o.width-a.x,y:s.height-o.height-a.y};case"left-center":case"center-left":return{x:a.x,y:s.height/2-o.height/2};case"right-center":case"center-right":return{x:s.width-o.width-a.x,y:s.height/2-o.height/2};default:throw new Error("Invalid placement: "+t)}}var bi={default:"fractils-draggable",dragging:"fractils-dragging",dragged:"fractils-dragged",cancel:"fractils-cancel"},ht={__type:"DraggableOptions",bounds:"body",axis:"both",userSelectNone:!0,ignoreMultitouch:!1,disabled:!1,position:{x:0,y:0},placementOptions:{margin:0},cancel:void 0,handle:void 0,obstacles:void 0,classes:bi,onDragStart:()=>{},onDrag:()=>{},onDragEnd:()=>{},onCollision:()=>{},transform:void 0,localStorageKey:void 0},Ct=class{constructor(t,i){this.node=t;this.opts=Object.assign({},ht,i),this.#c=new f("draggable "+Array.from(this.node.classList).join("."),{fg:"SkyBlue"}),this.#l=this.#f(this.opts.bounds),this.opts.position=this.resolvePosition(this.opts.position),this.#c.fn("constructor").debug({opts:this.opts,this:this}),this.positionStore=tt(this.opts.position),this.node.classList.add(this.opts.classes.default);let e=this.opts.position;if(i?.localStorageKey){this._storage=Ce(i.localStorageKey,e);let r=this._storage.get();r&&(e.x=r.x,e.y=r.y)}if(this.x=e.x,this.y=e.y,this.node.style.setProperty("touch-action","none"),this.handleEls=this.opts.handle?O(this.opts.handle,this.node):[this.node],this.cancelEls=O(this.opts.cancel,this.node),this.obstacleEls=O(this.opts.obstacles),this.#s.listen(this.node,"pointerdown",this.dragStart),this.#s.listen(window,"pointerup",this.dragEnd),this.#s.listen(window,"pointermove",this.drag),this.#s.listen(window,"resize",this.resize),this.#s.add(this.positionStore.subscribe(({x:r,y:o})=>{this.node.style.setProperty("translate",`${r}px ${o}px 1px`)})),e!==ht.position){let{top:r,right:o,bottom:s,left:a}=this.node.getBoundingClientRect();this.rect={top:r,right:o,bottom:s,left:a},this.#l(),this.#d(),this.moveTo(e),this._position={x:this.x,y:this.y}}}static initialized=!1;opts;#t=!1;disabled=!1;clickOffset={x:0,y:0};clientToNodeOffset={x:0,y:0};rect={top:0,right:0,bottom:0,left:0};#e="";boundsEl;handleEls;cancelEls;obstacleEls;bounds={left:-1/0,top:-1/0,right:1/0,bottom:1/0};#i=-1/0;#n=-1/0;#o=1/0;#a=1/0;_storage;_position={x:0,y:0};get position(){return this._position}set position(t){this._position=t,this.moveTo(t),this.updateLocalStorage()}#l;eventTarget;positionStore;#u=new Set;#s=new E;#r=()=>{};#c;get x(){return+this.node.dataset.translateX||0}set x(t){this.node.dataset.translateX=String(t)}get y(){return+this.node.dataset.translateY||0}set y(t){this.node.dataset.translateY=String(t)}get canMoveX(){return/(both|x)/.test(this.opts.axis)}get canMoveY(){return/(both|y)/.test(this.opts.axis)}get eventData(){return{x:this.x,y:this.y,rootNode:this.node,eventTarget:this.eventTarget}}get isControlled(){return!!this.opts.position}dragStart=t=>{if(this.disabled||t.button===2||this.opts.ignoreMultitouch&&!t.isPrimary||t.composedPath().some(l=>l.classList?.contains(this.opts.classes.cancel)))return;if(this.obstacleEls=O(this.opts.obstacles),!1)for(let l of this.obstacleEls)l.dataset.outline=l.style.outline,l.style.outline="2px dotted #f007";if(St(this.opts.handle)&&St(this.opts.cancel)&&this.opts.handle===this.opts.cancel)throw new Error("`handle` selector can't be same as `cancel` selector");if(this.#g(this.handleEls))throw new Error("Element being dragged can't be a child of the element on which `cancel` is applied");let i=t.composedPath()[0];if(!this.handleEls.some(l=>l.contains(i)||l.shadowRoot?.contains(i))||this.#g([i]))return;this.#c.fn("dragStart").debug("Dragging initiated."),t.stopPropagation(),this.eventTarget=this.handleEls.length===1?this.node:this.handleEls.find(l=>l.contains(i)),this.#t=!0,this.canMoveX&&(this.clickOffset.x=t.clientX-this.x),this.canMoveY&&(this.clickOffset.y=t.clientY-this.y);let{top:e,right:r,bottom:o,left:s}=this.node.getBoundingClientRect();this.rect={top:e,right:r,bottom:o,left:s},this.bounds&&(this.clientToNodeOffset={x:t.clientX-s,y:t.clientY-e}),this.positionStore.set({x:this.x,y:this.y}),this.#l(),this.#d(),this.node.dispatchEvent(new CustomEvent("grab"));let{cursor:a}=getComputedStyle(this.node);this.node.setPointerCapture(t.pointerId),this.node.style.cursor="grabbing",this.#r=()=>{this.node.style.cursor=a},this.#m(),this.#p()};drag=t=>{if(!this.#t)return;t.preventDefault(),t.stopPropagation(),this.node.classList.add(this.opts.classes.dragging),this.node.classList.add(this.opts.classes.dragged);let i=t.clientX-this.clickOffset.x,e=t.clientY-this.clickOffset.y,r={x:i,y:e};this.moveTo(r),this.#v()};dragEnd=()=>{if(this.#t){if(!1)for(let t of this.obstacleEls)t.style.outline=t.dataset.outline??"none";this.node.classList.remove(this.opts.classes.dragging),this.opts.userSelectNone&&(document.body.style.userSelect=this.#e),this.clickOffset={x:0,y:0},this.clientToNodeOffset={x:0,y:0},this._position={x:this.x,y:this.y},this.#t=!1,this.#r(),this.node.dispatchEvent(new CustomEvent("release")),setTimeout(()=>this.node.classList.remove(this.opts.classes.dragged),0),this.#b(),this.updateLocalStorage()}};resize=()=>{this.#l(),this.#d(),this.moveTo(this.position)};#d=()=>{let t=parseFloat(this.node.style.left)||0;this.#i=-t,this.#o=this.bounds.right-this.bounds.left-(this.rect.right-this.rect.left)-t;let i=parseFloat(this.node.style.top)||0;if(this.#n=-i,this.#a=this.bounds.bottom-this.bounds.top-i-(this.rect.bottom-this.rect.top),this.boundsEl){let e=oe(this.boundsEl);this.#i-=parseFloat(e.get("padding-left")),this.#o-=parseFloat(e.get("padding-right")),this.#n-=parseFloat(e.get("padding-top")),this.#a-=parseFloat(e.get("padding-bottom"))}};moveTo(t){if(this.#c.fn("moveTo").debug("Moving to:",t,this),this.canMoveX){this.bounds&&(t.x=w(t.x,this.#i,this.#o));let i=t.x-this.x;if(i!==0){let e=pt(i,this.rect,this.obstacleEls);this.rect.left+=e,this.rect.right+=e,this.x+=e}}if(this.canMoveY){this.bounds&&(t.y=w(t.y,this.#n,this.#a));let i=t.y-this.y;if(i!==0){let e=dt(i,this.rect,this.obstacleEls);this.rect.top+=e,this.rect.bottom+=e,this.y+=e}}if(!this.opts.transform)this.positionStore.set({x:this.x,y:this.y});else{let i=this.opts.transform?.({x:this.x,y:this.y,rootNode:this.node,eventTarget:this.eventTarget});if(i&&"x"in i&&"y"in i){let{x:e,y:r}=i;this.positionStore.set({x:e,y:r})}}this.#p()}update(t=this.position){this.#c.fn("update").debug("Updating position:",t,this),this.moveTo(t)}updateLocalStorage=()=>{this.opts.localStorageKey&&(this.#c.fn("updateLocalStorage").debug("Updating position in localStorage:",`{ x: ${this._position.x}, y: ${this._position.y} }`,this),this._storage&&this._storage.set(this._position))};clearLocalStorage=()=>{this._storage&&this.opts.localStorageKey&&localStorage.removeItem(this.opts.localStorageKey)};#f(t){if(!t)return()=>{};if(t&&typeof t=="object"&&("left"in t||"right"in t||"top"in t||"bottom"in t))return()=>{this.bounds={left:-1/0,right:1/0,top:-1/0,bottom:1/0,...this.opts.bounds}};let i=Oe(t)?t:t==="body"?document.body:t==="parent"?this.node.offsetParent:St(t)?O(t)[0]:Ie(t)?void 0:document.documentElement;if(!i)throw new Error("Invalid bounds option provided: "+t);this.boundsEl=i;let e=new ResizeObserver(()=>{this.resize(),this.#p()});return e.observe(i),this.#u.add(()=>e.disconnect()),this.#p(),()=>this.bounds=i.getBoundingClientRect()}resolvePosition(t){let i=ht.position;if(!t)return i;if(typeof t=="string")return Ot(this.node,t,{bounds:this.boundsEl?.getBoundingClientRect(),...this.opts.placementOptions});if(typeof t=="object"&&("x"in t||"y"in t))return{...i,...t};throw new Error("Invalid position: "+JSON.stringify(t),{cause:{defaultPos:i,pos:t}})}#g=t=>this.cancelEls.some(i=>t.some(e=>i.contains(e)));#h=(t,i)=>{let e=this.eventData;this.node.dispatchEvent(new CustomEvent(t,{detail:e})),i?.(e)};#m=()=>{this.#h("dragstart",this.opts.onDragStart)};#b=()=>{this.#h("dragend",this.opts.onDragEnd)};#v=()=>{this.#h("drag",this.opts.onDrag)};#p=()=>{this.node.dispatchEvent(new CustomEvent("update",{detail:this}))};dispose(){this.#s.dispose()}};function et(n,t){return typeof n>"u"||n===!0?t:n===!1?!1:typeof n=="object"?L([t,n],{concatArrays:!1}):n}function X(n){return typeof n=="object"&&n!==null}var Lt={__type:"WindowManagerStorageOptions",key:"window-manager",size:!0,position:!0,debounce:50},Mt={__type:"WindowManagerOptions",resizable:ne,draggable:ht,zFloor:10,preserveZ:!1,bounds:void 0,obstacles:void 0,localStorage:void 0},gt=class{windows=new Map;opts;_log=new f("WindowManager",{fg:"lightseagreen"});_evm=new E;constructor(t){t??=Mt,t.__type="WindowManagerOptions",this.opts=Object.freeze(this._resolveOptions(t)),this._log.fn("constructor").info({opts:this.opts,options:t,this:this})}add=(t,i)=>{let e=new se(this,t,i);this.windows.set(e.id,e);let r=this._evm.listen(t,"grab",this.select);return{destroy:()=>{e.dispose(),this.windows.delete(e.id),this._evm.unlisten(r)}}};update(){this.windows.forEach(({resizableInstance:t,draggableInstance:i})=>{i&&i.update(),t&&(t.size=t.size)})}applyZ(){let t=0;for(let i of this.windows.values())i.node.style.setProperty("z-index",String(this.opts.zFloor+t++));return this}select=t=>{let i=t.currentTarget,e=this.windows.get(i.id);if(!e)throw new Error("Unable to resolve instance from selected node: "+i.id);if(this.windows.size>1){let r=i.style.getPropertyValue("z-index");i.style.setProperty("z-index",String(this.opts.zFloor+this.windows.size)),i.dataset.keepZ==="true"||this.opts.preserveZ?addEventListener("pointerup",()=>i.style.setProperty("z-index",r),{once:!0}):(this.windows.delete(e.id),this.windows.set(e.id,e),this.applyZ())}return this};_resolveOptions(t,i=Mt){let e={};return e.zFloor=t?.zFloor??i.zFloor,e.preserveZ=t?.preserveZ??i.preserveZ,e.draggable=et(t?.draggable,i.draggable),e.resizable=et(t?.resizable,i.resizable),e.obstacles=t?.obstacles??i.obstacles,e.bounds=t?.bounds??(X(t?.draggable)?t.draggable.bounds:i.bounds),typeof t?.obstacles>"u"?e.obstacles&&(X(e.draggable)&&(e.draggable.obstacles=e.obstacles),X(e.resizable)&&(e.resizable.obstacles=e.obstacles)):X(e.draggable)&&typeof e.draggable.obstacles>"u"&&(e.draggable.obstacles=t.obstacles),e.bounds&&(e.draggable&&(X(t?.draggable)&&t?.draggable.bounds&&(e.draggable.bounds=t.draggable.bounds),e.draggable.bounds=e.bounds),e.resizable&&(e.resizable.bounds=e.bounds)),typeof t?.localStorage<"u"&&(t.localStorage===!0?e.localStorage=Lt:typeof t.localStorage=="object"&&(e.localStorage=Object.assign({},Lt,t.localStorage),X(e.draggable)&&(e.localStorage.position===!1?e.draggable.localStorageKey=void 0:e.draggable.localStorageKey=e.localStorage.key),X(e.resizable)&&(e.resizable.localStorageKey=e.localStorage.key))),e}dispose(){this._log.fn("dispose").info(this),this._evm?.dispose();for(let t of this.windows.values())t?.dispose();this.windows.clear()}},se=class{constructor(t,i,e){this.manager=t;this.node=i;this.id=i.id||e?.id||`wm-instance-${S(8)}`,i.id||=this.id;let r=t._resolveOptions(e,t.opts),o=r.draggable,s=r.resizable;if(e?.localStorage===!1)o&&(o.localStorageKey=void 0),s&&(s.localStorageKey=void 0);else{if(typeof o=="object"&&o.localStorageKey!==void 0){let a=[];typeof o.localStorageKey>"u"?typeof t.opts.localStorage=="object"?a.push(t.opts.localStorage.key):a.push(Lt.key):o.localStorageKey&&a.push(o.localStorageKey),a.push("wm",`${this.manager.windows.size}`,"position"),o.localStorageKey=a.join("::")}if(typeof s=="object"&&s.localStorageKey!==void 0){let a=[];typeof s.localStorageKey>"u"?typeof t.opts.localStorage=="object"?a.push(t.opts.localStorage.key):a.push(Lt.key):s.localStorageKey&&a.push(s.localStorageKey),a.push("wm",`${this.manager.windows.size}`,"size"),s.localStorageKey=a.join("::")}}this.draggableInstance=new Ct(i,o||{disabled:!0}),this.resizableInstance=new Et(i,s||{disabled:!0}),r?.preserveZ&&(i.dataset.keepZ="true")}draggableInstance;resizableInstance;id;position=b({x:0,y:0});size=b({width:0,height:0});dispose(){this.resizableInstance?.dispose(),this.draggableInstance?.dispose()}};function _(n){if(typeof n!="object"||n===null)throw console.error("Error: Invalid object",n),new Error("`entries()` util called with invalid object: "+n);return Object.entries(n)}function Le(n){if(typeof n!="object"&&n===null)throw console.error("Error: Invalid object",n),new Error("`keys()` util called with invalid object.");return Object.keys(n)}function Pt(n){if(typeof n!="object"&&n===null)throw console.error("Error: Invalid object",n),new Error("`values()` util called with invalid object.");return Object.values(n)}function Rt(n,t){let i={};function e(r,o=""){for(let[s,a]of _(r))typeof a=="object"?e(a,`${o?o+"-":""}${s}`):i[`${o?o+"_":""}${s}`]=a}return e(n),i}var vi="[-\\+]?\\d+%?",yi="[-\\+]?\\d*\\.\\d+%?",Y="(?:"+yi+")|(?:"+vi+")",Me="[\\s|\\(]+("+Y+")[,|\\s]+("+Y+")[,|\\s]+("+Y+")\\s*\\)?",Pe="[\\s|\\(]+("+Y+")[,|\\s]+("+Y+")[,|\\s]+("+Y+")[,|\\s]+("+Y+")\\s*\\)?",Re=new RegExp("rgb"+Me),Ae=new RegExp("rgba"+Pe),Be=new RegExp("hsl"+Me),He=new RegExp("hsla"+Pe),At="^(?:#?|0x?)",J="([0-9a-fA-F]{1})",q="([0-9a-fA-F]{2})",Fe=new RegExp(At+J+J+J+"$"),$e=new RegExp(At+J+J+J+J+"$"),ze=new RegExp(At+q+q+q+"$"),Ge=new RegExp(At+q+q+q+q+"$");function Bt(n){let t=n/100,i,e,r;return t<66?(i=255,e=-155.25485562709179-.44596950469579133*(e=t-2)+104.49216199393888*Math.log(e),r=t<20?0:-254.76935184120902+.8274096064007395*(r=t-10)+115.67994401066147*Math.log(r)):(i=351.97690566805693+.114206453784165*(i=t-55)-40.25366309332127*Math.log(i),e=325.4494125711974+.07943456536662342*(e=t-50)-28.0852963507957*Math.log(e),r=255),{r:w(Math.floor(i),0,255),g:w(Math.floor(e),0,255),b:w(Math.floor(r),0,255)}}var xi=2e3,wi=4e4;function Ve(n){let{r:t,b:i}=n,e=.4,r=xi,o=wi,s;for(;o-r>e;){s=(o+r)*.5;let a=Bt(s);a.b/a.r>=i/t?o=s:r=s}return s}function De(n){let t=n.r/255,i=n.g/255,e=n.b/255,r=Math.max(t,i,e),o=Math.min(t,i,e),s=r-o,a=0,l=r,c=r===0?0:s/r;switch(r){case o:a=0;break;case t:a=(i-e)/s+(i<e?6:0);break;case i:a=(e-t)/s+2;break;case e:a=(t-i)/s+4;break}return{h:a*60%360,s:w(c*100,0,100),v:w(l*100,0,100)}}function Ne(n){let t=n.l*2,i=n.s*(t<=100?t:200-t)/100,e=t+i<1e-9?0:2*i/(t+i);return{h:n.h,s:w(e*100,0,100),v:w((t+i)/2,0,100)}}function Ke(n){let t=n.s/100,i=n.v/100,e=(2-t)*i,r=e<=1?e:2-e,o=r<1e-9?0:t*i/r;return{h:n.h,s:w(o*100,0,100),l:w(e*50,0,100)}}function Ue(n){let t=n.h/60,i=n.s/100,e=n.v/100,r=Math.floor(t),o=t-r,s=e*(1-i),a=e*(1-o*i),l=e*(1-(1-o)*i),c=r%6,p=[e,a,s,s,l,e][c],h=[l,e,e,a,s,s][c],m=[s,s,l,e,e,a][c];return{r:w(p*255,0,255),g:w(h*255,0,255),b:w(m*255,0,255)}}function je(n){if(n.length!==2)throw new Error("Invalid hex string: "+n);return parseInt(n,16)}function F(n,t){let i=n.indexOf("%")>-1,e=parseFloat(n);return i?t/100*e:e}function N(n){return n.toString(16).padStart(2,"0")}var Ti={h:0,s:0,v:0,a:1},$=class n{isColor=!0;#t;#e;constructor(t){return this.#t=Ti,t&&this.set(t),this.#e=structuredClone(this.#t),this}set(t){if(typeof t=="string")/^(?:#?|0x?)[0-9a-fA-F]{3,8}$/.test(t)?this.hexString=t:/^rgba?/.test(t)?this.rgbString=t:/^hsla?/.test(t)&&(this.hslString=t);else if(typeof t=="object")t instanceof n?this.hsva=t.hsva:"r"in t&&"g"in t&&"b"in t?this.rgb=t:"h"in t&&"s"in t&&"v"in t?this.hsv=t:"h"in t&&"s"in t&&"l"in t?this.hsl=t:"kelvin"in t&&(this.kelvin=t.kelvin);else throw new Error("Invalid color value: "+t)}setChannel(t,i,e){this[t]={...this[t],[i]:e}}reset(){this.hsva=this.#e}clone(){return new n(this)}get hsv(){let{h:t,s:i,v:e}=this.#t;return{h:t,s:i,v:e}}set hsv(t){let e={...this.#t,...t};this.#t.h===e.h&&this.#t.s===e.s&&this.#t.v===e.v&&this.#t.a===e.a||(this.#t={h:Math.round(e.h),s:Math.round(e.s),v:Math.round(e.v),a:e.a})}get hsva(){return structuredClone(this.#t)}set hsva(t){this.hsv=t}get hue(){return this.#t.h}set hue(t){this.hsv={h:t}}get saturation(){return this.#t.s}set saturation(t){this.hsv={s:t}}get value(){return this.#t.v}set value(t){this.hsv={v:t}}get lightness(){return this.hsl.l}set lightness(t){this.hsl={...this.hsl,l:t}}get alpha(){return this.#t.a??1}set alpha(t){this.hsv={...this.hsv,a:t}}get kelvin(){return Ve(this.rgb)}set kelvin(t){this.rgb=Bt(t)}get red(){return this.rgb.r}set red(t){this.rgb={...this.rgb,r:t}}get r(){return this.rgb.r/255}set r(t){this.red=t*255}get green(){return this.rgb.g}set green(t){this.rgb={...this.rgb,g:t}}get g(){return this.rgb.g/255}set g(t){this.green=t*255}get blue(){return this.rgb.b}set blue(t){this.rgb={...this.rgb,b:t}}get b(){return this.rgb.b/255}set b(t){this.blue=t*255}get rgb(){let{r:t,g:i,b:e}=Ue(this.#t);return{r:Math.round(t),g:Math.round(i),b:Math.round(e)}}set rgb(t){this.hsv={...De(t),a:"a"in t?t.a:1}}get rgbf(){return{r:this.r,g:this.g,b:this.b}}set rgbf(t){this.rgb={r:t.r,g:t.g,b:t.b}}get rgba(){return{...this.rgb,a:this.alpha}}set rgba(t){this.rgb=t}get hsl(){let{h:t,s:i,l:e}=Ke(this.#t);return{h:Math.round(t),s:Math.round(i),l:Math.round(e)}}set hsl(t){this.hsv={...Ne(t),a:"a"in t?t.a:1}}get hsla(){return{...this.hsl,a:this.alpha}}set hsla(t){this.hsl=t}get rgbString(){return`rgb(${this.rgb.r}, ${this.rgb.g}, ${this.rgb.b})`}set rgbString(t){let i,e,r,o,s=1;if(i=Re.exec(t))e=F(i[1],255),r=F(i[2],255),o=F(i[3],255);else if(i=Ae.exec(t))e=F(i[1],255),r=F(i[2],255),o=F(i[3],255),s=F(i[4],1);else throw new Error("Invalid rgb string: "+t);this.rgb={r:e,g:r,b:o,a:s}}get rgbaString(){let t=this.rgba;return`rgba(${t.r}, ${t.g}, ${t.b}, ${t.a})`}set rgbaString(t){this.rgbString=t}get hex(){return this.hex8String}get hexString(){let t=this.rgb;return`#${N(t.r)}${N(t.g)}${N(t.b)}`}set hexString(t){let i=t.match(Fe)||t.match($e)||t.match(ze)||t.match(Ge);if(!i)throw new Error("Invalid hex string");let[e,r,o,s=255]=i.slice(1).map(a=>je(a.length===1?`${a}${a}`:a));this.rgb={r:e,g:r,b:o,a:+s/255}}get hex8(){return this.hex8String}get hex8String(){let t=this.rgba;return`#${N(t.r)}${N(t.g)}${N(t.b)}${N(Math.floor((t.a??1)*255))}`}set hex8String(t){this.hexString=t}get hslString(){let t=this.hsl;return`hsl(${t.h}, ${t.s}%, ${t.l}%)`}set hslString(t){let i=Be.exec(t)||He.exec(t);if(!i)throw new Error("Invalid rgb string: "+t);let[e,r,o,s=1]=i.slice(1).map((a,l)=>F(a,l<3?255:1));this.rgb={r:e,g:r,b:o,a:s}}get hslaString(){let t=this.hsla;return`hsla(${t.h}, ${t.s}%, ${t.l}%, ${t.a})`}set hslaString(t){this.hslString=t}toString(){return this.hex8String}toJSON(){return{isColor:!0,...this.rgba,hex:this.hex8String}}};function it(n){return!!n.isColor}function We(n){return typeof ae(n)<"u"}function ae(n){if(typeof n=="string"){if(n.match(/^#?[0-9a-fA-F]{6}$/))return"HexString";if(n.match(/^#?[0-9a-fA-F]{8}$/))return"Hex8String";if(n.match(/^rgba?/))return"RgbaString";if(n.match(/^hsla?/))return"HslaString"}else if(typeof n=="object"){if(n instanceof $)return"Color";if("r"in n&&"g"in n&&"b"in n)return"RgbColor";if("h"in n&&"s"in n&&"v"in n)return"HsvColor";if("h"in n&&"s"in n&&"l"in n)return"HslColor";if("kelvin"in n)return"number"}}function Ht(n,t){return typeof n!="object"||n===null||["object","function"].includes(t)?typeof n===t:"__type"in n&&n.__type===t}function T(n){return typeof n=="function"?n:()=>n}var Ft={__type:"TooltipOptions",text:"",placement:"top",anchor:"node",delay:250,delayOut:0,offsetX:"0%",offsetY:"0%",animation:{duration:300,durationOut:150,easing:"cubic-bezier(0.23, 1, 0.320, 1)"},style:void 0,hideOnClick:!1},R=@K class{constructor(t,i){this.node=t;let e=L([Ft,i]);if(this.opts=e,this.placement=e.placement,this._text=T(e.text),this.parent=i?.parent??document.getElementById("svelte")??document.body,this.element=u("div",{classes:["fractils-tooltip"],innerHTML:String(this._text()),style:i?.style}),e.style)for(let[r,o]of _(e.style))r&&o&&this.element?.style.setProperty(r,o);this._evm.listen(t,"pointerenter",this.show),this._evm.listen(t,"pointerleave",this.hide),this._evm.listen(t,"pointermove",this._updatePosition),this._evm.listen(t,"click",()=>{e.hideOnClick?this.hide():this.refresh()})}__type="Tooltip";element;parent;showing=!1;opts;_text;_evm=new E;_animPositions;_delayInTimer;_delayOutTimer;refresh(){this.element&&(this.element.innerHTML=String(this.text),setTimeout(()=>this._updatePosition(),0),this._maybeWatchAnchor(),clearTimeout(this._delayInTimer),clearTimeout(this._delayOutTimer))}get text(){return this._text()}set text(t){this._text=T(t),this.element&&(this.element.innerHTML=String(this._text()))}get placement(){return this.opts.placement}set placement(t){switch(this.opts.placement=t,t){case"top":this._animPositions={from:"translateY(4px)",to:"translateY(0)"};break;case"bottom":this._animPositions={from:"translateY(-4px)",to:"translateY(0)"};break;case"left":this._animPositions={from:"translateX(4px)",to:"translateX(0)"};break;case"right":this._animPositions={from:"translateX(-4px)",to:"translateX(0)"}}}get offsetX(){return this.opts.offsetX}set offsetX(t){this.opts.offsetX=t,this._updatePosition()}get offsetY(){return this.opts.offsetY}set offsetY(t){this.opts.offsetY=t,this._updatePosition()}show=()=>{this.showing||this.text&&(clearTimeout(this._delayInTimer),clearTimeout(this._delayOutTimer),this._delayInTimer=setTimeout(async()=>{this.element&&this.parent?.appendChild(this.element),this.showing=!0,this.element?.animate([{opacity:"0",transform:this._animPositions.from},{opacity:"1",transform:this._animPositions.to}],{duration:this.opts.animation.duration,easing:this.opts.animation.easing,fill:"forwards"}),this._updatePosition(),this._maybeWatchAnchor()},this.opts.delay))};hide=()=>{clearTimeout(this._delayInTimer),clearTimeout(this._delayOutTimer),this._delayOutTimer=setTimeout(async()=>{this.showing&&(this.showing=!1,this._watcherId&&this._evm.unlisten(this._watcherId),await this.element?.animate([{opacity:"1",transform:this._animPositions.to},{opacity:"0",transform:this._animPositions.from}],{duration:this.opts.animation.durationOut,easing:this.opts.animation.easing,fill:"forwards"}).finished,this.unmount())},this.opts.delayOut)};_mounted=!1;mount(){this._mounted||(this._mounted=!0,this.element&&this.parent?.appendChild(this.element))}unmount(){this._mounted&&(this._mounted=!1,this.element&&this.parent?.removeChild(this.element))}_updatePosition=t=>{if(!this.element)return;let i=this.element.getBoundingClientRect();this.element.innerHTML!==this.text&&(this.element.innerHTML=String(this.text)),t?.type==="pointermove"&&(this._mouse={x:t.clientX,y:t.clientY});let e=this._getAnchorRects();if(!e)return;let r=0,o=0,s=4;switch(this.element.classList.add("fractils-tooltip-"+this.placement),this.placement){case"top":r=e.x.left+window.scrollX+e.x.width/2-i.width/2,o=e.y.top+window.scrollY-i.height-s;break;case"bottom":r=e.x.left+window.scrollX+e.x.width/2-i.width/2,o=e.y.top+window.scrollY+e.y.height+s;break;case"left":r=e.x.left+window.scrollX-i.width-s,o=e.y.top+window.scrollY+e.y.height/2-i.height/2;break;case"right":r=e.x.left+window.scrollX+e.x.width+s,o=e.y.top+window.scrollY+e.y.height/2-i.height/2;break}let a=this.parent?.getBoundingClientRect();a&&(this.element.style.left=`calc(${r-a.left}px + ${this.opts.offsetX})`,this.element.style.top=`calc(${o-a.top}px + ${this.opts.offsetY})`)};_mouse={x:0,y:0};_getAnchorRects(){let t=e=>{if(!e)return this.node?.getBoundingClientRect();switch(typeof e){case"string":switch(e){case"node":return this.node?.getBoundingClientRect();case"mouse":return{left:this._mouse.x+window.scrollX,top:this._mouse.y+window.scrollY,width:0,height:0};default:{let r=document.querySelector(e);return r?r.getBoundingClientRect():(!1,this.node?.getBoundingClientRect())}}case"object":return e&&"x"in e&&"y"in e?"separate":e instanceof HTMLElement?e.getBoundingClientRect():(!1,this.node?.getBoundingClientRect());default:return!1,this.node?.getBoundingClientRect()}},i=t(this.opts.anchor);if(i==="separate"){let e=t(this.opts.anchor.x),r=t(this.opts.anchor.y);return!e||!r?void 0:{x:e,y:r}}if(i)return{x:i,y:i}}_watcherId;_maybeWatchAnchor(){let t=e=>{if(!e)return;let r=e instanceof HTMLElement?e:this.node?.querySelector(e)??document.querySelector(e),o=()=>{r&&this._watch(r)};r&&(this._watcherId&&this._evm.unlisten(this._watcherId),this._watcherId=this._evm.listen(r,"transitionrun",o,{},"anchor"))},i=e=>e instanceof HTMLElement?e:typeof e=="string"?e==="node"?this.node:e==="mouse"?null:e:null;if(this.opts.anchor&&typeof this.opts.anchor=="object"&&"x"in this.opts.anchor&&"y"in this.opts.anchor){let e=i(this.opts.anchor.x),r=i(this.opts.anchor.y);e===r?t(e):(t(e),t(r))}else t(i(this.opts.anchor))}_watchingAnchor=!1;_watchingFinished=!1;_watchTimeout=void 0;_watch(t){if(this._watchingAnchor)return;this._watchingFinished=!1,this._watchingAnchor=!0;let i=()=>{this._watchingFinished=!0,this._watchingAnchor=!1,this.element?.style.setProperty("transition-duration","0.1s"),e&&t.removeEventListener("transitionend",e)},e=()=>{this._watchingFinished||i()};if(!this.showing){i();return}clearTimeout(this._watchTimeout),this._watchTimeout=setTimeout(()=>{this._watchingFinished||i()},500),t.removeEventListener("transitionend",e),t.addEventListener("transitionend",e),this._watchingFinished||(this.node?.style.setProperty("transition-duration","0s"),Xe(()=>this._watchingFinished?!0:(this._updatePosition(),!1)))}dispose(){this._watchTimeout&&clearTimeout(this._watchTimeout),this._evm.dispose(),this.element?.remove()}static style=`
		.fractils-tooltip {
			position: absolute;

			min-width: 3rem;
			max-width: auto;
			min-height: auto;
			max-height: auto;
			padding: 4px 8px;

			opacity: 0;
			color: var(--fg-a, #fff);
			background-color: var(--bg-a, #000);
			border-radius: var(--radius-sm, 4px);
			box-shadow: var(--shadow, 0rem 0.0313rem 0.0469rem hsl(var(--shadow-color) / 0.02),
				0rem 0.125rem 0.0938rem hsl(var(--shadow-color) / 0.02),
				0rem 0.1563rem 0.125rem hsl(var(--shadow-color) / 0.025),
				0rem 0.1875rem 0.1875rem hsl(var(--shadow-color) / 0.05),
				0rem 0.3125rem 0.3125rem hsl(var(--shadow-color) / 0.05),
				0rem 0.4375rem 0.625rem hsl(var(--shadow-color) / 0.075));

			text-align: center;
			font-size: var(--font-size-sm, 12px);

			z-index: 1000;
			pointer-events: none;
			transition: opacity 0.1s;
		}

		.fractils-tooltip .fractils-hotkey {
			filter: contrast(1.1);
			background: var(--fractils-hotkey_background, #1118);
			background: var(--fractils-hotkey_background, color-mix(in sRGB, var(--bg-c) 66%, transparent));
			color: var(--fractils-hotkey_color, var(--fg-a, #fff));
			padding: 0px 3px;
			border-radius: 2px;
			box-shadow: 0 0 2px rgba(0, 0, 0, 0.33);
		}

		:root[theme='dark'] .fractils-tooltip .fractils-hotkey {
			background: var(--fractils-hotkey_background, color-mix(in sRGB, var(--bg-d) 100%, transparent));
		}
	`},le=(n,t)=>{let i=new R(n,t);return{update(e){Object.assign(i.opts,e),i.refresh()},destroy(){i.dispose()}}};function Xe(n){requestAnimationFrame(()=>{n()||Xe(n)})}function u(n,t){let i=globalThis?.document?.createElement(n);if(t){if(t.classes&&i.classList.add(...t.classes),t.id&&(i.id=t.id),t.innerHTML&&(i.innerHTML=t.innerHTML),t.textContent&&(i.textContent=t.textContent),t.innerText&&(i.innerText=t.innerText),t.cssText&&(i.style.cssText=t.cssText),t.dataset&&Object.assign(i.dataset,t.dataset),t.value&&i instanceof HTMLInputElement&&(i.value=t.value),t.type&&i.setAttribute("type",t.type),t.min&&i.setAttribute("min",String(t.min)),t.max&&i.setAttribute("max",String(t.max)),t.step&&i.setAttribute("step",String(t.step)),t.attributes)for(let[e,r]of _(t.attributes))i.setAttribute(e,r);if(t.style)for(let[e,r]of _(t.style))i.style[e]=String(r);if(t.variables)for(let[e,r]of _(t.variables))i.style.setProperty(e,String(r));if(t.parent&&t.parent.appendChild(i),t.tooltip&&(i.tooltip={},t.tooltipInstance?i.tooltip=t.tooltipInstance:i.tooltip=new R(i,t.tooltip)),t.children)for(let e of t.children??[]){if(i===null)throw new Error("This should never happen");e&&i.appendChild(e)}t.onclick&&i.addEventListener("click",t.onclick)}if(!1){let e=new Error().stack;_i(e,i)}return i}function _i(n,t){let i=Ei(n);i&&t.addEventListener("contextmenu",e=>{e.metaKey&&e.altKey&&(e.preventDefault(),e.stopPropagation(),console.log(e.target),ki(i))},{capture:!1})}function ki(n){let t="/__open-in-editor?file="+n;fetch(t).then(i=>{console.log(i.status,t)}).catch(i=>{console.error("Failed to open file in editor:",i)})}function Ei(n){let t=n?.split(`
`)[2].trim(),i=/http:\/\/[^ )]+/,e=/\?t=\d+/,r=t?.match(i)?.[0]?.replace(e,"");if(r)try{return new URL(r).pathname.slice(1)}catch(o){console.error("Failed to parse file from stack:",o)}return null}function K(n){return class extends n{static initialized=!1;static stylesheet;constructor(...t){if(super(...t),typeof globalThis.document<"u"){let i=this.constructor;if(!i.style||i.initialized)return;i.initialized=!0,i.stylesheet??=u("style",{parent:document.head,innerHTML:i.style})}else throw new Error("@styled components can only be used in the browser")}}}var $t=@K class{class="fracgui-icon-rename";element;classes=[this.class,"fracgui-icon"];constructor(){this.element=u("div",{classes:this.classes,innerHTML:`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" >
                    <path class="cursor top" fill="none" stroke="currentColor" d="M5 4h1a3 3 0 0 1 3 3 3 3 0 0 1 3-3h1" vector-effect="non-scaling-stroke"></path>
                    <path class="cursor bottom"fill="none" stroke="currentColor" d="M13 20h-1a3 3 0 0 1-3-3 3 3 0 0 1-3 3H5" vector-effect="non-scaling-stroke"></path>
                    <rect class="box full" fill="currentColor" stroke="none" x="1" y="8" width="18" height="8" rx="2" vector-effect="non-scaling-stroke"></rect>
                    <path class="cursor middle"fill="none" stroke="currentColor" d="M9 7v10" vector-effect="non-scaling-stroke"></path>
                </svg>
            `.replaceAll(/\t|\n/g,"")})}static style=`
        .fracgui-icon-rename {
            width: 1.5rem;
            height: 1.5rem;

            margin-right: 0.5rem;
            padding: 0.125rem;

            color: var(--fracgui-controller-dim_color);
            opacity: 0.5;

            transition: opacity 0.15s;

            z-index: 1;
            cursor: pointer;

            pointer-events: all;
        }

        .fracgui-icon-rename:hover {
            opacity: 1;
        }

        .fracgui-icon-rename svg {
            width: 100%;
            height: 100%;

            pointer-events: none;
        }

        .fracgui-icon-rename path {
            color: var(--fracgui-controller-dim_color);
            /* stroke: var(--fracgui-controller-dim_color); */
        }
        .fracgui-icon-rename .cursor {
            transform: translate(2px, 0) scale(1, 0.9);

            transition: 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transition-delay: 0s;
            transition-property: opacity, transform;
            transform-origin: center;
        }
        .fracgui-icon-rename:hover .cursor, .fracgui-icon-rename.active .cursor {
            transform: translate(0, 0);
            transform: translate(0, 0) scale(1, 0.9);
        }
        .fracgui-icon-rename.active .cursor {
            color: var(--fracgui-theme-a);
            animation: blink 1.5s infinite;
            animation-delay: 0.5s;
        }

        @keyframes blink {
            0%, 45%, 80% {
                opacity: 1;
            }
            50%, 75% {
                opacity: 0;
            }
        }

        .fracgui-icon-rename .box {
            color: var(--fracgui-folder-dim_color);

            opacity: 0;
            transform: scale(0);

            transition: 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transition-property: opacity, transform;
            transform-origin: center;
        }
        .fracgui-icon-rename:hover .box, .fracgui-icon-rename.active .box {
            opacity: 0.25;
            transform: scale(1.1);
            color: var(--fracgui-controller_color);
        }
        .fracgui-icon-rename:hover .box {
            transform: scale(1);
        }
        
        .fracgui-icon-rename.disabled {
            opacity: 0;
            pointer-events: none;
            cursor: default;
        }
    `};var zt=@K class{element;constructor(){this.element=u("div",{classes:["fracgui-icon-save","fracgui-icon"],innerHTML:`
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                    <g class="Frame">
                        <path class="back-group" fill="currentColor" fill-rule="evenodd" d="M6.127 21A3.496 3.496 0 0 0 9 22.5h10a3.5 3.5 0 0 0 3.5-3.5V9c0-1.19-.593-2.24-1.5-2.873V7.5c.314.418.5.937.5 1.5v10a2.5 2.5 0 0 1-2.5 2.5H9a2.489 2.489 0 0 1-1.5-.5H6.127Z" class="Subtract" clip-rule="evenodd"/>
                        <rect width="16" height="16" x="3" y="3" fill="currentColor" stroke-width="1.5" class="front" rx="2"/>
                        <g class="plus">
                            <path stroke="currentColor" stroke-linecap="round" stroke-width="1.5" d="M11 8v7" class="vertical"/>
                            <path stroke="currentColor" stroke-linecap="round" stroke-width="1.5" d="M14.5 11.5h-7" class="horizontal"/>
                        </g>
                    </g>
                </svg>
            `.replaceAll(/\t|\n/g,"")})}static style=`
        .fracgui-icon-save {
            width: 1.5rem;
            height: 1.5rem;

            color: var(--fracgui-controller-dim_color);
            margin-right: 0.25rem;
            opacity: 0.5;

            transition: opacity 0.15s;

            z-index: 1;
            cursor: pointer;
        }

        .fracgui-icon-save:hover {
            opacity: 1;
        }

        .fracgui-icon-save .back-group {
            transition: 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transition-property: opacity, transform;
            transition-delay: 0s;
            
            opacity: 0;
            transform: translate(-0.25rem, -0.25rem);
        }
        .fracgui-icon-save:hover .back-group {
            opacity: 1;
            transition-delay: 0.25s;
            transform: translate(0, 0);
        }

        .fracgui-icon-save .plus {
            transition: 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transition-property: color, transform;
            transform-origin: center;

            transform: scale(1.5);
        }
        .fracgui-icon-save:hover .plus {
            transform: scale(1);
            color: var(--fracgui-bg-a);
        }

        .fracgui-icon-save .front {
            transition: 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transition-property: transform, opacity;

            transform: scale(1.25);
            opacity: 0;
        }
        .fracgui-icon-save:hover .front {
            transform: scale(1);
            opacity: 1;
        }

        .fracgui-icon-save svg {
            width: 100%;
            height: 100%;
        }
    `};var Gt=class{constructor(t,i,e){this.gui=t;this.parentFolder=i;this._log=new f(`PresetManager ${t.folder.title}`,{fg:"slateblue"}),this._log.fn("constructor").debug({options:e,this:this}),this.opts=e,this.opts.localStorageKey??="fracgui::presets",this.activePreset=b(this.opts.defaultPreset??{},{key:this.opts.localStorageKey+"::active"}),this.presets=b(this.opts.presets??[],{key:this.opts.localStorageKey}),this.opts.autoInit!==!1&&this.init(),this.activePreset.value.id!==this._defaultPresetId&&Promise.resolve().then(()=>{this.gui.load(this.activePreset.value),this.gui._undoManager.clear()})}__type=Object.freeze("PresetManager");__version=Object.freeze("1.0.0");defaultPreset;activePreset;presets;folder;_defaultPresetId="fracgui-default-preset";_defaultPresetTitle="default";_presetSnapshot;_presetsInput;_manageInput;_renamePresetButton;_initialized=!1;_log;opts;get defaultPresetIsActive(){return this.activePreset.value.id===this._defaultPresetId}async init(){if(this.opts.disabled){this._log.debug("Aborting initialization: disabled by options.");return}return this._initialized=!0,this.folder=await this.addGui(this.parentFolder,this.opts.defaultPreset),this}set(t){this._log.fn("set").debug({value:t,this:this}),this.activePreset.set(t)}_renamePreset(t){if(this._log.fn("_renamePreset").debug({this:this,title:t}),!this._isInitialized())throw new Error("PresetManager not initialized.");let i=this.activePreset.value;this.presets.update(e=>{if(!i)throw new Error("No preset found.");if(i.id===this._defaultPresetId)throw new Error("Cannot rename default preset.");return i.title=t,this.activePreset.set(i),e.map(r=>r.id===i.id?i:r)}),this._refresh()}_resolveUnusedTitle(t){if(this._log.fn("resolveUnusedTitle").debug({this:this,title:t}),!this._isInitialized())throw new Error("PresetManager not initialized.");let i=this.presets.value,e=0,r=t;for(;i.some(o=>o.title===r);)e++,r=t+` (${e})`;return r}_resolveDefaultPreset(t){if(!this._isInitialized())throw new Error("PresetManager not initialized.");return t??=this.presets.value.find(i=>i.id===this._defaultPresetId),t||(t=this.gui.save(this._defaultPresetTitle,this._defaultPresetId),this.presets.push(t)),t}async addGui(t,i){if(this._log.fn("add").debug({this:this,parentFolder:t,defaultPreset:i}),!this._isInitialized())throw new Error("PresetManager not initialized.");await new Promise(l=>setTimeout(l,0));let e=t.addFolder("presets",{closed:!1,hidden:!1,children:[]});if(e.on("mount",()=>{e.graphics?.connector?.svg.style.setProperty("filter","saturate(0.1)"),e.graphics?.icon.style.setProperty("filter","saturate(0)")}),this.defaultPreset=i??this._resolveDefaultPreset(),Object.keys(this.activePreset.value).length||this.activePreset.set(this.defaultPreset),!this.activePreset.value)throw new Error("No active preset.");if(!this.activePreset.value.id)throw new Error("No active preset id.");let r=l=>{let c=Array.isArray(l)?this.gui.folder.title+" presets":l.title,p=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),h=URL.createObjectURL(p),m=document.createElement("a");m.href=h,m.download=`${c}.json`,m.click(),URL.revokeObjectURL(h)},o=()=>{let l=document.createElement("input");l.type="file",l.accept=".json",l.onchange=async c=>{let p=c.target.files?.[0];if(!p)return;let h=new FileReader;h.onload=async m=>{let x=m.target?.result,y=JSON.parse(x);if(Array.isArray(y))for(let g of y)Ht(g,"GuiPreset")?this.put(g):console.warn("Invalid preset:",g);else Ht(y,"GuiPreset")?this.put(y):console.warn("Invalid preset:",y);this._refresh()},h.readAsText(p)},l.click()},s=(l,c)=>`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" class="fracgui-icon fracgui-icon-${l}">${c}</svg>`;this._manageInput=e.addButtonGrid({value:[[{text:"update",id:"update",onClick:()=>{let{id:l,title:c}=this.activePreset.value,p=this.gui.save(c,l);this.put(p)},disabled:()=>this.defaultPresetIsActive},{text:"delete",onClick:()=>{let l;this.presets.update(c=>(l=c.findIndex(p=>p.id===this.activePreset.value.id),c.splice(l,1),c)),this.activePreset.set(this.presets.value[l??0]??this.defaultPreset),this._refresh()},disabled:()=>this.defaultPresetIsActive},{text:s("copy",'<rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>'),id:"copy",tooltip:{text:"Copy",delay:0,placement:"bottom",hideOnClick:!0},style:{maxWidth:"1.5rem",padding:"0.3rem"},onClick:()=>{navigator.clipboard?.writeText(JSON.stringify(this.activePreset.value,null,2))},disabled:()=>this.defaultPresetIsActive},{text:s("paste",'<rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>'),id:"paste",tooltip:{text:"Paste",delay:0,placement:"bottom",hideOnClick:!0},style:{maxWidth:"1.5rem",padding:"0.3rem"},onClick:async({button:l})=>{l.disabled=!0;try{let c=await navigator.clipboard.readText();if(console.log(c),c){let p=JSON.parse(c);typeof p=="object"&&p.__type==="GuiPreset"&&this.put(p)}}catch(c){console.error(c)}l.disabled=!1},disabled:()=>this.defaultPresetIsActive},{text:s("download",'<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" x2="12" y1="15" y2="3"></line></svg>'),id:"download",tooltip:{text:"Download",delay:0,placement:"bottom",hideOnClick:!0},style:{maxWidth:"1.5rem",padding:"0.3rem"},onClick:()=>{r(this.activePreset.value)},disabled:()=>this.defaultPresetIsActive},{text:s("download-all",'<path stroke-linecap="round" stroke-linejoin="round" d="M21 14v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><path stroke-linecap="round" stroke-linejoin="round" d="M21 11v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><path stroke-linecap="round" stroke-linejoin="round" d="M21 17v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><path stroke-linecap="round" stroke-linejoin="round" d="m7 8 5 5 5-5" /><path  stroke-linecap="round" stroke-linejoin="round" d="M12 13V1" />'),id:"download-all",tooltip:{text:"Download All",delay:0,placement:"bottom",hideOnClick:!0},style:{maxWidth:"1.5rem",padding:"0.3rem"},onClick:()=>{r(this.presets.value)},disabled:()=>this.presets.value.length<=1},{id:"upload",text:s("upload",'<path stroke-linecap="round" stroke-linejoin="round" d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><path stroke-linecap="round" stroke-linejoin="round" d="m17 8-5-5-5 5" /><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v12" />'),tooltip:{text:"Upload",delay:0,placement:"bottom",hideOnClick:!0},style:{maxWidth:"1.5rem",padding:"0.3rem"},onClick:()=>{o()}}]],order:1,resettable:!1,disabled:()=>this.defaultPresetIsActive&&this.presets.value.length===1}),this._presetsInput=e.addSelect({__type:"SelectInputOptions",options:this.presets.value,labelKey:"title",order:-1,value:this.activePreset.value,resettable:!1,disabled:()=>this.defaultPresetIsActive&&this.presets.value.length===1}),this._presetsInput.on("change",({value:l})=>{this._log.fn("_presetsInput.on(change)").debug({value:l,this:this}),this.gui.load(l),this.activePreset.set(l),this._refreshInputs()}),this._presetsInput.on("open",()=>{this._log.fn("_presetsInput.on(open)").debug(),this._presetSnapshot=this.gui.save("__snapshot__")}),this._presetsInput.on("cancel",()=>{this._log.fn("_presetsInput.on(cancel)").debug(),this._presetSnapshot&&(this.gui.load(this._presetSnapshot),this._refreshInputs())});let a=new zt;return a.element.tooltip=new R(a.element,{text:"Save",delay:0,placement:"bottom",hideOnClick:!0}),this._presetsInput.listen(a.element,"click",()=>{this._log.fn("newPresetButton.on(click)").debug(),this.put()}),this._renamePresetButton=new $t,this._renamePresetButton.element.tooltip=new R(this._renamePresetButton.element,{delay:0,placement:"bottom",hideOnClick:!0,text:()=>this._renamePresetButton.element.classList.contains("active")?"":this.defaultPresetIsActive?"Can't rename default preset":"Rename"}),this._presetsInput.listen(this._renamePresetButton.element,"click",this._toggleRename),this._presetsInput.elements.content.prepend(this._renamePresetButton.element),this._presetsInput.elements.content.prepend(a.element),this._refreshInputs(),e}put(t){if(this._log.fn("saveNewPreset"),!this._isInitialized())throw new Error("PresetManager not initialized.");if(!this._presetsInput)throw new Error("No select input.");t??=this.gui.save(this._resolveUnusedTitle("preset"),S());let i=this.presets.value.find(e=>e.id===t.id);i?(this._log.debug("preset exists. replacing with:",{preset:t,existing:i}),this.presets.update(e=>{let r=e.findIndex(o=>o.id===t.id);return e[r]=t,e})):(this._log.debug("pushing preset:",{preset:t,existing:i}),this.presets.push(t)),this.set(t),this._refresh(),this._enableRename()}delete(t){if(this._log.fn("deletePreset").debug({this:this,preset:t}),!this._isInitialized())throw new Error("PresetManager not initialized.");let i=typeof t=="string"?t:t.id;this.presets.update(e=>{let r=e.findIndex(o=>o.id===i);if(r===-1)throw new Error(D("Error deleting preset:")+" Preset not found.");return e.splice(r,1),e}),this.activePreset.set(this.presets.value[0]??this.defaultPreset)}_isInitialized(){return this._initialized}_toggleRename=()=>{this._presetsInput.select.elements.selected.getAttribute("contenteditable")?this._handleRename():this._enableRename()};_blurLatch=!1;_blurLatchTimer;_enableRename=(t=!0)=>{this._log.fn("_enableRename").debug({this:this});let i=this._presetsInput.select.elements.selected;if(i.classList.contains("disabled")){this._log.warn("Cannot rename default preset.");return}if(this._blurLatch){this._blurLatch=!1,clearTimeout(this._blurLatchTimer);return}this._renamePresetButton.element.classList.add("active"),this._presetsInput.select.disableClicks=!0,i.setAttribute("contenteditable","true"),i.focus();let e=document.createRange();e.selectNodeContents(i),t&&e.collapse(!1);let r=window.getSelection();r?.removeAllRanges(),r?.addRange(e),this.folder.evm.listen(i,"blur",this._handleRename,{},"preset-manager-rename"),this.folder.evm.listen(window,"keydown",this._handleKeydown,{},"preset-manager-rename")};_handleRename=t=>{if(this._log.fn("_disableRename").debug({e:t,this:this}),this._presetsInput.select.disableClicks=!1,this._presetsInput.select.elements.selected.removeAttribute("contenteditable"),this._renamePresetButton.element.classList.remove("active"),this.folder.evm.clearGroup("preset-manager-rename"),t?.type==="blur"){this._blurLatch=!0,clearTimeout(this._blurLatchTimer),setTimeout(()=>{this._blurLatch=!1},300);let i=t.target?.textContent??"";i!==this.activePreset.value.title&&this._renamePreset(i)}};_handleKeydown=t=>{this._log.fn("_handleKeydown").debug({key:t.key,e:t,this:this}),t.key==="Enter"&&(t.preventDefault(),this._handleRename()),t.key==="Escape"&&this._handleRename()};_refreshInputs(){let t=this.defaultPresetIsActive;this._renamePresetButton.element.classList.toggle("disabled",t),this._renamePresetButton.element.toggleAttribute("disabled",t),this._manageInput.refresh(),this._log.fn("_refreshInputs").debug({disableRename:t,this:this})}_refresh(){this._log.fn("_refresh").debug("Refreshing options and setting input.",{this:this}),this._presetsInput.options=this.presets.value.map(i=>({label:i.title,value:i}));let t=this.activePreset.value;this._presetsInput.set({label:t.title,value:t}),this._refreshInputs()}dispose(){this._initialized=!1,this._presetsInput.dispose(),this._renamePresetButton.element.tooltip.dispose(),this._renamePresetButton.element.remove}};var Vt=A({title:"default",prefix:"themer",vars:{color:{base:{"theme-a":"#00bcd4","dark-a":"#0B0B11","dark-b":"#1b1d29","dark-c":"#46465e","dark-d":"#55566a","dark-e":"#787b89","light-a":"#ffffff","light-b":"#c9ccd7","light-c":"#a9adba","light-d":"#777D8F","light-e":"#5F6377"},dark:{},light:{}}}});function Ye(n,t){let i=[],e=[];for(let r of n)t(r)?i.push(r):e.push(r);return[i,e]}function Je(n){let t=parseInt(n.replace("#",""),16),i=t>>16&255,e=t>>8&255,r=t&255;return[i,e,r].join(", ")}var Si={autoInit:!0,persistent:!0,theme:Vt,themes:[],mode:"system",localStorageKey:"fractils::themer",vars:{}},Dt=class{node;theme;themes;activeThemeTitle;mode;wrapper;_initialized=!1;_persistent;_key;_unsubs=[];_targets=new Set;_log;constructor(t="document",i){let e=L([Si,i]);this._key=String(e.localStorageKey),e.wrapper&&(this.wrapper=e.wrapper),this.node=t==="document"?document.documentElement:typeof t=="string"?O(t)[0]??document.documentElement:t,this._log=new f(`themer ${this.node.classList[0]}`,{fg:"DarkCyan"}),this._log.fn(we("constructor")).info({node:t,opts:e,this:this}),this.theme=b(A(e.theme,e.vars)),this.themes=b(e.themes.map(o=>A(o,e.vars))),this.activeThemeTitle=b(e.theme.title,{key:this._key+"::activeTheme"});let r=this.activeThemeTitle.value;if(e.theme.title!==r){let o=this.themes.value.find(s=>s.title===r);o&&this.theme.set(o)}this.mode=b(e.mode,{key:this._key+"::mode"}),this._persistent=e.persistent??!0,this.#t(this.theme,o=>{this._log.fn(H("theme.subscribe")).debug({v:o,this:this}),this._initialized&&(this.activeThemeTitle.set(o.title),this.applyTheme())}),this.#t(this.mode,o=>{if(this._log.fn(H("mode.subscribe")).debug("v",o,{this:this}),typeof o>"u")throw new Error("Mode is undefined.");this._initialized&&this.applyTheme()}),this._targets.add(this.wrapper??this.node.parentElement??this.node),e.autoInit&&this.init()}#t(t,i){this._unsubs.push(t.subscribe(e=>i(e)))}init(){let t=this.themes.value,i=this.theme.value;if(this._log.fn(B("init")).debug({theme:this.theme,this:this}),!(typeof document>"u"))return this._initialized?this:(this._initialized=!0,t.find(e=>e.title===i.title)||this.create(i,{overwrite:!0,save:!1}),this.load()?.applyTheme(),this)}get modeColors(){return this.theme.value.vars.color[this.activeMode]}get baseColors(){return this.theme.value.vars.color.base}get allColors(){return{...this.baseColors,...this.modeColors}}get activeMode(){let t=this.mode.value,i=typeof t=="object"&&"value"in t?t.value:t;return i==="system"?this.#e:i}get#e(){return window.matchMedia("(prefers-color-scheme: light)").matches?"light":(window.matchMedia("(prefers-color-scheme: dark)").matches,"dark")}create=(t,i)=>{this._log.fn(B("addTheme")).debug({newTheme:t,options:i,this:this});let e=structuredClone(t),r=i?.overwrite??!1,o=i?.save??!0,[s,a]=Ye(this.themes.value,c=>c.title===e.title),l=s.length>0;if(!r&&l){a.push(structuredClone(s[0]));let c=0;for(;;){let p=`${e.title} (${c++})`;if(!a.some(h=>h.title===p)){e.title=p;break}if(c>100){this._log.fn(B("addTheme")).debug(D("Runaway loop detected.")+" Aborting.",{this:this});break}}}return o&&this.save(),this};delete(t){this._log.fn(B("deleteTheme")).debug({themeOrTitle:t,this:this});let i=typeof t=="string"?t:t.title,e=this.themes.value,r=e.find(a=>a.title===i);if(!r)throw this._log.error("`themeTitle` not found in `themes` array.",{themeTitle:i,this:this}),new Error("Theme not found.");let o=e.indexOf(r)-1,s=this.theme.value.title===i;return this.themes.set(this.themes.value.filter(a=>a.title!==i)),s&&this.theme.set(e[o]??e.at(-1)),this.save(),this}getTheme(t){return this.themes.value.find(i=>i.title===t)}applyTheme=t=>{if(this._log.fn(B("applyTheme")).debug({theme:this.theme.value.title,targets:this._targets,this:this}),!("document"in globalThis))return;let i=this.theme.value;if(!i)throw this._log.error("theme not found").debug({theme:i,this:this}),new Error("Theme not found.");return this.#i(i,t),this.node.setAttribute("theme",i.title),this.node.setAttribute("mode",this.activeMode),this.wrapper?.setAttribute("theme",i.title),this.wrapper?.setAttribute("mode",this.activeMode),this};fromJSON(t){let i=this.theme.value.title!==t.activeTheme,e=t.themes.find(r=>r.title===t.activeTheme);if(e??=this.themes.value.find(r=>r.title===t.activeTheme),!e)throw this._log.error("`activeTheme` not found in `themes` array.",{activeTheme:t.activeTheme,json:t,this:this}),new Error("Theme not found.");this.themes.set(t.themes),this.mode.set(t.mode),i&&this.applyTheme()}toJSON(){return{themes:this.themes.value,activeTheme:this.theme.value.title,mode:this.mode.value}}load=()=>{if(this._log.fn(B("load")).debug({this:this}),this._persistent&&"localStorage"in globalThis){let t=localStorage.getItem(this._key+"::themer");t&&this.fromJSON(JSON.parse(t))}return this};save(){if(this._log.fn(B("save")).debug({this:this}),!("localStorage"in globalThis)||!this._persistent)return;let t=this.toJSON(),i=`${this._key}themer`in localStorage;try{i&&JSON.parse(JSON.stringify(t))===JSON.parse(localStorage.getItem(`${this._key}themer`)||"")||localStorage.setItem(`${this._key}themer`,JSON.stringify(t))}catch(e){throw console.error(D("Error")+": Failed to save to localStorage.",{error:e,this:this}),new Error("Failed to save to localStorage.")}return t}clear(){this._log.fn(B("clear")).debug({this:this}),"localStorage"in globalThis&&(localStorage.removeItem(`${this._key}themer`),this.themes.set([Vt]),this.theme.set(Vt),this.mode.set("system"))}addTarget(t){this._targets.add(t),this.applyTheme([t])}#i=(t,i=this._targets)=>{let e=t;this._log.fn(B("applyStyleProps")).debug({config:e,this:this});let r=e.vars.color[this.activeMode];if(!r)throw this._log.error("`theme` not found in `config`.",{theme:r,config:e,"this.activeMode":this.activeMode,this:this}),new Error("Theme not found.");let o=new Map;for(let s of i){for(let[a,l]of _(e.vars))if(a==="color")for(let[c,p]of[..._(l.base),..._(l[this.activeMode])])s.style.setProperty(`--${e.prefix}-${c}`,p),s.style.setProperty(`--${e.prefix}-${c}-rgb`,Je(p));else{let c=e.vars[a];for(let[p,h]of _(c))if(p==="base")for(let[m,x]of _(h))o.set(m,x);else if(p===this.activeMode)for(let[m,x]of _(h))o.set(m,x)}for(let[a,l]of o)s.style.setProperty(`--${e.prefix}-${a}`,l)}};dispose(){for(let t of this._unsubs)t()}};var qe=`<svg class="settings-icon fracgui-cancel" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 26 26">
  <path class="gear" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4.7c.2-.2.5-.3.7-.3l2.7.2h.4l.3-.1.2-.4 1.1-2.3.6-.5a13 13 0 0 1 6 0l.6.5 1.1 2.3.2.4.3.1h.4l2.7-.2c.2 0 .5.1.7.3 1.4 1.4 2.4 3 3 5 0 .2 0 .5-.2.7l-1.4 2-.3.5v.2l.3.4 1.4 2.1c.2.2.2.5.2.8-.6 1.8-1.6 3.5-3 4.9a1 1 0 0 1-.7.3l-2.7-.2h-.4l-.3.1-.2.4-1.1 2.3a1 1 0 0 1-.6.5 13 13 0 0 1-6 0 1 1 0 0 1-.6-.5l-1.1-2.3-.2-.4-.3-.1h-.4l-2.7.2a1 1 0 0 1-.7-.3c-1.4-1.4-2.4-3-3-5 0-.2 0-.5.2-.7l1.4-2L3 13l-.3-.4-1.4-2.1a.9.9 0 0 1-.2-.8c.6-1.8 1.6-3.5 3-4.9Z" />
  <circle fill="currentColor" class="dot-right" cx="22" cy="13" r="3" />
  <circle class="dot-left" fill="currentColor" cx="4" cy="13" r="3" />
  <circle class="dot-center" fill="currentColor" cx="13" cy="13" r="3" />
</svg>`;var d="fracgui",Ii={base:{"font-family":"'fredoka', sans-serif","font-size":"clamp(0.75rem, 3vw, 1rem)","shadow-lightness":"0%","shadow-opacity":"0.2","shadow-color":`hsla(250, 10%, var(--${d}-shadow-lightness), var(--${d}-shadow-opacity))`,"radius-xs":"0.125rem","radius-sm":"0.1875rem",radius:"0.3125rem","radius-md":"0.4375rem",filter:"none",opacity:"0.95","transition-duration":"75ms","backdrop-filter":"blur(10px)"},dark:{},light:{"shadow-lightness":"50%","shadow-opacity":"0.1"}},ce={base:{root:{width:"30rem","min-width":"25rem","max-width":"35rem","max-height":"90vh",opacity:"0.5","backdrop-filter":"blur(0.5rem)",header:{height:"1.75rem"}},header:{height:"1.75rem"},folder:{background:`color-mix(in sRGB, color-mix(in sRGB, var(--${d}-bg-a) 50%, var(--${d}-bg-b)) calc(var(--${d}-opacity) * 100%), transparent)`,header:{"padding-left":"0.25rem",color:`var(--${d}-fg-c)`,dim:{color:`var(--${d}-fg-d)`},background:`var(--${d}-bg-a)`,outline:"none","box-shadow":"none","font-size":`var(--${d}-font-size)`,"font-weight":"350","letter-spacing":"0.75px"},content:{"padding-left":"0.33rem","font-weight":"350","letter-spacing":"0.5px"}},toolbar:{icon:{color:`var(--${d}-bg-d)`,dim:{color:`var(--${d}-bg-c)`}}},controller:{"font-family":"'inconsolata', 'Comic Mono', 'Fira Code', monospace","font-size":"clamp(0.75rem, 3vw, 0.9rem)","border-radius":`var(--${d}-radius-sm)`,"box-shadow":`-1px 1px 2px hsla(250, 10%, var(--${d}-shadow-lightness), calc(0.7 * var(--${d}-shadow-opacity))), -1px 2px 5px hsla(250, 10%, var(--${d}-shadow-lightness), var(--${d}-shadow-opacity))`,background:`var(--${d}-bg-c)`,outline:`1px solid color-mix(in sRGB, var(--${d}-bg-d) 40%, transparent)`,color:`var(--${d}-fg-b)`,dim:{color:`var(--${d}-fg-c)`,background:`color-mix(in sRGB, color-mix(in sRGB, var(--${d}-bg-c) 75%, var(--${d}-bg-b)) calc(var(--${d}-opacity) * 100%), transparent)`}},input:{height:"2rem","section-1":{width:"clamp(6rem, 30%, 12rem)"},"section-2":{width:"4rem"},"section-3":{width:"100%"},"font-size":"'clamp(0.75rem, 3vw, 0.9rem)'",container:{color:`var(--${d}-fg-d)`,outline:`1px solid color-mix(in sRGB, var(--${d}-bg-a) 20%, transparent)`,"box-shadow":`-0.15px 0.1px 1px hsla(220, 10%, 2%, calc(0.8 * var(--${d}-shadow-opacity))) inset, -2px 2px 15px hsla(220, 10%, 2%, calc(0.075 * var(--${d}-shadow-opacity))) inset, -3.0px 3px 25px hsla(220, 10%, 2%, calc(0.05 * var(--${d}-shadow-opacity))) inset, -10.0px 10px 50px hsla(220, 10%, 2%, calc(0.025 * var(--${d}-shadow-opacity))) inset`,background:`color-mix(in sRGB, var(--${d}-bg-a) calc(var(--${d}-opacity) * 100%), transparent)`},number:{range:{color:`var(--${d}-bg-c)`,background:`var(--${d}-bg-a)`,outline:`1px solid color-mix(in sRGB, var(--${d}-bg-c) 0%, transparent)`,"box-shadow":"-2px 2px 2.5px hsla(230, 20%, 0%, 0.2), 2px 2px 5px hsla(230, 20%, 0%, 0.2), 2px 3px 10px hsla(230, 20%, 0%, 0.2), 2px 4px 4px hsla(230, 25%, 0%, 0.2)"}}}},dark:{},light:{controller:{outline:`1px solid color-mix(in sRGB, var(--${d}-bg-d) 10%, transparent)`,background:`color-mix(in sRGB, var(--${d}-bg-a) calc(var(--${d}-opacity) * 100%), transparent)`,color:`var(--${d}-fg-a)`,dim:{background:`color-mix(in sRGB, var(--${d}-bg-a) calc(var(--${d}-opacity) * 100%), transparent)`,color:`var(--${d}-fg-c)`}},input:{number:{range:{background:`var(--${d}-bg-b)`,color:`var(--${d}-bg-d)`,"box-shadow":"-2px 2px 2px hsla(230, 20%, 30%, 0.1), 2px 2px 3px hsla(230, 20%, 30%, 0.1), 2px 2px 7px hsla(230, 20%, 30%, 0.1)"}}}}},ue={color:yt.vars.color,utility:Ii,core:{base:Rt(ce.base,d),dark:Rt(ce.dark,d),light:Rt(ce.light,d)}};var Nt=class{pointer=-1;maxHistory=50;stack=[];lockedExternally=!1;_lockedInternally=!1;constructor(){}commit(t,i=100){if(this._lockedInternally||this.lockedExternally){this._lockedInternally=!1;return}let e=this.pointer+1-this.stack.length;e<0&&(this.stack=this.stack.slice(0,e)),this.pointer++,this.stack.push(t),this.stack.length>this.maxHistory&&(this.stack.shift(),this.pointer--)}undo=()=>{if(this.pointer===-1)return;this._lockedInternally=!0;let t=this.stack[this.pointer];t.setter?t.setter(t.from):t.target.set(t.from),this.pointer--};redo=()=>{if(this.pointer+1>this.stack.length-1)return;this._lockedInternally=!0;let t=this.stack[this.pointer+1];t.setter?t.setter(t.to):t.target.set(t.to),this.pointer++};clear(){this.stack=[],this.pointer=-1}};var Oi={__type:"ButtonControllerOptions",text:()=>"click me",onClick:()=>{},id:void 0,disabled:!1,style:void 0,tooltip:void 0,active:!1,element:void 0,parent:void 0},Z=class n{__type="ButtonController";static is(t){return t?.__type==="ButtonController"&&t instanceof n}_text;_active=()=>!1;_disabled=()=>!1;element;_evm=new E(["change","refresh","click"]);on=this._evm.on.bind(this._evm);_log=new f("ButtonController",{fg:"coral"});parent;constructor(t){let i=Object.assign({},Oi,t);this._log.fn("constructor").debug({opts:i,this:this}),this.element=i.element?i.element:u("button",{id:i.id??S(8),classes:["fracgui-controller","fracgui-controller-button"],parent:i.parent}),this.text=i.text,this.active=i.active,typeof i.disabled<"u"&&(this.disabled=i.disabled),this._evm.listen(this.element,"click",this.click),i.onClick&&this._evm.on("click",i.onClick)}get text(){return this._text()}set text(t){this._text=T(t),this.element.innerHTML=this._text()}get active(){return this._active()}set active(t){typeof t>"u"||(this._active=T(t),this.element.classList.toggle("active",this._active()))}get disabled(){return this._disabled()}set disabled(t){typeof t>"u"||(this._disabled=T(t),this._disabled()?this.disable():this.enable())}set(t){Object.assign(this,t),this._evm.emit("change",this),this.refresh()}click=t=>{this._log.fn("click").debug({this:this}),this._evm.emit("click",{e:t,button:this}),this.refresh()};enable=()=>this.disabled?this.disabled=!1:(this.element.classList.remove("disabled"),this.element.removeAttribute("disabled"),this);disable=()=>this.disabled?(this.element.classList.add("disabled"),this.element.setAttribute("disabled","true"),this):this.disabled=!0;refresh=()=>(this.element.toggleAttribute("disabled",this.disabled),this.element.classList.toggle("disabled",this.disabled),this.element.innerHTML=this.text,this.element.classList.toggle("active",this.active),this._evm.emit("refresh"),this);dispose(){this.element.remove(),this._evm.dispose()}};var pe=Object.freeze({InputText:"TextInputOptions",InputTextArea:"TextAreaInputOptions",InputNumber:"NumberInputOptions",InputColor:"ColorInputOptions",InputSelect:"SelectInputOptions",InputButton:"ButtonInputOptions",InputButtonGrid:"ButtonGridInputOptions",InputSwitch:"SwitchInputOptions"}),fs=Object.freeze(Le(pe)),ms=Object.freeze(Pt(pe)),C=class{constructor(t,i){this.folder=i;this.opts=t,this.opts.saveable??=!0,this.opts.resettable??=!0,this.id=this.opts.presetId??`${i.presetId}_${this.opts.title}__${this.opts.__type}`,this.__log=new f(`SuperInput${this.opts.__type.replaceAll(/Options|Input/g,"")} ${this.opts.title}`,{fg:"skyblue"}),this.__log.fn("super constructor").debug({options:t,this:this}),this._title=this.opts.title??"",this._disabled=T(this.opts.disabled??!1),this._hidden=T(this.opts.hidden??!1),this._index=this.opts.order??this.folder.inputs.size,this._index+=1,this._dirty=()=>this.value!==this.initialValue,this.elements.container=u("div",{classes:["fracgui-input-container"],parent:this.folder.elements.content}),this.title||this.element.style.setProperty("--fracgui-input-section-1_width","0px"),this.elements.drawerToggle=u("div",{classes:["fracgui-input-drawer-toggle"],parent:this.elements.container}),this.elements.title=u("div",{classes:["fracgui-input-title"],parent:this.elements.container,textContent:this.title}),this.elements.content=u("div",{classes:["fracgui-input-content"],parent:this.elements.container}),this.elements.resetBtn=u("div",{classes:["fracgui-input-reset-btn"],parent:this.elements.title,tooltip:{text:"Reset",placement:"left",delay:0},onclick:()=>{this.__log.fn("reset").debug("resetting to initial value",this.initialValue),this.set(this.initialValue)}}),this.elements.drawer=u("div",{classes:["fracgui-input-drawer"],parent:this.elements.content}),this._evm.listen(this.elements.drawerToggle,"click",()=>{console.warn("todo")}),"onChange"in t&&this._evm.on("change",t.onChange),Promise.resolve().then(()=>{this.index=this.index})}opts;id;bound=!1;elements={controllers:{}};bubble=!1;_title="";_index;_disabled;_hidden;_undoLock=!1;lockCommit={};_dirty;_evm=new E(["change","refresh"]);listen=this._evm.listen.bind(this._evm);on=this._evm.on.bind(this._evm);__log;get value(){return this.state.value}get title(){return this._title}set title(t){this._title=t,this.elements.title.textContent=t}get element(){return this.elements.container}get index(){return this._index}set index(t){this._index=t,this.elements.container.style.order=t.toString()}get undoManager(){return this.folder.gui?._undoManager}get disabled(){return this._disabled()}set disabled(t){this._disabled=T(t),this._disabled()?this.disable():this.enable()}get hidden(){return this.elements.container.classList.contains("hidden")}set hidden(t){this._hidden=T(t),this.elements.container.classList.toggle("hidden",this._hidden())}get dirty(){return this._dirty()}resolveState(t){if(t.binding){let i=b(t.binding.target[t.binding.key]);return this._evm.add(i.subscribe(e=>{t.binding.target[t.binding.key]=e})),i}else return b(t.value)}resolveInitialValue(t){let i=t.binding?t.binding.target[t.binding.key]:t.value;return M(i)?i.value:i}_emit(t,i=this.state.value){return this.opts.resettable&&this.elements.resetBtn.classList.toggle("dirty",this._dirty()),this._evm.emit(t,i),t==="change"&&this.folder.evm.emit("change",this),this}lock=(t=this.state.value)=>{this._undoLock=!0,this.lockCommit.from=t,this.__log.fn(H("lock")).debug("lockCommit:",this.lockCommit)};unlock=t=>{this.__log.fn(H("unlock")).debug("commit",{commit:t,lockCommit:this.lockCommit}),t??={},t.target??=this,t.to??=this.state.value,t.from??=this.lockCommit.from,this._undoLock=!1,this.commit(t)};commit(t){if(t.from??=this.state.value,t.target??=this,this._undoLock){this.__log.fn("commit").debug("prevented commit while locked");return}this.__log.fn("commit").debug("commited",t),this.undoManager?.commit(t)}enable(){return this._disabled=T(!1),this}disable(){return this._disabled=T(!0),this}refresh(t=this.state.value){if(this.opts.resettable)return this.opts.binding&&this.state.set(this.opts.binding.target[this.opts.binding.key]),this.elements.resetBtn.classList.toggle("dirty",this._dirty()),this._evm.emit("refresh",t),this}save(t={}){if(this.opts.saveable!==!0)throw new Error("Attempted to save unsaveable Input: "+this.title);let i={__type:pe[this.__type],title:this.title,value:this.state.value,disabled:this.disabled,presetId:this.id,hidden:this.hidden,order:this.index,resettable:this.opts.resettable??!0};return this.__log.fn("save").debug(i),Object.assign(i,t)}load(t){let i=typeof t=="string"?JSON.parse(t):t;this.id=i.presetId,this.disabled=i.disabled,this.hidden=i.hidden,this.initialValue=i.value,this.set(i.value)}dispose(){this.__log.fn("dispose").debug(this),this._evm.dispose();let t=i=>{if(i instanceof HTMLElement||i instanceof SVGElement)i.remove();else if(typeof i=="object")for(let e in i)t(i[e])};t(this.elements)}};var Ci={__type:"ButtonGridInputOptions",value:[[{text:"",onClick:()=>{}}]],style:{gap:"0.5em"},activeOnClick:!1,resettable:!1},ft=class extends C{__type="InputButtonGrid";initialValue={};state=b({});buttons=new Map;buttonGrid;_log;constructor(t,i){let e=Object.assign({},Ci,t);super(e,i),this._evm.registerEvents(["click"]),this.initialValue=e.value,this._log=new f(`InputButtonGrid ${e.title}`,{fg:"cyan"}),this._log.fn("constructor").debug({opts:e,this:this});let r=u("div",{classes:["fracgui-input","fracgui-input-buttongrid-container"],parent:this.elements.content});this.elements.controllers={container:r,buttonGrid:[]},this.buttonGrid=this.toGrid(this.initialValue),this.refresh()}onClick(t){this._evm.on("click",()=>t(this.state.value))}toGrid(t){let i=[],e=t.length,r=Math.max(...t.map(o=>o.length));for(let{element:o}of this.buttons.values())o.remove();this.buttons.clear();for(let o=0;o<e;o++){let s=u("div",{classes:["fracgui-controller-buttongrid-row"],parent:this.elements.controllers.container,style:{gap:"0.5em"}});i[o]=[];for(let a=0;a<r;a++){let l=t[o]?.[a];if(l){let c=this.addButton(l,l.id??S(8),o,a);s.appendChild(c.element),i[o][a]=c}}}return this.elements.container.style.setProperty("height",It(this.elements.controllers.container,"height")),i}addButton(t,i,e,r){let o=T(t.text),s=t.tooltip?Object.assign({placement:"top",delay:1e3},t.tooltip):void 0;t.element=u("button",{id:i,classes:["fracgui-controller","fracgui-controller-button","fracgui-controller-buttongrid-button"],innerHTML:o(),dataset:{id:i,row:String(e),col:String(r)},style:{...t.style,width:"100%"},tooltip:s});let a=new Z(t);return typeof t.active!="function"&&this.opts.activeOnClick&&(a.active=()=>this.state.value===a),a.on("click",({button:l})=>{this.set(l)}),this.buttons.set(i,a),a}set(t){this.state.set(t),this._emit("click",t),this.refresh()}refresh(){this._log.fn("refresh").debug({this:this});for(let t of this.buttons.values())t.refresh();return super.refresh(),this}enable(){for(let t of this.buttons.values())t.enable();return super.enable(),this}disable(){for(let t of this.buttons.values())t.disable();return super.disable(),this}dispose(){for(let t of this.buttons.values())t.dispose();this.buttons.clear(),super.dispose()}};var Li={__type:"SwitchInputOptions",value:!0,labels:{true:{state:"on",verb:"Enable"},false:{state:"off",verb:"Disable"}}},nt=class extends C{__type="InputSwitch";state;initialValue;#t;constructor(t,i){let e=Object.assign({},Li,t);super(e,i),this.#t=new f(`InputSwitch ${e.title}`,{fg:"cyan"}),this.#t.fn("constructor").debug({opts:e,this:this}),e.binding?(this.initialValue=e.binding.target[e.binding.key],this.state=b(!!this.initialValue),this._evm.add(this.state.subscribe(l=>{e.binding.target[e.binding.key]=l}))):(this.initialValue=e.value,this.state=b(!!e.value));let r=u("div",{classes:["fracgui-input-switch-container"],parent:this.elements.content}),o=u("button",{classes:["fracgui-controller","fracgui-controller-switch"],parent:r,tooltip:{text:()=>(this.state.value?e.labels?.false.verb:e.labels?.true.verb)||"",anchor:".fracgui-controller-switch-thumb",delay:750}}),s=u("div",{classes:["fracgui-controller-switch-thumb"],parent:o}),a=u("div",{classes:["fracgui-controller-switch-state-text"],parent:r,innerText:this.state.value?e.labels?.true.state:e.labels?.false.state,style:{opacity:"0.75"}});this.elements.controllers={container:r,input:o,thumb:s,stateText:a},this._evm.listen(this.elements.controllers.input,"click",()=>this.set()),this._evm.add(this.state.subscribe(this.refresh.bind(this)))}set(t=!this.state.value){if(this.#t.fn("set").debug({v:t,this:this}),typeof t=="boolean")this.undoManager?.commit({target:this,from:this.state.value,to:t}),this.state.set(t);else throw new Error(`InputBoolean.set() received an invalid value: ${JSON.stringify(t)} (${typeof t})`);return this._emit("change",t),this}refresh(t=this.state.value){return this.#t.fn("refresh").debug({v:t,this:this}),this.disabled?this:(this.elements.controllers.input.classList.toggle("active",t),this.elements.controllers.input?.tooltip?.refresh(),this.elements.controllers.stateText.innerText=(this.state.value?this.opts.labels?.true.state:this.opts.labels?.false.state)??"",this._emit("refresh",t),this)}enable(){return this.elements.controllers.input.disabled=!1,super.enable(),this}disable(){return this.elements.controllers.input.disabled=!0,super.disable(),this}dispose(){super.dispose()}};var Mi={__type:"ButtonInputOptions",text:()=>"click me"},ot=class extends C{__type="InputButton";initialValue={};state=b({});onClick=()=>{};button;_log;constructor(t,i){let e=Object.assign({},Mi,t,{__type:"ButtonInputOptions"});super(e,i),this._evm.registerEvents(["change","refresh","click"]),this._log=new f(`InputButton ${e.title}`,{fg:"cyan"}),this._log.fn("constructor").debug({opts:e,this:this}),e.value?this.onClick=e.value:e.onClick?this.onClick=e.onClick:!1;let r=u("div",{classes:["fracgui-input-button-container"],parent:this.elements.content});this.button=new Z({text:e.text,onClick:e.onClick,parent:r}),this.elements.controllers={container:r,button:this.button.element},this._evm.listen(this.elements.controllers.button,"click",this.click.bind(this)),this._evm.add(this.state.subscribe(this.refresh.bind(this)))}get text(){return this.button.text}set text(t){this.button.text=t}click(){this.button.click({...new MouseEvent("click"),target:this.button.element})}enable(){return this.button.enable(),super.enable(),this}disable(){return this.button.disable(),super.disable(),this}set=t=>{Z.is(t)&&this.state.set(t)};refresh(){return this.button.refresh(),super.refresh(),this}dispose(){this.button.dispose(),super.dispose()}};function U(n){let t=()=>!1;return class extends n{get disabled(){return t()}set disabled(i){t=T(i),t()?this.disable():this.enable()}}}var Pi=n=>{if(!(n instanceof HTMLElement||n instanceof SVGElement))return!1;let t=getComputedStyle(n);return["overflow","overflow-x","overflow-y"].some(i=>{let e=t.getPropertyValue(i);return e==="auto"||e==="scroll"})},Ze=n=>{let t=n.parentElement;for(;t;){if(Pi(t))return t;t=t.parentElement}return document.scrollingElement||document.documentElement};var st=@U class{__type="Select";element;_opts;elements;options;optionMap=new Map;expanded=!1;initialValue;initialOptions;disableClicks=!1;bubble=!0;_selected;_currentSelection;_scrollParent;_evm=new E(["change","refresh","cancel","open","close"]);on=this._evm.on.bind(this._evm);_log;constructor(t){let i={...t,selected:j(t.selected?t.selected:t.options[0]),options:t.options.map(s=>j(s)),selectOnHover:t.selectOnHover??!0};this._opts=i,t?.title?this._log=new f(`Select ${t.title}`,{fg:"burlywood"}):this._log=new f("Select",{fg:"blueviolet"}),this._selected=this._currentSelection=this.initialValue=this._opts.selected,this.options=this.initialOptions=this._opts.options;let e=u("div",{classes:["fracgui-controller-select-container"],parent:t.container});this.element=e;let r=u("div",{classes:["fracgui-controller-select-selected"],parent:e,textContent:String(this.getLabel(this.selected))});this._evm.listen(r,"click",()=>{this.disableClicks||this.toggle()});let o=u("div",{classes:["fracgui-controller-select-dropdown"]});this.elements={container:e,selected:r,dropdown:o,options:[]};for(let s of this.options)this.add(s);this.disabled=this._opts.disabled,this._log.fn("constructor").debug({opts:this._opts,this:this})}get selected(){return this._selected}set selected(t){this._log.fn("set selected").debug(t);let i=M(t)?j(t.value):j(t);if(this._selected=i,this.elements.selected.innerHTML=i.label,!this.bubble){this.bubble=!0;return}this._evm.emit("change",this.selected)}getLabel(t){return M(t)?t.value.label:t.label}add(t){let i=j(t),e=u("div",{classes:["fracgui-controller-select-option"],parent:this.elements.dropdown,innerText:i.label}),r=this._evm.listen(e,"click",this.select);return e.dataset.optionId=r,this.optionMap.set(r,{option:i,element:e}),this.elements.options.push(e),this._log.fn("add").debug({option:t,added:this.optionMap.get(r),id:r,this:this}),this}remove(t,i=!1){let e=this.optionMap.get(t);if(!e)throw console.error({this:this}),new Error("No option found in map for id: "+t);let r=e;if(this._log.fn("remove").debug({btn:r,id:t,this:this}),i&&JSON.stringify(this.selected.value)===JSON.stringify(r.option.value)){let o=this.options.indexOf(r.option)+1,s=this.options[o%this.options.length];this._log.fn("remove").debug("Auto-selecting fallback btn",{fallback:s,btn:r,id:t,this:this}),this.select(s,!1)}this.elements.options=this.elements.options.filter(o=>o!==r.element),r.element.remove(),this.options=this.options.filter(o=>o.label!==r.option.label),this.optionMap.delete(t)}clear(){this._log.fn("clear").debug({this:this});for(let t of this.optionMap.keys())this.remove(t,!1);this.options=[],this.optionMap.clear()}select=(t,i=!0)=>{if(this.disabled)return this;if(this._log.fn("select").debug("v",t,{this:this}),t instanceof Event){let e=t.target,r=e.dataset.optionId;if(typeof r!="string")throw console.error({target:e}),new Error("No option id found on select click");let o=this.optionMap.get(r);if(!o)throw console.error({target:e}),new Error("No option found in map");for(let[,{element:s}]of this.optionMap)s.classList.toggle("selected",s===o.element);this.close(),this.selected=o.option}else{let e=j(t);if(M(e))this.selected=e.value;else if(P(e))this.bubble=i,this.selected=e;else throw new Error("Invalid value: "+e)}return this};refresh=()=>(this._log.fn("refresh").debug({this:this}),this.elements.selected.innerHTML=this.selected.label,this);toggle=()=>{this._log.fn("toggle").debug({this:this}),this.expanded?(this._evm.emit("cancel"),this.close()):this.open()};open=()=>{if(this.expanded=!0,this._opts.input.folder.gui.wrapper.appendChild(this.elements.dropdown),this.elements.dropdown.classList.add("expanded"),this.elements.selected.classList.add("active"),this.updatePosition(),this._scrollParent??=Ze(this.elements.selected),this._scrollParent?.addEventListener("scroll",this.updatePosition),this._evm.listen(window,"keydown",this._closeOnEscape,{},"dropdown"),this._evm.listen(window,"click",this._clickOutside,{},"dropdown"),this._opts.selectOnHover){this._currentSelection=this.selected;for(let[,{option:t,element:i}]of this.optionMap){i.classList.toggle("selected",t.label===this.selected.label);let e=()=>{this._log.fn("on(mouseenter)").debug("currentSelection",{option:t,element:i,this:this}),this.select(t)};this._evm.listen(i,"mouseenter",e,{},"dropdown")}}this._evm.emit("open"),setTimeout(()=>{this.elements.dropdown.style.pointerEvents="all"},200)};updatePosition=()=>{if(!this.expanded)return;this.elements.dropdown.style.setProperty("width","unset"),this.elements.dropdown.style.setProperty("top","unset");let{dropdown:t,selected:i}=this.elements,e=this._opts.input.folder.root.elements.content.scrollTop,{top:r,left:o}=i.getBoundingClientRect();this.elements.dropdown.style.setProperty("width",`${Math.max(i.offsetWidth,t.offsetWidth)}px`),this.elements.dropdown.style.setProperty("top",`${r+i.offsetHeight-e}px`),this.elements.dropdown.style.setProperty("left",`${o+i.offsetWidth/2-t.offsetWidth/2}px`)};close=()=>{this.expanded=!1,this.elements.dropdown.classList.remove("expanded"),this.elements.selected.classList.remove("active"),this.elements.dropdown.style.pointerEvents="none",this._evm.clearGroup("dropdown"),this._evm.emit("close"),setTimeout(()=>{this.elements.dropdown.remove()},200)};_closeOnEscape=t=>{t.key==="Escape"&&this._cancel()};_clickOutside=t=>{let i=t.composedPath();!i.includes(this.elements.selected)&&!i.includes(this.elements.dropdown)&&this._cancel()};_cancel(){this.close(),this._opts.selectOnHover&&this.select(this._currentSelection),this._evm.emit("cancel")}enable(){return this.elements.selected.classList.remove("disabled"),this.elements.selected.removeAttribute("disabled"),this}disable(){return this.elements.selected.classList.add("disabled"),this.elements.selected.setAttribute("disabled","true"),this}dispose(){for(let t of Pt(this.elements))Array.isArray(t)?t.forEach(i=>i.remove()):t.remove();this._scrollParent?.removeEventListener("scroll",this.updatePosition),removeEventListener("click",this._clickOutside),this._evm.dispose()}};function P(n){return typeof n=="object"&&Object.keys(n).length===2&&"label"in n&&"value"in n}function j(n){if(P(n))return n;if(["string","number"].includes(typeof n))return{label:String(n),value:n};if(M(n))return P(n.value)?n.value:{label:String(n.value),value:n};if(n&&typeof n=="object")return{label:JSON.stringify(n),value:n};throw console.error("Invalid option:",n,". Please provide a named option ({ label: string, value: T })and place your value in the `value` property."),new Error("Missing label:"+JSON.stringify(n),{cause:{v:n}})}function de(n){function t(i){return i}if(P(n))return n.value;if(M(n)){let i=n.value;return P(i)?i.value:i}return n}var Ri={__type:"SelectInputOptions",options:[]},at=@U class extends C{__type="InputSelect";initialValue;state;#t;set options(t){this._log.fn("set options").debug(t),this.#t=T(t),this.select.clear();for(let i of this.#t())this.select.add(i)}get options(){return this.resolveOptions(this.#t)}select;#e=!0;labeledSelection;_log;constructor(t,i){let e=Object.assign({},Ri,t,{__type:"SelectInputOptions"});super(e,i),this._evm.registerEvents(["preview","open","close","cancel"]),this._log=new f(`InputSelect ${e.title}`,{fg:"slategrey"}),this._log.fn("constructor").debug({opts:e,this:this}),e.value??=e.binding?.initial??re(this.targetValue),this.initialValue=this.resolveInitialValue(e),this.labeledSelection={value:de(this.initialValue),label:this.resolveInitialLabel(this.initialValue,e)},this.#t=this.opts.options,this.state=b(this.initialValue);let r=u("div",{classes:["fracgui-input-select-container"],parent:this.elements.content});this.select=new st({input:this,container:r,options:this.options,selected:this.labeledSelection,title:this.title}),this.elements.controllers={container:r,select:this.select.elements},this.disabled=e.disabled??!1,this._evm.add(this.state.subscribe(o=>{if(this.select.bubble){if(this.targetObject&&(M(this.targetValue)?(this._log.fn("updating binding").debug({from:this.targetValue.value,to:o.value}),this.targetValue.set(o.value)):this.targetValue=o.value),this.#e){this.#e=!1,this._log.fn("state.subscribe").debug("Stopped propagation.  Subscribers will not be notified.");return}this.set(o)}})),t.onChange&&this._evm.on("change",o=>{this._log.fn("calling options onChange").debug(o),t.onChange?.(j(o))}),this.select.on("change",o=>{this._log.fn("select.onChange").debug(o),!this.#e&&(this.#e=!0,this.set(o))}),this.listen(this.select.element,"preview",()=>{this._emit("preview")}),this.listen(this.select.element,"open",()=>{this._emit("open")}),this.listen(this.select.element,"close",()=>{this._emit("close")}),this.listen(this.select.element,"cancel",()=>{this._emit("cancel")}),this._dirty=()=>this.value.label!==this.initialValue.label,this._log.fn("constructor").debug({this:this})}resolveOptions(t){function i(r){return P(r[0])}let e=T(t)();if(!i(e)){if(!this.opts.labelKey)throw new Error("Recieved unlabeled options with no `labelKey` specified.  Please label your options or provide the `labelKey` to use as a label.");return e.map(r=>({label:r[this.opts.labelKey],value:r}))}return e}resolveInitialValue(t){let i=t.binding?t.binding.target[t.binding.key]:t.value,e=re(i);if(!P(e)){if(!t.labelKey)throw new Error("Cannot resolve initial value.  Please provide a `labelKey` or use labeled options.");return{label:e[t.labelKey],value:e}}return e}resolveInitialLabel(t,i){let e=M(t)?t.value:t;return P(e)?e.label:i.labelKey?t[i.labelKey]:Tt(e)}get targetObject(){return this.opts.binding?.target}get targetKey(){return this.opts.binding?.key}get targetValue(){return this.targetObject?.[this.targetKey]}set targetValue(t){if(P(t)&&(t=de(t)),this._log.fn("set targetValue").debug(t),typeof t>"u")throw console.error("Cannot set target value to undefined"),console.error("this",this),new Error("Cannot set target value to undefined");let i=this.targetObject,e=this.targetKey;i&&e&&(M(i[e])?i[e].set(t):i[e]=t)}set(t){return this._log.fn("set").debug(t),this.#e=!0,this.select.select(t,!1),this.state.set(t),this._emit("change",t),this}enable(){return this._log.fn("enable").debug(),this.select.enable(),super.enable(),this}disable(){return this._log.fn("disable").debug(),this.select.disable(),super.disable(),this}refresh=()=>{let t=this.state.value;if(this._log.fn("refresh").debug({v:t,this:this}),!this.labeledSelection)throw new Error("Failed to find labeled selection.");let i=this.options.filter(e=>!this.select.options.some(r=>r.label===e.label));console.log(i);for(let e of i)this.select.add(e);return this.select.select(this.labeledSelection,!1),super.refresh(),this};dispose(){super.dispose()}};var Kt=()=>{let n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("width","24"),n.setAttribute("height","24"),n.setAttribute("viewBox","-2 -2 28 28"),n.setAttribute("stroke","currentColor"),n.setAttribute("fill","none"),n.setAttribute("stroke-width","2"),n.setAttribute("stroke-linecap","round"),n.setAttribute("stroke-linejoin","round");let t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d","m18 15-6-6-6 6"),n.appendChild(t),n};var Ut=class{constructor(t,i,e){this.input=t;this.opts=i;this.parent=e;this.elements.container=u("div",{classes:["fracgui-input-number-buttons-container"],parent:e}),this.elements.increment=u("div",{classes:["fracgui-controller","fracgui-input-number-button","fracgui-input-number-buttons-increment"],parent:this.elements.container}),this.elements.increment.appendChild(Kt()),t.listen(this.elements.increment,"pointerdown",this.rampChangeUp.bind(this)),this.elements.decrement=u("div",{classes:["fracgui-controller","fracgui-input-number-button","fracgui-input-number-buttons-decrement"],parent:this.elements.container});let r=Kt();r.setAttribute("style","transform: rotate(180deg)"),this.elements.decrement.appendChild(r),t.listen(this.elements.decrement,"pointerdown",this.rampChangeDown.bind(this))}elements={};rampChange(t=1){let i="step"in this.opts?this.opts.step:1,e=300,r=!1,o=0,s,a=()=>{clearTimeout(s),!r&&(o+=e,o>1e3&&(e/=2,o=0),this.input.set(this.input.state.value+i*t),s=setTimeout(a,e))},l=()=>{r=!0,window.removeEventListener("pointerup",l),window.removeEventListener("pointercancel",l)};window.addEventListener("pointercancel",l,{once:!0}),window.addEventListener("pointerup",l,{once:!0}),a()}rampChangeUp(){this.rampChange(1)}rampChangeDown(){this.rampChange(-1)}};function Ai(n){return typeof globalThis.navigator>"u"&&!n&&console.error("Error getting user-agent: Request object is required on the server, but was not provided."),n?.headers.get("user-agent")||globalThis.navigator?.userAgent}function jt(n,t){return!!Ai(t)?.match(n)}function he(n){return jt(/mac/i,n)&&!Bi(n)}function Qe(n){return he(n)||ti(n)||mt(n)||Hi(n)||mt(n)}function Bi(n){return Fi(n)||ti(n)||mt(n)}function ti(n){return jt(/iphone/i,n)}function Hi(n){return mt(n)}function mt(n){return jt(/ipad/i,n)}function Fi(n){return jt(/android/i,n)}function ii(n){return he()?n.metaKey:n.ctrlKey}function ri(){return Qe()?ei.metaKey.mac.icon:ei.ctrlKey.windows.icon}var ei={metaKey:{mac:{icon:"\u2318",name:"command",key:"meta"},windows:{icon:"\u229E Win",name:"windows",key:"win"},linux:{icon:"Super",name:"super",key:"meta"}},altKey:{mac:{icon:"\u2325",name:"option",key:"alt"},windows:{icon:"Alt",name:"alt",key:"alt"},linux:{icon:"Alt",name:"alt",key:"alt"}},shiftKey:{mac:{icon:"\u21E7",name:"shift",key:"shift"},windows:{icon:"Shift",name:"shift",key:"shift"},linux:{icon:"Shift",name:"shift",key:"shift"}},ctrlKey:{mac:{icon:"\u2303",name:"control",key:"ctrl"},windows:{icon:"Ctrl",name:"control",key:"ctrl"},linux:{icon:"Ctrl",name:"control",key:"ctrl"}}};var z=class{constructor(t,i,e){this.input=t;this.opts=i;this.parent=e;this._log=new f(`NumberController ${this.input.title}`,{fg:"darkgoldenrod"}),this.element=u("input",{type:"number",classes:["fracgui-controller","fracgui-controller-number"],value:String(t.state.value),parent:e,tooltip:{text:`Hold <span class="fractils-hotkey">${ri()}</span> to drag`,placement:"top",delay:1500,parent:e,styles:{background:"var(--fracgui-bg-a)",color:"var(--fracgui-fg-a)","--fractils-hotkey_background":"var(--fracgui-bg-b)","--fractils-hotkey_color":"var(--fracgui-fg-a)"}}}),"step"in i&&(this.element.step=String(i.step)),t.listen(this.element,"pointerenter",this.hoverStart)}element;dragEnabled=!1;dragging=!1;hovering=!1;delta=0;_log;hoverStart=t=>{this._log.fn("hoverStart").debug(t),this.hovering=!0,this.element.classList.add("hovering"),this.maybeEnableDrag(t),this.element.removeEventListener("pointerleave",this.hoverEnd),this.element.addEventListener("pointerleave",this.hoverEnd),document.removeEventListener("keydown",this.maybeEnableDrag),document.addEventListener("keydown",this.maybeEnableDrag)};hoverEnd=t=>{this._log.fn("hoverEnd").debug(t),this.hovering=!1,this.element.classList.remove("hovering"),this.cancelDrag(t),this.element.removeEventListener("pointerleave",this.hoverEnd),document.removeEventListener("keydown",this.maybeEnableDrag)};dragKeyHeld=t=>ii(t);cancelDrag=t=>{this._log.fn("cancelDrag").debug(t),this.dragEnabled=t.type==="keyup"?this.dragKeyHeld(t):!1,document.removeEventListener("keyup",this.cancelDrag),this.element.removeEventListener("pointerleave",this.cancelDrag),this.element.removeEventListener("pointerdown",this.maybeDragStart),this.dragEnabled||(this.element.style.cursor=this.element.dataset.cursor??"text",this.dragging&&this.dragEnd())};maybeEnableDrag=t=>{this._log.fn("maybeEnableDrag").debug(t),this.dragKeyHeld(t)&&(this.dragEnabled=!0,document.removeEventListener("keyup",this.cancelDrag),document.addEventListener("keyup",this.cancelDrag),this.element.removeEventListener("pointerleave",this.cancelDrag),this.element.addEventListener("pointerleave",this.cancelDrag),this.element.removeEventListener("pointerdown",this.maybeDragStart),this.element.addEventListener("pointerdown",this.maybeDragStart),this.element.dataset.cursor=It(this.element,"cursor"),this.element.style.cursor="ns-resize")};maybeDragStart=()=>{this.hovering&&this.dragEnabled&&this.dragStart()};dragStart=async()=>{this._log.fn("dragStart").debug(),this.dragging=!0,this.element.dispatchEvent(new Event("dragStart")),this.element.tooltip.hide(),this.element.removeEventListener("pointermove",this.drag),this.element.addEventListener("pointermove",this.drag),document.removeEventListener("pointerup",this.dragEnd),document.addEventListener("pointerup",this.dragEnd),this.element.classList.add("dragging"),await this.element.requestPointerLock(),this.element.blur()};dragEnd=()=>{this._log.fn("dragEnd").debug(),this.dragging=!1,this.element.classList.remove("dragging"),this.element.removeEventListener("pointermove",this.drag),document.removeEventListener("pointerup",this.dragEnd),document.exitPointerLock(),this.element.dispatchEvent(new Event("dragEnd"))};drag=t=>{if(!this.dragging)return;let i=t.shiftKey?4:t.altKey?.1:1,e=Math.sign(t.movementY);if(this.delta+=Math.abs(t.movementY),this.delta>+this.element.step){let r=+this.element.step*i*-e;this.element.value=String(this.element.valueAsNumber+r),e===-1?this.element.stepUp(+this.element.step*i):this.element.stepDown(+this.element.step*i),this.delta=0,this.element.dispatchEvent(new Event("input"))}};dispose(){this.element.removeEventListener("pointerenter",this.hoverStart),this.element.removeEventListener("pointerleave",this.hoverEnd),this.element.removeEventListener("pointermove",this.drag),document.removeEventListener("keydown",this.maybeEnableDrag),document.removeEventListener("keyup",this.cancelDrag),this.element.removeEventListener("pointerleave",this.cancelDrag),this.element.removeEventListener("pointerdown",this.maybeDragStart),document.removeEventListener("pointerup",this.dragEnd),this.element.tooltip.dispose(),this.element.remove()}};var ni=(n,t,i)=>{let e=u("input",{type:"range",classes:["fracgui-controller","fracgui-input-number-range"],value:String(n.state.value),parent:i});return"min"in t&&(e.min=String(t.min)),"max"in t&&(e.max=String(t.max)),"step"in t&&(e.step=String(t.step)),n.listen(e,"input",n.set.bind(n)),e};var $i={__type:"NumberInputOptions"},lt=class extends C{__type="InputNumber";_log;initialValue;state;dragEnabled=!1;numberController;numberButtonsController;constructor(t,i){let e=Object.assign({},$i,t,{__type:"NumberInputOptions"}),r=e.binding?.initial??e.value??1;e.value??=r,e.min??=r<=0?r*2:0,e.max??=r<=0?r*-2:r*2;let o=r/100;e.step??=o<=.1?.001:.1,super(e,i),this._log=new f(`InputNumber ${e.title}`,{fg:"cyan"}),this._log.fn("constructor").debug({opts:e,this:this}),this.initialValue=this.resolveInitialValue(e),this.state=this.resolveState(e);let s=u("div",{classes:["fracgui-input-number-container"],parent:this.elements.content});this.numberController=new z(this,e,s),this.numberButtonsController=new Ut(this,e,s),this.elements.controllers={container:s,input:this.numberController.element,buttons:this.numberButtonsController.elements,range:ni(this,e,s)},this._evm.add(this.state.subscribe(this.refresh)),this._evm.listen(this.elements.controllers.range,"pointerdown",this.lock),this._evm.listen(this.elements.controllers.range,"pointerup",()=>this.unlock()),this._evm.listen(this.elements.controllers.input,"input",this.set),this._evm.listen(this.elements.controllers.input,"dragStart",this.lock),this._evm.listen(this.elements.controllers.input,"dragEnd",()=>this.unlock())}set=t=>{if(this._log.fn("set").debug(t),typeof t>"u")return;let i=t;return t instanceof Event&&t?.target&&"valueAsNumber"in t.target&&(i=t.target.valueAsNumber),this.commit({to:i}),this.state.set(i),this._emit("change",i),this};enable(){return this._log.fn("enable").debug(),this.elements.controllers.input.disabled=!1,super.enable(),this}disable(){return this._log.fn("disable").debug(),this.elements.controllers.input.disabled=!0,super.disable(),this}refresh=()=>{let t=this.state.value;return this._log.fn("refresh").debug(t),this.elements.controllers.range.value=String(t),this.elements.controllers.input.value=String(t),super.refresh(t),this};dispose(){this._log.fn("dispose").debug(),super.dispose()}};var zi={disabled:!1},Wt=@U class{constructor(t,i){this.input=t;let e={...zi,...i};this._log=new f(`ColorComponents ${t.title}`,{fg:"wheat"}),this.opts=e,this._mode=t.mode;let r=e.container??t.elements.controllers.container,o=u("div",{classes:["fracgui-input-color-components-container"],parent:r});this.element=o;let s=u("div",{classes:["fracgui-input-color-components-select-container"],parent:o});this.select=new st({input:this.input,disabled:this.disabled,container:s,options:["hex","hex8","rgba","hsla","hsva"]}),this.select.on("change",p=>{this.updateMode(p.value)});let a=u("div",{classes:["fracgui-input-color-components-numbers-container"],parent:o}),l={a:new z(this.input,this.input.opts,a).element,b:new z(this.input,this.input.opts,a).element,c:new z(this.input,this.input.opts,a).element,d:new z(this.input,this.input.opts,a).element};l.a.classList.add("a"),l.b.classList.add("b"),l.c.classList.add("c"),l.d.classList.add("d");for(let[p,h]of _(l)){let m=()=>{this[p]=+h.value,this.input.set(this.color)};this.#e()==="text"&&h.classList.add("visible"),this._evm.listen(h,"input",m)}let c=u("input",{classes:["fracgui-controller","fracgui-controller-text","fracgui-input-color-components-text"],parent:o});this._evm.listen(c,"change",p=>{let h=p.target,m=ae(h.value);m&&(m=m[0].toLowerCase()+m.slice(1),this.input.set(h.value))}),this.#e()==="text"&&c.classList.add("visible"),this.elements={container:o,title:s,select:this.select.elements,numbers:l,text:c},this.mode=this._mode,typeof i?.disabled<"u"&&(this.disabled=i.disabled)}opts;element;elements;select;_evm=new E;_mode;_locked=!1;_log;get color(){return this.input.state.value}get mode(){return this._mode}set mode(t){this._log.fn("set mode",t).debug(),this._mode=t,this.select.selected=t}updateMode=(t=this.mode)=>{if(this._log.fn("updateMode",t).debug(),this._mode=t,this.#e()==="text"){this.elements.text.classList.add("visible");for(let[,i]of _(this.elements.numbers))i.classList.remove("visible");this.#i()}else{this.elements.text.classList.remove("visible");for(let[,i]of _(this.elements.numbers))i.classList.add("visible");this.mode==="rgba"&&(this.#t(this.elements.numbers.a,{min:0,max:255,step:1}),this.#t(this.elements.numbers.b,{min:0,max:255,step:1}),this.#t(this.elements.numbers.c,{min:0,max:255,step:1}),this.#t(this.elements.numbers.d,{min:0,max:1,step:.01})),["hsla","hsva"].includes(this.mode)&&(this.#t(this.elements.numbers.a,{min:0,max:360,step:1}),this.#t(this.elements.numbers.b,{min:0,max:100,step:1}),this.#t(this.elements.numbers.c,{min:0,max:100,step:1}),this.#t(this.elements.numbers.d,{min:0,max:1,step:.01})),this.elements.select.selected.innerHTML=[...t].map((i,e)=>`<span class="${["a","b","c","d"][e]}">${i}</span>`).join("")}this.refresh()};#t=(t,i)=>{this._log.fn("#setProps",t,i).debug();for(let[e,r]of _(i))t[e]=String(r)};get a(){return this.mode==="rgba"?this.color.rgba.r:this.color.hsla.h}set a(t){this.mode==="rgba"?this.color.red=t:this.color.hue=t,this._locked=!0,this.input.refresh()}get b(){return this.mode==="rgba"?this.color.rgba.g:this.color.hsla.s}set b(t){this.mode==="rgba"?this.color.green=t:this.color.saturation=t,this._locked=!0,this.input.refresh()}get c(){switch(this.mode){case"rgba":return this.color.blue;case"hsla":return this.color.lightness;case"hsva":default:return this.color.value}}set c(t){this.mode==="rgba"?this.color.blue=t:this.mode==="hsla"?this.color.lightness=t:this.mode==="hsva"&&(this.color.value=t),this._locked=!0,this.input.refresh()}get d(){return this.color.alpha}set d(t){this.color.alpha=t,this._locked=!0,this.input.refresh()}#e(){return["rgba","hsla","hsva"].includes(this.mode)?"numbers":"text"}#i=()=>{this.elements.text.value=this.color[this.mode.startsWith("hex")?this.mode+"String":this.mode]};#n;#o;refresh=()=>{this._log.fn("refresh").debug();let t=this.input.state.value.hex8String,i=this.mode;return this.#n===t&&i===this.#o?this:(this.#n=t,this.#o=i,this._locked?(this._locked=!1,this):(this.#e()==="text"?this.#i():(this.elements.numbers.a.value=String(this.a),this.elements.numbers.b.value=String(this.b),this.elements.numbers.c.value=String(this.c),this.elements.numbers.d.value=String(this.d)),this))};disable(){this.disabled||(this.disabled=!0),this.select.disable(),this.elements.text.disabled=!0;for(let[,t]of _(this.elements.numbers))t.disabled=!0;return this}enable(){this.disabled&&(this.disabled=!1),this.select.enable(),this.elements.text.disabled=!1;for(let[,t]of _(this.elements.numbers))t.disabled=!1;return this}dispose(){this.elements.title.remove(),this.elements.numbers.a.remove(),this.elements.numbers.b.remove(),this.elements.numbers.c.remove(),this.elements.container.remove(),this.elements.text.remove(),this.select.dispose(),this._evm.dispose()}};var bt=(n,t,i,e,r)=>(n-t)*(r-e)/(i-t)+e;function oi(n,t=50){let i;return function(...e){clearTimeout(i),i=setTimeout(()=>{i=null,n(...e)},t)}}var Gi={color:"#fff",swatches:[],handleSize:10,container:void 0,disabled:!1},Xt=@U class{constructor(t,i){this.input=t;let e={...Gi,...i};this.opts=e,this._log=new f(`ColorPicker ${t.title}`,{fg:"lightgreen"}),this._log.fn("constructor").debug({opts:e,this:this}),this._lastColor=this.input.state.value.clone();let r=t.expanded?{}:{height:"0px"},o=u("div",{classes:["fracgui-input-color-picker-container"],parent:i?.container??t.elements.controllers.container,style:r});this.element=o;let s=u("canvas",{classes:["fracgui-input-color-picker-canvas"],parent:o,height:this._height}),a=oi(this._updateHandle,100);this._resizeObserver=new ResizeObserver(()=>a()),this._resizeObserver.observe(s);let l=u("div",{classes:["fracgui-input-color-picker-handle"],parent:o,style:{background:t.state.value.hexString}}),c=u("input",{type:"range",classes:["fracgui-input-range","fracgui-input-color-picker-hue"],parent:o,min:0,max:359});this._evm.listen(c,"input",this._updateStateFromHue),le(c,{parent:o,text:()=>`${this.input.state.value.hsla.h}`,placement:"top",offsetX:"0px",anchor:{x:"mouse",y:c.querySelector("#thumb")},style:{background:"var(--fracgui-bg-a)",color:"var(--fracgui-fg-a)"}});let p=u("input",{type:"range",classes:["fracgui-input-range","fracgui-input-color-picker-alpha"],parent:o,min:0,max:1,step:.01});this._evm.listen(p,"input",this.setAlpha),le(p,{parent:o,text:()=>`${this.input.state.value.alpha}`,placement:"top",offsetX:"0px",anchor:{x:"mouse",y:p.querySelector("#thumb")},style:{background:"var(--fracgui-bg-a)",color:"var(--fracgui-fg-a)"}}),this.elements={container:o,canvas:s,handle:l,hueSlider:c,alphaSlider:p},this.disabled=this.opts.disabled,this._ctx=s.getContext("2d"),this.canvas.width=this._width,this._evm.listen(this.canvas,"click",this._onClick),this._evm.listen(this.canvas,"pointerdown",this._onPointerDown),this._evm.listen(this.input.elements.container,"pointermove",this._onPointerMove,{passive:!0}),this._updateGradients(),setTimeout(this.draw,10),setTimeout(this._updateHandle,20)}opts;elements;element;_ctx;_height=16*3;_width=256;_resizeObserver;_gradientWhite;_gradientBlack;_dragging=!1;_lockCursorPosition=!1;_lastColor;_log;_evm=new E(["pointerdown","pointerup"]);on=this._evm.on.bind(this._evm);get canvas(){return this.elements.canvas}get hue(){return this.input.state.value.hue}get alpha(){return this.input.state.value.alpha}enable=()=>(this.disabled&&(this.disabled=!1),this.elements.container.classList.remove("fracgui-disabled"),this.elements.alphaSlider.disabled=!1,this.elements.hueSlider.disabled=!1,this.elements.canvas.style.pointerEvents="auto",this);disable=()=>(this.disabled||(this.disabled=!0),this.elements.container.classList.add("fracgui-disabled"),this.elements.alphaSlider.disabled=!0,this.elements.hueSlider.disabled=!0,this.elements.canvas.style.pointerEvents="none",this);set(t){this.input.state.value.set(t),this.input.refresh(),this.refresh()}setAlpha=t=>{this.input.state.value.alpha=Number(t.target.value),this.input.refresh()};refresh=()=>{this._log.fn("refresh").debug();let t=this.input.state.value;return this._lastColor?.hex===t.hex8String?this:(this._lastColor=t.clone(),this.elements.hueSlider.value=String(this.hue),this.elements.alphaSlider.value=String(this.alpha),this.elements.alphaSlider.style.color=t.hexString,this.draw(),this._lockCursorPosition?(this.elements.handle.style.background=t.hexString,this._lockCursorPosition=!1):this._updateHandle(),this)};draw=()=>{this._fill(`hsl(${this.hue}, 100%, 50%)`),this._fill(this._gradientWhite),this._fill(this._gradientBlack)};_fill(t){this._ctx.fillStyle=t,this._ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}_updateGradients(){this._gradientWhite=this._ctx.createLinearGradient(0,0,this.canvas.width,0),this._gradientWhite.addColorStop(0,"rgba(255,255,255,1)"),this._gradientWhite.addColorStop(1,"rgba(255,255,255,0)"),this._gradientBlack=this._ctx.createLinearGradient(0,0,0,this.canvas.height),this._gradientBlack.addColorStop(0,"rgba(0,0,0,0)"),this._gradientBlack.addColorStop(1,"rgba(0,0,0,1)")}_pointerUpClickLatch=!1;_onPointerDown=t=>{this._log.fn("_onPointerDown").debug(),this._evm.emit("pointerdown"),this._dragging=!0,this._updateFromMousePosition(t),addEventListener("pointerup",this._onPointerUp,{once:!0})};_onPointerMove=t=>{this._log.fn("_onPointerMove").debug(),this._dragging&&this._updateFromMousePosition(t)};_onPointerUp=()=>{this._log.fn("_onPointerUp").debug(),this._evm.emit("pointerup"),this._dragging=!1,this._pointerUpClickLatch=!0};_onClick=t=>{if(this._log.fn("_onClick"),this._pointerUpClickLatch){this._log.debug("Click latch triggered. Aborting."),this._pointerUpClickLatch=!1;return}this._log.debug(),this._updateFromMousePosition(t),this._dragging=!1};_updateFromMousePosition(t){this._log.fn("_updateFromMousePosition").debug();let{left:i,top:e,width:r,height:o}=this.canvas.getBoundingClientRect(),s=w(t.clientX-i,0,r),a=w(t.clientY-e,0,o),{s:l,v:c}=this._getColorAtPosition(s,a);this.input.state.value.hsv={h:this.hue,s:l,v:c},this.input.set(this.input.state.value),this._drawHandle(this._getHandlePosition(this.input.state.value))}_getColorAtPosition=(t,i)=>{this._log.fn("_getColorAtPosition").debug();let{width:e,height:r}=this.canvas.getBoundingClientRect(),o=this.opts.handleSize/3;return{s:bt(t,o,e-o,0,100),v:bt(i,o,r-o,100,0)}};_updateStateFromHue=t=>{this._log.fn("_updateStateFromHue").debug(),this._lockCursorPosition=!0;let i=Number(t.target.value),{s:e,v:r,a:o}=this.input.state.value.hsva;this.input.state.value.hsva={h:i,s:e,v:r,a:o},this.input.set(this.input.state.value),this.elements.handle.style.background=this.input.state.value.hexString,this.draw()};_updateHandle=(t=this.input.state.value)=>{this._drawHandle(this._getHandlePosition(t))};_getHandlePosition=t=>{let{width:i,height:e}=this.canvas.getBoundingClientRect(),r=this.opts.handleSize/2;return{x:bt(t.hsv.s,0,100,r,i-r),y:bt(t.hsv.v,0,100,e-r,r)}};_drawHandle=t=>{this.elements.handle.style.transform=`translate(${t.x}px, ${t.y}px)`,this.elements.handle.style.background=this.input.state.value.hexString};dispose(){this._ctx=null,this.elements.alphaSlider.remove(),this.elements.hueSlider.remove(),this.elements.handle.remove(),this.elements.canvas.remove(),this.elements.container.remove(),this._resizeObserver.disconnect(),this._evm.dispose()}};function si(...n){let t=0,i=[...n],e=i.shift(),r=i.shift();function o(...s){if(t++>500)throw new Error("infinite loop detected! (500 iteration limit)");e&&r&&e.appendChild(r),e=r,r=s.shift(),r&&o(...s)}o(...i)}var Yt=class{svg;back;front;check;constructor(){let t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("icon","copy"),t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round");let i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.classList.add("front"),i.setAttribute("width","13"),i.setAttribute("height","13"),i.setAttribute("rx","1"),i.setAttribute("ry","1"),i.setAttribute("x","8"),i.setAttribute("y","8");let e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.classList.add("back"),e.setAttribute("width","15"),e.setAttribute("height","15"),e.setAttribute("rx","1"),e.setAttribute("ry","1"),e.setAttribute("x","1"),e.setAttribute("y","1");let r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.classList.add("check"),r.setAttribute("d","M17 9l-7 7-4-4"),r.setAttribute("fill","none"),r.setAttribute("stroke-width","2"),t.appendChild(i),t.appendChild(e),t.appendChild(r),this.svg=t,this.back=e,this.front=i,this.check=r,this}appendTo(t){t.appendChild(this.svg)}};var Jt=class{constructor(t,i,e="Copy"){this.container=t;this.text=i;this.message=e;let r=u("div",{classes:["copy-button"],title:"Copy",attributes:{"aria-label":"Copy",title:"Copy"}}),o=u("div",{classes:["copy-button-svg-container"]});this.button=r,this.icon=new Yt,this.button.addEventListener("click",this.copy),si(t,this.button,o,this.icon.svg),this.tooltip=new R(this.button,{text:e,placement:"top",offsetY:"6px",delay:300,parent:t,style:{minWidth:"4.25rem",background:"var(--fracgui-bg-a)",color:"var(--fracgui-fg-a)"}})}button;icon;active=!1;outro=!1;#t;tooltip;copy=()=>{if(typeof navigator>"u"||this.active)return;let t=this.text();t&&(typeof t=="object"&&(t=JSON.stringify(t)),navigator.clipboard?.writeText?.(t),clearTimeout(this.#t),this.#e())};#e=()=>{this.active=!0,this.tooltip.show(),this.button.blur(),this.button.classList.add("active"),this.icon.svg.classList.add("active"),this.icon.front.setAttribute("x","5.5"),this.icon.front.setAttribute("y","5.5"),this.icon.front.setAttribute("rx","10"),this.icon.front.setAttribute("ry","10"),this.tooltip.text="Copied!",setTimeout(this.#i,1250)};#i=()=>{this.active=!1,this.outro=!0,this.button.classList.remove("active"),this.icon.svg.classList.remove("active"),this.icon.svg.classList.add("outro"),this.button.classList.add("outro"),this.icon.front.setAttribute("x","8"),this.icon.front.setAttribute("y","8"),this.icon.front.setAttribute("rx","1"),this.icon.front.setAttribute("ry","1"),setTimeout(this.#n,900)};#n=()=>{this.button.classList.remove("outro"),this.icon.svg.classList.remove("outro"),this.outro=!1,this.tooltip.hide(),clearTimeout(this.#t),this.#t=setTimeout(()=>{this.tooltip.text=this.message},300)}};var Vi={__type:"ColorInputOptions",value:"#FF0000FF",mode:"hex",expanded:!1},ct=class n extends C{__type="InputColor";initialValue;state;picker;components;expanded;_mode;get mode(){return this._mode}set mode(t){this._mode=t,this.components.mode=t}_log;constructor(t,i){let e=Object.assign({},Vi,t,{__type:"ColorInputOptions"});super(e,i),this.expanded=e.expanded,this._mode=e.mode,this._log=new f(`InputColor ${e.title}`,{fg:"cyan"}),this._log.fn("constructor").debug({opts:e,this:this}).groupEnd(),e.binding?(this.initialValue=new $(e.binding.target[e.binding.key]),this.state=b(this.initialValue.clone()),this._evm.add(this.state.subscribe(s=>{e.binding.target[e.binding.key]=s}))):(this.initialValue=new $(e.value),this.state=b(this.initialValue.clone()));let r=u("div",{classes:["fracgui-input-color-container"],parent:this.elements.content});this.elements.controllers.container=r,this.elements.controllers.currentColor=this._createCurrentColor(r);let o=u("div",{classes:["fracgui-input-color-body"],parent:r});this.picker=new Xt(this,{container:o}),this.components=new Wt(this,{container:o}),this.elements.controllers.body={container:o,picker:this.picker.elements,components:this.components.elements},this._dirty=()=>this.state.value.hex!==this.initialValue.hex,setTimeout(()=>{this.expanded?this.open():this.close(0)},10),this._emit("change"),this.refresh(),this.picker.on("pointerdown",this._lock),this.picker.on("pointerup",this._unlock)}set(t){if(it(t))this.commit({to:t.rgba,from:this.state.value.rgba,setter:e=>{this.state.value.set(e),this.state.refresh(),this.refresh()}}),this.state.set(new $(t.rgba));else{let e=new $(t);this.commit({to:e.rgba,from:this.state.value.rgba,setter:r=>{this.state.value.set(r),this.state.refresh(),this.refresh()}}),this.state.set(e)}let i=this.state.value;return this._log.fn("set").debug({v:t,newValue:i,this:this}),this._emit("change",i),this.refresh(i),this}refresh=(t=this.state.value)=>(this._log.fn("refresh").debug({v:t,this:this}),this.elements.controllers.currentColor.display.style.backgroundColor=t.hex,this.picker.refresh(),this.components.refresh(),super.refresh(),this);get aTitle(){return this.mode==="rgba"?"r":"h"}get bTitle(){return this.mode==="rgba"?"g":"s"}get cTitle(){return this.mode==="rgba"?"b":this.mode==="hsla"?"l":"v"}get dTitle(){return"a"}_createCurrentColor(t){let i=u("div",{classes:["fracgui-input-color-current-color-container"],parent:t}),e=u("div",{classes:["fracgui-input-color-current-color-background"],parent:i}),r=u("div",{classes:["fracgui-input-color-current-color-display"],parent:e});this._evm.listen(r,"click",this.togglePicker);let o=new Jt(i,()=>this.state.value.hex,"Copy Hex");return{container:i,displayBackground:e,display:r,copyButton:o}}static#t="75px";get _pickerContainer(){return this.picker.elements.container}togglePicker=async()=>{this.expanded?await this.close():await this.open()};open=async()=>{this.expanded=!0,this.elements.container.dataset.search_height="100px";let t=this._pickerContainer?.animate([{height:"0px",clipPath:"inset(0 0 100% 0)"},{height:n.#t,clipPath:"inset(0 0 -50% 0)"}],{duration:200,easing:"cubic-bezier(.08,.38,0,0.92)",fill:"forwards"}),i=this.elements.container.animate({maxHeight:"100px",height:"100px"},{duration:200,easing:"cubic-bezier(.08,.38,0,0.92)",fill:"forwards"});this._pickerContainer?.style.setProperty("overflow","visible"),this._pickerContainer?.classList.add("expanded"),await Promise.all([t?.finished,i?.finished]),this._pickerContainer&&document.contains(this._pickerContainer)&&t?.commitStyles(),this.elements.container&&document.contains(this.elements.container)&&i?.commitStyles()};close=async(t=300)=>{this.expanded=!1,delete this.elements.container.dataset.search_height;let i=this._pickerContainer?.animate([{height:n.#t,clipPath:"inset(0 0 -100% 0)"},{height:"0px",clipPath:"inset(0 0 100% 0)"}],{duration:t,easing:"cubic-bezier(.13,.09,.02,.96)",fill:"forwards"}),e=this.elements.container.animate({minHeight:"var(--fracgui-input_height)",maxHeight:"var(--fracgui-input_height)",height:"var(--fracgui-input_height)"},{duration:t,easing:"cubic-bezier(.13,.09,.02,.96)",fill:"forwards"});this._pickerContainer?.style.setProperty("overflow","hidden"),this._pickerContainer?.classList.remove("expanded"),await Promise.all([i?.finished,e?.finished]),this._pickerContainer&&document.contains(this._pickerContainer)&&i?.commitStyles(),this.elements.container&&document.contains(this.elements.container)&&e?.commitStyles()};_lock=()=>{this.lock(this.state.value.rgba)};_unlock=()=>{this.unlock({target:this,to:this.state.value.rgba,setter:t=>{this.state.value.set(t),this.state.refresh(),this._emit("change",this.state.value),this.refresh()}})};enable(){return this.picker.enable(),super.enable(),this}disable(){return this.picker.disable(),super.disable(),this}save(){return super.save({value:this.state.value.hex})}load(t){let i=typeof t=="string"?JSON.parse(t):t;this.id=i.presetId,this.disabled=i.disabled,this.hidden=i.hidden,this.initialValue=new $(i.value),this.set(this.initialValue.clone())}dispose(){this._log.fn("dispose").debug({this:this}),this.picker.dispose(),super.dispose()}};var ai=(n,t,i)=>u("input",{type:"textarea",classes:["fracgui-controller","fracgui-controller-text"],value:n.state.value,parent:i,attributes:{spellcheck:"false"}});var Di={__type:"TextInputOptions",value:"foo",maxLength:50},ut=class extends C{__type="InputText";initialValue;state;#t;constructor(t,i){let e=Object.assign({},Di,t);super(e,i),this.#t=new f(`InputText ${e.title}`,{fg:"cyan"}),this.#t.fn("constructor").info({opts:e,this:this}),e.binding?(this.initialValue=e.binding.target[e.binding.key],this.state=b(this.initialValue),this._evm.add(this.state.subscribe(o=>{e.binding.target[e.binding.key]=o}))):(this.initialValue=e.value,this.state=b(e.value));let r=u("div",{classes:["fracgui-input-text-container"],parent:this.elements.content});this.elements.controllers={container:r,input:ai(this,e,r)},this._evm.listen(this.elements.controllers.input,"input",this.set),this._evm.add(this.state.subscribe(()=>{this.refresh()}))}enable(){return super.enable(),this.elements.controllers.input.disabled=!1,this}disable(){return super.disable(),this.elements.controllers.input.disabled=!0,this}set=t=>{if(!(typeof t>"u"))return typeof t!="string"?t?.target&&"value"in t.target&&(this.commit({to:t.target.value}),this.state.set(t.target.value)):(this.commit({to:t}),this.state.set(t)),this._emit("change",this.state.value),this};refresh=()=>{let t=this.state.value;return this.elements.controllers.input.value=t,super.refresh(t),this};dispose(){super.dispose()}};function ge(n){let o="var(--fracgui-theme-a)",s="var(--fracgui-theme-a)",a=document.createElement("div");a.classList.add("fracgui-folder-icon-container");let l=n.allChildren.length+n.inputs.size;a.style.setProperty("filter",`hue-rotate(${n.hue}deg)`);let c=[{id:1,cx:16.43,cy:11.93,r:1.1103},{id:2,cx:15.13,cy:15.44,r:.8081},{id:3,cx:15.13,cy:8.423,r:.8081},{id:4,cx:12.49,cy:16.05,r:.4788},{id:5,cx:12.42,cy:7.876,r:.545},{id:6,cx:10.43,cy:15.43,r:.2577},{id:7,cx:10.43,cy:8.506,r:.2769},{id:8,cx:17.85,cy:14.59,r:.5635},{id:9,cx:17.85,cy:9.295,r:.5635},{id:10,cx:19.19,cy:12.95,r:.5635},{id:11,cx:19.19,cy:10.9,r:.5635},{id:12,cx:20.38,cy:11.96,r:.2661},{id:13,cx:19.74,cy:14.07,r:.2661},{id:14,cx:19.74,cy:9.78,r:.2661},{id:15,cx:20.7,cy:12.96,r:.2661},{id:16,cx:20.7,cy:10.9,r:.2661},{id:17,cx:21.38,cy:11.96,r:.2661}];function p(I){return`<circle
				class="alt c${I.id}"
				cx="${I.cx*1.1}"
				cy="${I.cy}"
				r="${I.r}"
				style="transition-delay: ${I.id*.05}s;"
			/>`}function h(I){return I.map(G=>p(c[G-1])).join(`
`)}let x=h({0:[],1:[1],2:[2,3],3:[1,2,3],4:[2,3,4,5],5:[1,2,3,4,5],6:[2,3,4,5,6,7],7:[1,2,3,4,5,6,7],8:[1,2,3,4,5,6,7,8],9:[1,2,3,4,5,6,7,8,9],10:[1,2,3,4,5,6,7,8,9,10],11:[1,2,3,4,5,6,7,8,9,10,11],12:[1,2,3,4,5,6,7,8,9,10,11,12],13:[1,2,3,4,5,6,7,8,9,10,11,12,13],14:[1,2,3,4,5,6,7,8,9,10,11,12,13,14],15:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],16:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],17:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]}[Math.min(l,c.length)]),y="cubic-bezier(0.36, 0, 0.66, -0.56)",g="cubic-bezier(0.23, 1, 0.320, 1)",v=`
			.fracgui-folder-icon {
				overflow: visible;
				backface-visibility: hidden;
			}

			.fracgui-folder-icon circle, .fracgui-folder-icon line {
				transform-origin: center;

				transition-duration: 0.25s;
				transition-timing-function: ${g};
				backface-visibility: hidden;
			}

			/*//?	Circle A	*/
			.closed .fracgui-folder-icon circle.a {
				transform: scale(1);
				
				stroke: transparent;
				fill: ${o};
				
				transition: all .5s ${y}, stroke 2s ${y}, fill .2s ${y} 0s;
			}
			.fracgui-folder-icon circle.a {
				transform: scale(0.66);

				stroke: ${o};
				fill: ${s};

				transition: all .33s ${y}, stroke 2s ${y}, fill .2s ease-in 0.25s;
			}

			/*//?	Circle Alt	*/
			.closed .fracgui-folder-icon circle.alt {
				transform: translate(-3px, 0) scale(1.8);

				transition-duration: 0.5s;
				transition-timing-function: ${g};
			}
			 .fracgui-folder-icon circle.alt {
				transform: translate(0, 0) scale(0);

				stroke: none;
				fill: ${s};

				transition-duration: 0.75s;
				transition-timing-function: ${g};
			}
		`.trim();return a.innerHTML=`
		<svg
			xmlns="http://www.w3.org/2000/svg"
			width="100%"
			height="100%"
			viewBox="0 0 24 24"
			fill="none"
			stroke-width="1"
			stroke-linecap="round"
			stroke-linejoin="round"
			class="fracgui-folder-icon"
			overflow="visible"
		>
			<circle class="a" cx="12" cy="12" r="4" stroke="${s}" fill="${o}" />

			${x}

			<style lang="css">
				${v}
			</style>
		</svg>`.trim(),n.closed.value&&a.classList.add("closed"),a}function li(n){let t=u("div",{classes:["fracgui-connector-container"]}),i=20,e=n.element.clientHeight,r=1,o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("class","fracgui-connector-svg"),o.setAttribute("width",`${i}`),o.setAttribute("stroke-width",`${r}`),o.setAttribute("viewBox",`0 0 ${i} ${e}`),o.setAttribute("overflow","visible"),o.setAttribute("backface-visibility","hidden"),o.setAttribute("preserveAspectRatio","xMinYMin slice"),o.style.setProperty("filter",`hue-rotate(${n.hue}deg)`);let s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("vector-effect","non-scaling-stroke"),s.setAttribute("fill","none"),s.setAttribute("stroke","var(--fracgui-theme-a)"),s.setAttribute("stroke-width",`${r}`),s.setAttribute("stroke-linecap","round"),s.setAttribute("stroke-linejoin","round"),s.setAttribute("d",`M10,0 Q0,0 0,10 L0,${e}`);let a=n.elements.header.clientHeight;s.setAttribute("transform",`translate(0, ${a/2})`);let l=document.createElementNS("http://www.w3.org/2000/svg","defs"),c=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");c.setAttribute("id","gradient"),c.setAttribute("x1","0%"),c.setAttribute("y1","0%"),c.setAttribute("x2","0%"),c.setAttribute("y2","100%");function p(h,m,x="var(--fracgui-theme-a)"){let y=document.createElementNS("http://www.w3.org/2000/svg","stop");return y.setAttribute("offset",`${h}%`),y.setAttribute("style",`stop-color: ${x}; stop-opacity: ${m}`),c.appendChild(y),y}return p(0,.5),p(1,.5),p(5,.4),p(20,.3),p(40,.2),p(100,.2),s.setAttribute("stroke","url(#gradient)"),l.appendChild(c),o.insertBefore(l,o.firstChild),o.appendChild(s),t.appendChild(o),{container:t,svg:o,path:s}}function fe(n,t){if(!n.graphics?.connector)return;let i=n.graphics.connector.path,e=`${i.getTotalLength()}`;i.style.strokeDasharray=`${e}`;let{duration:r,from:o,to:s,delay:a,easing:l}=t==="open"?{duration:600,delay:0,from:e,easing:"cubic-bezier(.29,.1,.03,.94)",to:"0"}:{duration:150,delay:0,from:"0",easing:"cubic-bezier(.15,.84,.19,.98)",to:e},c=[{strokeDashoffset:o},{strokeDashoffset:s}],p={duration:r,delay:a,easing:l,fill:"forwards"};n.graphics.connector.path.animate(c,p)}function ci(n,t){return n.composedPath().some(i=>i.classList?.contains(t))}var qt=@K class{class="fracgui-terminal-icon";element;classes=[this.class,"fracgui-cancel"];constructor(t){let i=t.isRoot?t.elements.header:t.elements.title;t.isRoot&&this.classes.push("fracgui-terminal-icon-root"),this.element=u("div",{parent:i,classes:this.classes,innerHTML:`
                <svg class="icon terminal" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="4 17 10 11 4 5"></polyline>
                    <line x1="12" x2="20" y1="19" y2="19"></line>
                </svg>
                `.replaceAll(/\t|\n/g,""),tooltip:{text:"<code>console.log(folder)</code>",delay:1500,placement:"right"},onclick:e=>{e.stopPropagation(),e.preventDefault(),console.log(t)}})}static style=`
        .fracgui-terminal-icon {
            position: absolute;
            right: -1.5rem;
            top: 0;
            bottom: 0;

            width: 16px;
            height: 16px;

            color: var(--fracgui-fg-d);
            transform: translateY(15%);
            opacity: 0;

            transition: opacity 0.2s;
            transition-delay: 0.5s;

            z-index: 1;
        }

        .fracgui-terminal-icon-root {
            right: unset;
            left: 0.5rem;
            top: 0.25rem;
        }


        .fracgui-terminal-icon:hover {
            opacity: 0.75;
        }

        .fracgui-terminal-icon svg {
            width: 100%;
            height: 100%;
        }
    `};function ui(n,t){let i=n.length,e=t.length;if(i>e)return!1;if(i===e)return n===t;t:for(let r=0,o=0;r<i;r++){let s=n.charCodeAt(r);for(;o<e;)if(t.charCodeAt(o++)===s)continue t;return!1}return!0}var Zt=class{constructor(t){this.folder=t;let i=u("div",{classes:["fracgui-toolbar-item","fracgui-search-container"]});t.elements.toolbar.container.prepend(i);let e=u("input",{classes:["fracgui-controller-text","fracgui-search-input","fracgui-cancel"],parent:i});this._evm.listen(e,"input",s=>this.search(s.target.value));let r=u("button",{classes:["fracgui-search-button","fracgui-cancel"],parent:i});this.tooltip=new R(r,{text:this.defaultTooltipText,placement:"left",delay:500});let o=this._searchIcon();return r.appendChild(o),this._evm.listen(r,"click",this.toggle),this.elements={container:i,input:e,button:r,icon:o},this}elements;needle="";showing=!1;tooltip;get defaultTooltipText(){return"Search "+(this.folder.isRoot?"All":this.folder.title)}_evm=new E;search=t=>{this.needle=t;for(let[i,e]of this.folder.allInputs){let r=ui(this.needle.toLocaleLowerCase(),i.toLowerCase())?"hit":"miss",o=this.needle===""?"hit":r,s=e.elements.container;if(s.dataset.search===o)continue;let a=getComputedStyle(s);s.dataset.search_height??=a.minHeight,s.dataset.search_overflow??=a.overflow??"unset",s.dataset.search_contain??=a.contain??"none",s.dataset.search_opacity??=a.opacity??1,o==="hit"?this._expandInput(s):o==="miss"&&this._collapseInput(s),s.dataset.search=o}};_expandInput=async t=>{if(t.dataset.search==="miss"){t.style.setProperty("overflow",t.dataset.search_overflow),t.style.setProperty("contain",t.dataset.search_contain);let i=t.dataset.search_height??"100%",e=t.animate([{opacity:0,height:"0px",minHeight:"0px"},{opacity:1,height:i,minHeight:i}],{duration:300,easing:"cubic-bezier(0.23, 1, 0.32, 1)",fill:"forwards"});await e.finished,e.commitStyles()}};_collapseInput=async t=>{t.style.setProperty("overflow","hidden"),t.style.setProperty("contain","size");let i=t.animate([{opacity:0,height:"0px",minHeight:"0px"}],{duration:300,easing:"cubic-bezier(0.23, 1, 0.32, 1)",fill:"forwards"});await i.finished,i.commitStyles()};clear=()=>{for(let[,t]of this.folder.allInputs)this._expandInput(t.elements.container)};toggle=t=>{t?.stopImmediatePropagation(),this.showing?this.close():this.open()};_tooltipTimeout;open=()=>{this.showing=!0,this.elements.container.classList.add("active"),this.elements.input.focus(),removeEventListener("click",this._clickOutside),addEventListener("click",this._clickOutside),removeEventListener("keydown",this._escape),addEventListener("keydown",this._escape),this.tooltip.hide(),clearTimeout(this._tooltipTimeout),this._tooltipTimeout=setTimeout(()=>{this.tooltip.text="Cancel (esc)",this.tooltip.placement="top",this.tooltip.offsetX="-40px",this.tooltip.offsetY="-2px"},100);for(let t of this.folder.allChildren)t.closed.value&&(t.element.dataset.searchclosed="true",t.open())};close=()=>{this.showing=!1,this.elements.container.classList.remove("active"),(document.activeElement===this.elements.input||document.activeElement===this.elements.button)&&document.activeElement?.blur(),this.clear(),removeEventListener("click",this._clickOutside),removeEventListener("keydown",this._escape),this.tooltip.hide(),clearTimeout(this._tooltipTimeout),this._tooltipTimeout=setTimeout(()=>{this.tooltip.text=this.defaultTooltipText,this.tooltip.placement="left",this.tooltip.offsetX=Ft.offsetX,this.tooltip.offsetY=Ft.offsetY},100);for(let t of this.folder.allChildren)t.element.dataset.searchclosed&&(t.element.dataset.searchclosed="",t.close())};_clickOutside=t=>{!this.needle&&!t.composedPath().includes(this.elements.container)&&this.close()};_escape=t=>{t.key==="Escape"&&this.close()};_searchIcon(){let t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("aria-hidden","true"),t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("viewBox","0 0 20 20"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round");let i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M13.34 13.34 L19 19"),t.appendChild(i);let e=document.createElementNS("http://www.w3.org/2000/svg","circle");return e.setAttribute("cx","8"),e.setAttribute("cy","8"),e.setAttribute("r","7"),t.appendChild(e),t.classList.add("search-icon"),t.style.pointerEvents="none",t}dispose(){this._evm.dispose(),this.tooltip.dispose(),this.elements.container.remove()}};var Ni=Object.freeze({presetId:"",title:"",children:[],closed:!1,hidden:!1,controls:new Map,saveable:!0}),pi={__type:"InternalFolderOptions",parentFolder:void 0,isRoot:!0,_skipAnimations:!0,gui:void 0,_headerless:!1},vt=class n{__type="Folder";isRoot=!0;id=S();gui;presetId;saveable;children=[];inputs=new Map;root;parentFolder;settingsFolder;closed=b(!1);element;elements={};graphics;evm=new E(["change","refresh","toggle","mount"]);on=this.evm.on.bind(this.evm);_title;_hidden=()=>!1;_log;_disabledTimer;_clickTime=200;_clicksDisabled=!1;_depth=-1;constructor(t){if(!("container"in t))throw new Error("Folder must have a container.");let i=Object.assign({},Ni,pi,{gui:this.gui,isRoot:!0},t);if(this._log=new f(`Folder ${i.title}`,{fg:"DarkSalmon"}),this._log.fn("constructor").debug({opts:i,this:this}),this.isRoot=i.isRoot,this.isRoot)this._depth=0,this.parentFolder=this,this.root=this;else{if(!i.parentFolder)throw new Error("Non-root folders must have a parent folder.");this.parentFolder=i.parentFolder,this._depth=this.parentFolder._depth+1,this.root=this.parentFolder.root}this.gui=i.gui,this._title=i.title??"",this.element=this._createElement(i.container),this.elements=this._createElements(this.element),this.presetId=this.resolvePresetId(i),this.saveable=!!i.saveable,(this.isRoot||i.searchable)&&new Zt(this),i._skipAnimations&&(this.element.classList.add("instant"),setTimeout(()=>{this.element.classList.remove("instant")},0)),this.hidden=i.hidden?T(i.hidden):()=>!1,this.evm.add(this.closed.subscribe(e=>{e?this.close():this.open(),this.evm.emit("toggle",e)})),this._createGraphics(i._headerless).then(()=>{i.closed&&this.closed.set(i.closed),this.evm.emit("mount")})}get title(){return this._title}set title(t){t!==this._title&&(this._title=t,this.elements.title.animate({opacity:0,transform:"translateY(-0.33rem)"},{duration:75,easing:"ease-out",fill:"forwards"}).onfinish=()=>{this.elements.title.textContent=t,this.elements.title.animate([{opacity:0,transform:"translateY(.33rem)"},{opacity:1,transform:"translateY(0rem)"}],{delay:0,duration:75,easing:"ease-in",fill:"forwards"})})}get hidden(){return this._hidden()}set hidden(t){this._hidden=T(t),this._hidden()?this.hide():this.show()}get allChildren(){return this.children.flatMap(t=>[t,...t.allChildren])}get allInputs(){let t=new Map;for(let i of[this,...this.allChildren])for(let[e,r]of i.inputs.entries())t.set(e,r);return t}isRootFolder(){return this.isRoot}addFolder(t,i){i??={},i.title??=t,this._log.fn("addFolder").debug({options:i,this:this});let e=Object.assign({},pi,{parentFolder:this,depth:this._depth+1,gui:this.gui}),r={__type:"InternalFolderOptions",container:this.elements.content,isRoot:!1},o=Object.assign({},e,i,r),s=new n(o);return s.on("change",a=>this.evm.emit("change",a)),this.children.push(s),this._createSvgs(),o._headerless&&(s.elements.header.style.display="none"),s}_handleClick(t){if(t.button===0){if(this._log.fn("#handleClick").debug({event:t,this:this}),this.element.removeEventListener("pointerup",this.toggle),this.element.addEventListener("pointerup",this.toggle,{once:!0}),ci(t,"fracgui-cancel"))return this._disableClicks();clearTimeout(this._disabledTimer),this._disabledTimer=setTimeout(()=>{this.elements.header.removeEventListener("pointermove",this._disableClicks),this.elements.header.addEventListener("pointermove",this._disableClicks,{once:!0}),this._disabledTimer=setTimeout(()=>{this.elements.header.removeEventListener("pointermove",this._disableClicks),this.element.removeEventListener("pointerup",this.toggle),this._clicksDisabled=!1},this._clickTime)},150),this._clicksDisabled}}_disableClicks=()=>{this._clicksDisabled||(this._clicksDisabled=!0,this._log.fn("disable").debug("Clicks DISABLED")),this._clicksDisabled=!0,clearTimeout(this._disabledTimer)};_resetClicks(){this._log.fn("cancel").debug("Clicks ENABLED"),removeEventListener("pointerup",this.toggle),this._clicksDisabled=!1}toggle=()=>{if(this._log.fn("toggle").debug(),clearTimeout(this._disabledTimer),this._clicksDisabled){this._resetClicks();return}if(this.element.classList.contains("fracgui-dragged")){this.element.classList.remove("fracgui-dragged");return}let t=!this.closed.value;this.closed.set(t),this.evm.emit("toggle",t)};open(t=!1){this._log.fn("open").debug(),this.element.classList.remove("closed"),t&&this.closed.set(!1),this._clicksDisabled=!1,this.#e(),fe(this,"open")}close(t=!1){this._log.fn("close").debug(),this.element.classList.add("closed"),t&&this.closed.set(!0),this._clicksDisabled=!1,this.#e(),fe(this,"close")}toggleHidden(){this._log.fn("toggleHidden").debug(),this.element.classList.toggle("hidden")}hide(){this._log.fn("hide").error(),this.element.classList.add("hidden")}show(){this._log.fn("show").debug(),this.element.classList.remove("hidden")}#t;#e=()=>{this.element.classList.add("animating"),clearTimeout(this.#t),this.#t=setTimeout(()=>{this.element.classList.remove("animating")},600)};resolvePresetId=t=>{this._log.fn("resolvePresetId").debug({opts:t,this:this});let i=o=>o.isRootFolder.bind(o)||o.parentFolder!==this?[o.title]:[...i(o.parentFolder),o.title],e=i(this),r=t?.presetId||e.join("__");if(!r){let o=0;for(let s of this.allChildren)s.presetId==r&&o++;o>0&&(r+=o)}return r};save(){if(this._log.fn("save").debug({this:this}),this.saveable!==!0)throw new Error("Attempted to save unsaveable Folder: "+this.title);return{__type:"FolderPreset",id:this.presetId,title:this.title,closed:this.closed.value,hidden:T(this._hidden)(),children:this.children.filter(i=>i.title!==rt.settingsFolderTitle&&i.saveable).map(i=>i.save()),inputs:Array.from(this.inputs.values()).filter(i=>i.opts.saveable).map(i=>i.save())}}load(t){this._log.fn("load").debug({preset:t,this:this}),this.closed.set(t.closed),this.hidden=t.hidden;for(let i of this.children){let e=t.children?.find(r=>r.id===i.presetId);e&&i.load(e)}for(let i of this.inputs.values()){let e=t.inputs.find(r=>r.presetId===i.id);e&&i.load(e)}}refresh(){this._log.fn("refresh").debug(this);for(let t of this.inputs.values())t.refresh()}refreshAll(){for(let t of this.allInputs.values())t.refresh();this.evm.emit("refresh")}addMany(t,i){let e=i?.folder??this;for(let[r,o]of Object.entries(t))if(typeof o=="object"){if(it(o)){this.addColor({title:r,value:o});continue}let s=e.addFolder(r);s.addMany(o,{folder:s})}else{let s={title:r,value:o,binding:{target:t,key:r}};typeof o=="number"&&(o>0?(s.max=o*2,s.step=o/10,s.min=0):o==0?(s.min=-1,s.step=.01,s.max=1):(s.min=o*2,s.step=o/10,s.max=0)),this.add(s)}}add(t,i){let e=this._resolveOptions(t,i),r=this._createInput(e);return this.inputs.set(r.id,r),this._refreshIcon(),r}bind(t,i,e){let r=t[i],o=e??{};o.title??=i,o.binding={target:t,key:i,initial:r};let s=this._createInput(o);return this.inputs.set(s.id,s),this._refreshIcon(),s}addNumber(t,i){let e=this._resolveOptions(t,i),r=new lt(e,this);return this.inputs.set(r.id,r),this._refreshIcon(),r}bindNumber(t,i,e){let r=this._resolveBinding(t,i,e),o=new lt(r,this);return this.inputs.set(o.title,o),this._refreshIcon(),o}addText(t,i){let e=this._resolveOptions(t,i),r=new ut(e,this);return this.inputs.set(r.id,r),this._refreshIcon(),r}bindText(t,i,e){let r=this._resolveBinding(t,i,e),o=new ut(r,this);return this.inputs.set(o.title,o),this._refreshIcon(),o}addColor(t,i){let e=this._resolveOptions(t,i),r=new ct(e,this);return this.inputs.set(r.id,r),this._refreshIcon(),r}bindColor(t,i,e){let r=this._resolveBinding(t,i,e),o=new ct(r,this);return this.inputs.set(o.title,o),this._refreshIcon(),o}addButton(t,i){let e=this._resolveOptions(t,i),r=new ot(e,this);return this.inputs.set(r.id,r),this._refreshIcon(),r}bindButton(t,i,e){let r=this._resolveBinding(t,i,e),o=new ot(r,this);return this.inputs.set(o.title,o),this._refreshIcon(),o}addButtonGrid(t,i){let e=this._resolveOptions(t,i),r=new ft(e,this);return this.inputs.set(r.id,r),this._refreshIcon(),r}bindButtonGrid(t,i,e){let r=this._resolveBinding(t,i,e),o=new ft(r,this);return this.inputs.set(o.title,o),this._refreshIcon(),o}addSelect(t,i){let e=this._resolveOptions(t,i),r=new at(e,this);return this.inputs.set(r.id,r),this._refreshIcon(),r}bindSelect(t,i,e){let r=this._resolveBinding(t,i,e),o=new at(r,this);return this.inputs.set(o.title,o),this._refreshIcon(),o}addSwitch(t,i){let e=this._resolveOptions(t,i),r=new nt(e,this);return this.inputs.set(r.id,r),this._refreshIcon(),r}bindSwitch(t,i,e){let r=this._resolveBinding(t,i,e),o=new nt(r,this);return this.inputs.set(o.title,o),this._refreshIcon(),o}_validateOptions(t,i){if(t.binding?.key&&!t.title&&(t.title=t.binding.key),i){let e=t.binding,r=t.value;if(r||(r=e?.target[e?.key]),!r)if(e){let o=!1;if(typeof e.target>"u"&&(o=!0,console.error('\x1B[96mgooey\x1B[39m ~ \x1B[91mError\x1B[39m Binding "target" is undefined:',e)),typeof e.key>"u"&&(o=!0,console.error('\x1B[96mgooey\x1B[39m ~ \x1B[91mError\x1B[39m Binding "key" is undefined:',e)),typeof e.target[e.key]>"u"&&(o=!0,console.error(`\x1B[96mgooey\x1B[39m ~ \x1B[91mError\x1B[39m The provided binding key \x1B[33m"${e.key}"\x1B[39m does not exist on provided \x1B[33mtarget\x1B[39m:`,e)),o)throw new Error("gooey ~ Failed to bind input to the provided target object.",{cause:t})}else throw new Error("gooey ~ No value or binding provided.",{cause:t})}return t}_createInput(t){this._log.fn("#createInput").debug(this);let i=this._resolveType(t);switch(t=this._validateOptions(t),i){case"InputText":return new ut(t,this);case"InputNumber":return new lt(t,this);case"InputColor":return new ct(t,this);case"InputSelect":return new at(t,this);case"InputButton":return new ot(t,this);case"InputSwitch":return new nt(t,this)}throw new Error("Invalid input type: "+i+" for options: "+t)}_resolveOptions(t,i){let e=typeof t=="string"&&typeof i=="object",r=e?t:i?.title??"",o=e?i:t;return o.title??=r,o}_resolveBinding(t,i,e){let r,o=!1;if(typeof t=="string")r=i??{},r.title=t;else{o=!0;let s=t,a=i;r=e??{},r.binding={target:s,key:a,initial:s[a]}}return this._validateOptions(r,o)}_resolveType(t){this._log.fn("resolveType").debug({options:t,this:this});let i=t.value??t.binding?.target[t.binding.key];if("onClick"in t)return"InputButton";if("options"in t&&Array.isArray(t.options)||P(i))return i??=t.options[0],t.value??=i,"InputSelect";switch(typeof i){case"boolean":return"InputSwitch";case"number":return"InputNumber";case"string":return We(i)?"InputColor":"InputText";case"function":return"InputButton";case"object":{if(Array.isArray(i))return"InputSelect";if(it(i))return"InputColor";if(P(i))return"InputSelect";throw new Error("Invalid input view: "+JSON.stringify(i))}default:throw new Error("Invalid input view: "+i)}}_createElement(t){return this._log.fn("#createElement").debug({el:t,this:this}),this.isRoot?u("div",{id:`fracgui-root_${this.id}`,classes:["fracgui-root","fracgui-folder","closed"],dataset:{theme:this.gui.theme??"default"},parent:t}):u("div",{parent:this.parentFolder.elements.content,classes:["fracgui-folder","closed"]})}_createElements(t){this._log.fn("#createElements").debug({element:t,this:this});let i=u("div",{parent:t,classes:["fracgui-header"]});i.addEventListener("pointerdown",this._handleClick.bind(this));let e=u("div",{parent:i,classes:["fracgui-title"],textContent:this.title}),r=u("div",{parent:i,classes:["fracgui-toolbar"]}),o=u("div",{classes:["fracgui-content-wrapper"],parent:t}),s=u("div",{classes:["fracgui-content"],parent:o});return{header:i,toolbar:{container:r},title:e,contentWrapper:o,content:s}}async _createGraphics(t=!1){this._log.fn("createGraphics").debug({this:this}),await Promise.resolve(),this.isRootFolder()||(this.graphics={icon:ge(this)},this.elements.header.prepend(this.graphics.icon),t||(this.graphics.connector=li(this),this.element.prepend(this.graphics.connector.container))),!1}_createSvgs(){this._log.fn("#createSvgs").debug({this:this})}get hue(){let t=this.parentFolder.children.indexOf(this),i=this.parentFolder.isRootFolder()?t-1:t,e=this._depth-1;return i*20+e*80}_refreshIcon(){this._log.fn("#refreshIcon").debug(this),this.graphics&&this.graphics.icon.replaceWith(ge(this))}disposed=!1;dispose(){if(this.disposed&&!1){this._log.fn("dispose").error("Already disposed.",this);return}this.elements.header.removeEventListener("click",this.toggle),this.elements.header.addEventListener("pointerdown",this._handleClick),this.element.remove();for(let t of this.inputs.values())t.dispose();for(let t of this.children)t.dispose();try{this.parentFolder.children.splice(this.parentFolder.children.indexOf(this),1)}catch(t){this._log.fn("dispose").error("Error removing folder from parent",{err:t})}this.disposed=!0}};var di={__type:"GuiStorageOptions",key:"fracgui",closed:!0,theme:!0,presets:!0,position:!1,size:!1},me={__type:"WindowManagerOptions",preserveZ:!1,zFloor:0,bounds:void 0,obstacles:void 0,resizable:{grabberSize:9,color:"var(--bg-d)",sides:["right","left"],corners:[]},draggable:{bounds:void 0,classes:{default:"fracgui-draggable",dragging:"fracgui-dragging",cancel:"fracgui-cancel",dragged:"fracgui-dragged"}}},Ki={__type:"GuiOptions",title:"gui",storage:!1,closed:!1,position:"top-right",margin:16,container:"body",theme:"default",themeMode:"dark",themes:[yt,ve,be],resizable:!0,draggable:!0},rt=class n{__type="Gui";id=S();folder;opts;closed;presetManager;dirty=!1;wrapper;container;settingsFolder;static settingsFolderTitle="fracgui-settings-folder";_undoManager=new Nt;themer;themeEditor;windowManager;_isWindowManagerOwner=!1;_birthday=Date.now();_honeymoon=1e3;_theme;_log;on;addFolder(t,i){return this._honeymoon&&this._birthday-Date.now()<1e3&&(this._honeymoon=!1,this._reveal(!0)),this.folder.addFolder(t,i)}add;addMany;addButtonGrid;addSelect;addButton;addText;addNumber;addSwitch;addColor;constructor(t){let i=L([Ki,t??{}],{concatArrays:!1});i.container??=document.body;let e=!1;typeof i.storage=="object"&&(i.storage=Object.assign({},di,i.storage));let r=et(i.storage,di);r?(i.storage={...r,key:`${r.key}::${i.title?.toLowerCase().replaceAll(/\s/g,"-")}`},`${i.storage.key}::wm::0::position`in localStorage||(e=!0)):e=!0,this.opts=i,this._log=new f(`Gui ${this.opts.title}`,{fg:"palevioletred"}),this._log.fn("constructor").debug({options:t,opts:i}),this.container=O(this.opts.container)[0],this.wrapper=u("div",{classes:["fracgui-wrapper"],style:{display:"contents"},parent:this.container}),this.folder=new vt({...this.opts,__type:"FolderOptions",container:this.wrapper,gui:this}),this.on=this.folder.on.bind(this.folder),this.addFolder=this.folder.addFolder.bind(this.folder),this.add=this.folder.add.bind(this.folder),this.addMany=this.folder.addMany.bind(this.folder),this.addButtonGrid=this.folder.addButtonGrid.bind(this.folder),this.addSelect=this.folder.addSelect.bind(this.folder),this.addButton=this.folder.addButton.bind(this.folder),this.addText=this.folder.addText.bind(this.folder),this.addNumber=this.folder.addNumber.bind(this.folder),this.addSwitch=this.folder.addSwitch.bind(this.folder),this.addColor=this.folder.addColor.bind(this.folder);let o=s=>{globalThis.navigator?.userAgent?.match(/mac/i)?s.metaKey&&s.key==="z"&&(s.preventDefault(),s.shiftKey?this._undoManager.redo():this._undoManager.undo()):s.ctrlKey&&(s.key==="z"&&(s.preventDefault(),this._undoManager.undo()),s.key==="y"&&(s.preventDefault(),this._undoManager.redo()))};return removeEventListener("keydown",o),addEventListener("keydown",o),this.closed=b(!!this.opts.closed,{key:this.opts.storage?`${this.opts.storage.key}::closed`:void 0}),this.folder.elements.toolbar.settingsButton=this._createSettingsButton(this.folder.elements.toolbar.container),this.settingsFolder=this.folder.addFolder(n.settingsFolderTitle,{closed:!0,hidden:!1,_headerless:!0}),this.themer=this.opts._themer??this._createThemer(this.settingsFolder),this.theme=this.opts.theme,this.presetManager=this._createPresetManager(this.settingsFolder),this.applyAltStyle(this.settingsFolder),this.windowManager??=this._createWindowManager(this.opts,this.opts.storage),this._reveal(e),this}async _reveal(t){if(await Promise.resolve(),!this.container)return;let i=this.wrapper.cloneNode(!0);i.style.visibility="hidden",this.container.prepend(i);let e=i.children[0].getBoundingClientRect();if(i.remove(),typeof this.opts.position=="string"){let r=Ot(e,this.opts.position,{bounds:this.opts.container,margin:this.opts.margin});if(t||this.opts.storage&&this.opts.storage.position===!1){let o=this.windowManager?.windows.get(this.folder.element.id);o?.draggableInstance&&(o.draggableInstance.position=r)}else console.error("//todo - set position here or enforce window manager")}this.container.appendChild(this.wrapper),this.folder.element.animate([{opacity:0},{opacity:1}],{fill:"none",duration:400})}_createPresetManager(t){let{presets:i,defaultPreset:e,storage:r}=this.opts,o;return typeof r=="object"&&r.presets&&(o=r.key+"::presets"),new Gt(this,t,{presets:i,defaultPreset:e,localStorageKey:o})}_createWindowManager(t,i){if(this.windowManager)return this.windowManager;let e;this.opts.draggable&&(e=Object.assign({},me.draggable),e.handle=this.folder.elements.header,e.position=this.opts.position,e.localStorageKey=i&&i.key?i.key:void 0,e.bounds=this.container,i&&i.position===!1&&(e.localStorageKey=void 0));let r;if(this.opts.resizable&&(r=Object.assign({},me.resizable),r.bounds=this.container,r.localStorageKey=i&&i.key?i.key:void 0,i&&i.size===!1&&(r.localStorageKey=void 0)),t?._windowManager instanceof gt){let a=t._windowManager;return a.add(this.folder.element,{id:this.id,resizable:r,draggable:e}),a}let o=et({...me,draggable:e,resizable:r},Mt);this._log.fn("_createWindowManager").debug({windowManagerOpts:o,options:t,opts:this.opts,dragOpts:e,resizeOpts:r});let s=new gt({...o,draggable:e,resizable:r});return this._isWindowManagerOwner=!0,s.add(this.folder.element,{id:this.id}),s}set theme(t){this._theme=t,this.folder.element.setAttribute("theme",t),this.folder.element.setAttribute("mode",this.themer.mode.value)}get theme(){return this._theme}save(t,i=S(10)){return{__type:"GuiPreset",__version:0,id:i,title:t,data:this.folder.save()}}load(t){this._log.fn("load").debug({preset:t}),this.dirty=!1,this.lockCommits(t),this.folder.load(t.data),Promise.resolve().then(()=>this.unlockCommits())}_undoLock=!1;lockCommit={from:void 0};commit(t){if(this._undoLock){this._log.fn("commit").debug("LOCKED: prevented commit while locked");return}this._log.fn("commit").debug("commited",t),this._undoManager?.commit(t)}lockCommits=t=>{this._undoManager.lockedExternally=!0,this.lockCommit.from=t,this._log.fn(H("lock")).debug("commit",{from:t,lockCommit:this.lockCommit})};unlockCommits=t=>{t??={},t.target??=this,t.from??=this.lockCommit.from,this._undoManager.lockedExternally=!1,this.commit(t),this._log.fn(H("unlock")).debug("commit",{commit:t,lockCommit:this.lockCommit})};_createThemer(t){this._log.fn("createThemer").debug({folder:t});let i,e=this.opts._themer,r={localStorageKey:this.opts.storage?this.opts.storage.key+"::themer":void 0,mode:this.opts.themeMode,autoInit:!this.themer,persistent:!!(this.opts.storage&&this.opts.storage.theme),themes:this.opts.themes,theme:this.opts.themes.find(s=>s.title===this.opts.theme),vars:ue};r.vars=L([ue,r.vars]),e?i=e:(r.wrapper=this.wrapper,i=new Dt(this.folder.element,r)),this.folder.evm.add(i.mode.subscribe(()=>{this.settingsFolder&&this.applyAltStyle(this.settingsFolder)}));let o=t.addFolder("ui",{closed:!0});return o.on("mount",()=>{o.graphics?.connector?.svg.style.setProperty("filter","saturate(0.1)"),o.graphics?.icon.style.setProperty("filter","saturate(0)")}),t&&(o.addSelect({title:"theme",labelKey:"title",options:i.themes.value,binding:{target:i,key:"theme"}}),o.addButtonGrid({title:"mode",activeOnClick:!0,value:[["light","dark","system"].map(s=>({text:s,onClick:()=>i?.mode.set(s),active:()=>i?.mode.value===s}))]})),i}isGui(){return this.__type==="Gui"}_createSettingsButton(t){let i=u("button",{parent:t,classes:["fracgui-toolbar-item","fracgui-settings-button"],innerHTML:qe,tooltip:{text:()=>this.settingsFolder?.closed.value?"Open Settings":"Close Settings",placement:"left",delay:750,delayOut:0,hideOnClick:!0}});return i.addEventListener("click",()=>{this.settingsFolder.toggle(),this.folder.elements.toolbar.settingsButton?.classList.toggle("open",!this.settingsFolder.closed.value)}),i}applyAltStyle(t){switch(this._setVar(t.elements.content,"box-shadow",`0px 0px 10px 0px hsl(10deg, 0%, var(--${d}-shadow-lightness), inset`),t.elements.content.style.setProperty("background",`--${d}-folder_background`),this._setProps(t.element,[["background",`color-mix(in sRGB, var(--${d}-bg-b) 100%, transparent)`]]),this.themer?.activeMode){case"dark":{this._setVars(t.elements.contentWrapper,[["input-container_color",`var(--${d}-fg-b)`],["folder-header_background",`color-mix(in sRGB, var(--${d}-bg-a) 75%, transparent)`],["controller-dim_background",`color-mix(in sRGB, var(--${d}-bg-a) 50%, transparent)`],["controller_background",`color-mix(in sRGB, var(--${d}-bg-c) 50%, transparent)`]]);break}case"light":{this._setVars(t.elements.contentWrapper,[["folder-header_background",`color-mix(in sRGB, var(--${d}-bg-a) 60%, transparent)`],["controller_background",`var(--${d}-light-a)`]]);break}}}_setProps(t,i){for(let[e,r]of i)t.style.setProperty(e,r)}_setVar(t,i,e){t.style.setProperty(`--${d}-${i}`,e),Promise.resolve().then(()=>{t.style.getPropertyValue(`--${d}-${i}`)||console.warn(`No property found for --${d}-${i}`)})}_setVars(t,i){for(let[e,r]of i)this._setVar(t,e,r)}dispose=()=>{this._log.fn("dispose").debug(this),this.themer?.dispose(),this._isWindowManagerOwner&&(this.windowManager?.dispose(),this.container?.remove()),this.settingsFolder?.dispose(),this.folder?.dispose()}};export{vt as Folder,rt as Gui};
//! We should use the same bounds as Draggable...
